{"version":3,"sources":["../../../../../../src/mxgraph/javascript/dist/js/util/mxSvgCanvas2D.js"],"names":["mxSvgCanvas2D","root","styleEnabled","mxAbstractCanvas2D","call","gradients","defs","svg","ownerDocument","document","node","nodeName","parentNode","tmp","getElementsByTagName","length","createElement","firstChild","insertBefore","appendChild","createStyle","mxUtils","extend","prototype","useDomParser","mxClient","IS_IE","DOMParser","XMLSerializer","doc","parseFromString","e","matchHtmlAlignment","textEnabled","foEnabled","foAltText","foOffset","textOffset","imageOffset","strokeTolerance","minStrokeWidth","refCount","blockImagePointerEvents","lineHeightCorrection","pointerEventsValue","fontMetricsPadding","cacheOffsetSize","format","value","parseFloat","toFixed","getBaseUrl","href","window","location","hash","lastIndexOf","substring","reset","apply","arguments","x","style","setAttribute","write","mxConstants","DEFAULT_FONTFAMILY","DEFAULT_FONTSIZE","tagName","namespace","createElementNS","NS_SVG","elt","createAlternateContent","fo","y","w","h","str","align","valign","wrap","overflow","clip","rotation","s","state","alt","Math","round","fontSize","fontColor","fontFamily","fontStyle","FONT_BOLD","FONT_ITALIC","FONT_UNDERLINE","createGradientId","start","end","alpha1","alpha2","direction","charAt","toLowerCase","dir","DIRECTION_SOUTH","DIRECTION_EAST","DIRECTION_NORTH","DIRECTION_WEST","getSvgGradient","id","gradient","ownerSVGElement","counter","tmpId","getElementById","createSvgGradient","getAttribute","op","stop","addNode","filled","stroked","path","join","fillColor","updateFill","IS_FF","strokeColor","updateStroke","transform","shadow","createShadow","createTolerance","pointerEvents","closeOp","originalRoot","alpha","fillAlpha","gradientColor","gradientFillAlpha","gradientAlpha","gradientDirection","IS_CHROME_APP","IS_IE11","IS_EDGE","base","replace","getCurrentStrokeWidth","max","strokeWidth","scale","strokeAlpha","sw","updateStrokeAttributes","dashed","createDashPattern","fixDash","lineJoin","lineCap","miterLimit","pat","dashPattern","dash","split","i","Number","tol","cloneNode","removeAttribute","IS_OT","shadowColor","shadowDx","shadowDy","shadowAlpha","setLink","link","setAttributeNS","documentMode","NS_XLINK","rotate","theta","flipH","flipV","cx","cy","dx","dy","tx","sx","ty","sy","rotationCx","rotationCy","begin","rect","n","roundrect","ellipse","image","src","aspect","converter","convert","tr","convertHtml","val","serializeToString","body","indexOf","implementation","createDocument","xd","xb","documentElement","div","innerHTML","child","next","nextSibling","adoptNode","ta","createDiv","lh","ABSOLUTE_LINE_HEIGHT","LINE_HEIGHT","ALIGN_CENTER","ALIGN_RIGHT","css","fontBackgroundColor","fontBorderColor","isNode","outerHTML","parseXml","invalidateCachedOffsetSize","mxCachedOffsetWidth","mxCachedFinalOffsetWidth","mxCachedFinalOffsetHeight","updateText","group","maxHeight","maxWidth","width","height","ow","oh","padX","padY","sizeDiv","offsetWidth","min","offsetHeight","ALIGN_MIDDLE","ALIGN_BOTTOM","IS_WIN","rotateHtml","pt","rotatePoint","text","WORD_WRAP","IS_SVG","clone","cssText","display","IS_QUIRKS","position","visibility","div2","wordWrap","padDx","ws","whiteSpace","removeChild","plainText","createClip","size","updateFont","c","anchor","lines","textHeight","trim","addTextBackground","bbox","mxRectangle","getBBox","ie","lineHeight","zoom","fontWeight","htmlEntities","floor","ceil","mod","stroke","fill","fillAndStroke","__mxOutput","undefined"],"mappings":"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","file":"mxSvgCanvas2D.js","sourcesContent":["/**\n * Copyright (c) 2006-2015, JGraph Ltd\n * Copyright (c) 2006-2015, Gaudenz Alder\n */\n/**\n * Class: mxSvgCanvas2D\n *\n * Extends <mxAbstractCanvas2D> to implement a canvas for SVG. This canvas writes all\n * calls as SVG output to the given SVG root node.\n * \n * (code)\n * var svgDoc = mxUtils.createXmlDocument();\n * var root = (svgDoc.createElementNS != null) ?\n * \t\tsvgDoc.createElementNS(mxConstants.NS_SVG, 'svg') : svgDoc.createElement('svg');\n * \n * if (svgDoc.createElementNS == null)\n * {\n *   root.setAttribute('xmlns', mxConstants.NS_SVG);\n *   root.setAttribute('xmlns:xlink', mxConstants.NS_XLINK);\n * }\n * else\n * {\n *   root.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xlink', mxConstants.NS_XLINK);\n * }\n * \n * var bounds = graph.getGraphBounds();\n * root.setAttribute('width', (bounds.x + bounds.width + 4) + 'px');\n * root.setAttribute('height', (bounds.y + bounds.height + 4) + 'px');\n * root.setAttribute('version', '1.1');\n * \n * svgDoc.appendChild(root);\n * \n * var svgCanvas = new mxSvgCanvas2D(root);\n * (end)\n * \n * A description of the public API is available in <mxXmlCanvas2D>.\n * \n * To disable anti-aliasing in the output, use the following code.\n * \n * (code)\n * graph.view.canvas.ownerSVGElement.setAttribute('shape-rendering', 'crispEdges');\n * (end)\n * \n * Or set the respective attribute in the SVG element directly.\n * \n * Constructor: mxSvgCanvas2D\n *\n * Constructs a new SVG canvas.\n * \n * Parameters:\n * \n * root - SVG container for the output.\n * styleEnabled - Optional boolean that specifies if a style section should be\n * added. The style section sets the default font-size, font-family and\n * stroke-miterlimit globally. Default is false.\n */\nfunction mxSvgCanvas2D(root, styleEnabled)\n{\n\tmxAbstractCanvas2D.call(this);\n\n\t/**\n\t * Variable: root\n\t * \n\t * Reference to the container for the SVG content.\n\t */\n\tthis.root = root;\n\n\t/**\n\t * Variable: gradients\n\t * \n\t * Local cache of gradients for quick lookups.\n\t */\n\tthis.gradients = [];\n\n\t/**\n\t * Variable: defs\n\t * \n\t * Reference to the defs section of the SVG document. Only for export.\n\t */\n\tthis.defs = null;\n\t\n\t/**\n\t * Variable: styleEnabled\n\t * \n\t * Stores the value of styleEnabled passed to the constructor.\n\t */\n\tthis.styleEnabled = (styleEnabled != null) ? styleEnabled : false;\n\t\n\tvar svg = null;\n\t\n\t// Adds optional defs section for export\n\tif (root.ownerDocument != document)\n\t{\n\t\tvar node = root;\n\n\t\t// Finds owner SVG element in XML DOM\n\t\twhile (node != null && node.nodeName != 'svg')\n\t\t{\n\t\t\tnode = node.parentNode;\n\t\t}\n\t\t\n\t\tsvg = node;\n\t}\n\n\tif (svg != null)\n\t{\n\t\t// Tries to get existing defs section\n\t\tvar tmp = svg.getElementsByTagName('defs');\n\t\t\n\t\tif (tmp.length > 0)\n\t\t{\n\t\t\tthis.defs = svg.getElementsByTagName('defs')[0];\n\t\t}\n\t\t\n\t\t// Adds defs section if none exists\n\t\tif (this.defs == null)\n\t\t{\n\t\t\tthis.defs = this.createElement('defs');\n\t\t\t\n\t\t\tif (svg.firstChild != null)\n\t\t\t{\n\t\t\t\tsvg.insertBefore(this.defs, svg.firstChild);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsvg.appendChild(this.defs);\n\t\t\t}\n\t\t}\n\n\t\t// Adds stylesheet\n\t\tif (this.styleEnabled)\n\t\t{\n\t\t\tthis.defs.appendChild(this.createStyle());\n\t\t}\n\t}\n};\n\n/**\n * Extends mxAbstractCanvas2D\n */\nmxUtils.extend(mxSvgCanvas2D, mxAbstractCanvas2D);\n\n/**\n * Capability check for DOM parser.\n */\n(function()\n{\n\tmxSvgCanvas2D.prototype.useDomParser = !mxClient.IS_IE && typeof DOMParser === 'function' && typeof XMLSerializer === 'function';\n\t\n\tif (mxSvgCanvas2D.prototype.useDomParser)\n\t{\n\t\t// Checks using a generic test text if the parsing actually works. This is a workaround\n\t\t// for older browsers where the capability check returns true but the parsing fails.\n\t\ttry\n\t\t{\n\t\t\tvar doc = new DOMParser().parseFromString('test text', 'text/html');\n\t\t\tmxSvgCanvas2D.prototype.useDomParser = doc != null;\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tmxSvgCanvas2D.prototype.useDomParser = false;\n\t\t}\n\t}\n})();\n\n/**\n * Variable: path\n * \n * Holds the current DOM node.\n */\nmxSvgCanvas2D.prototype.node = null;\n\n/**\n * Variable: matchHtmlAlignment\n * \n * Specifies if plain text output should match the vertical HTML alignment.\n * Defaul is true.\n */\nmxSvgCanvas2D.prototype.matchHtmlAlignment = true;\n\n/**\n * Variable: textEnabled\n * \n * Specifies if text output should be enabled. Default is true.\n */\nmxSvgCanvas2D.prototype.textEnabled = true;\n\n/**\n * Variable: foEnabled\n * \n * Specifies if use of foreignObject for HTML markup is allowed. Default is true.\n */\nmxSvgCanvas2D.prototype.foEnabled = true;\n\n/**\n * Variable: foAltText\n * \n * Specifies the fallback text for unsupported foreignObjects in exported\n * documents. Default is '[Object]'. If this is set to null then no fallback\n * text is added to the exported document.\n */\nmxSvgCanvas2D.prototype.foAltText = '[Object]';\n\n/**\n * Variable: foOffset\n * \n * Offset to be used for foreignObjects.\n */\nmxSvgCanvas2D.prototype.foOffset = 0;\n\n/**\n * Variable: textOffset\n * \n * Offset to be used for text elements.\n */\nmxSvgCanvas2D.prototype.textOffset = 0;\n\n/**\n * Variable: imageOffset\n * \n * Offset to be used for image elements.\n */\nmxSvgCanvas2D.prototype.imageOffset = 0;\n\n/**\n * Variable: strokeTolerance\n * \n * Adds transparent paths for strokes.\n */\nmxSvgCanvas2D.prototype.strokeTolerance = 0;\n\n/**\n * Variable: minStrokeWidth\n * \n * Minimum stroke width for output.\n */\nmxSvgCanvas2D.prototype.minStrokeWidth = 1;\n\n/**\n * Variable: refCount\n * \n * Local counter for references in SVG export.\n */\nmxSvgCanvas2D.prototype.refCount = 0;\n\n/**\n * Variable: blockImagePointerEvents\n * \n * Specifies if a transparent rectangle should be added on top of images to absorb\n * all pointer events. Default is false. This is only needed in Firefox to disable\n * control-clicks on images.\n */\nmxSvgCanvas2D.prototype.blockImagePointerEvents = false;\n\n/**\n * Variable: lineHeightCorrection\n * \n * Correction factor for <mxConstants.LINE_HEIGHT> in HTML output. Default is 1.\n */\nmxSvgCanvas2D.prototype.lineHeightCorrection = 1;\n\n/**\n * Variable: pointerEventsValue\n * \n * Default value for active pointer events. Default is all.\n */\nmxSvgCanvas2D.prototype.pointerEventsValue = 'all';\n\n/**\n * Variable: fontMetricsPadding\n * \n * Padding to be added for text that is not wrapped to account for differences\n * in font metrics on different platforms in pixels. Default is 10.\n */\nmxSvgCanvas2D.prototype.fontMetricsPadding = 10;\n\n/**\n * Variable: cacheOffsetSize\n * \n * Specifies if offsetWidth and offsetHeight should be cached. Default is true.\n * This is used to speed up repaint of text in <updateText>.\n */\nmxSvgCanvas2D.prototype.cacheOffsetSize = true;\n\n/**\n * Function: format\n * \n * Rounds all numbers to 2 decimal points.\n */\nmxSvgCanvas2D.prototype.format = function(value)\n{\n\treturn parseFloat(parseFloat(value).toFixed(2));\n};\n\n/**\n * Function: getBaseUrl\n * \n * Returns the URL of the page without the hash part. This needs to use href to\n * include any search part with no params (ie question mark alone). This is a\n * workaround for the fact that window.location.search is empty if there is\n * no search string behind the question mark.\n */\nmxSvgCanvas2D.prototype.getBaseUrl = function()\n{\n\tvar href = window.location.href;\n\tvar hash = href.lastIndexOf('#');\n\t\n\tif (hash > 0)\n\t{\n\t\thref = href.substring(0, hash);\n\t}\n\t\n\treturn href;\n};\n\n/**\n * Function: reset\n * \n * Returns any offsets for rendering pixels.\n */\nmxSvgCanvas2D.prototype.reset = function()\n{\n\tmxAbstractCanvas2D.prototype.reset.apply(this, arguments);\n\tthis.gradients = [];\n};\n\n/**\n * Function: createStyle\n * \n * Creates the optional style section.\n */\nmxSvgCanvas2D.prototype.createStyle = function(x)\n{\n\tvar style = this.createElement('style');\n\tstyle.setAttribute('type', 'text/css');\n\tmxUtils.write(style, 'svg{font-family:' + mxConstants.DEFAULT_FONTFAMILY +\n\t\t\t';font-size:' + mxConstants.DEFAULT_FONTSIZE +\n\t\t\t';fill:none;stroke-miterlimit:10}');\n\t\n\treturn style;\n};\n\n/**\n * Function: createElement\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.createElement = function(tagName, namespace)\n{\n\tif (this.root.ownerDocument.createElementNS != null)\n\t{\n\t\treturn this.root.ownerDocument.createElementNS(namespace || mxConstants.NS_SVG, tagName);\n\t}\n\telse\n\t{\n\t\tvar elt = this.root.ownerDocument.createElement(tagName);\n\t\t\n\t\tif (namespace != null)\n\t\t{\n\t\t\telt.setAttribute('xmlns', namespace);\n\t\t}\n\t\t\n\t\treturn elt;\n\t}\n};\n\n/**\n * Function: getAlternateContent\n * \n * Returns the alternate content for the given foreignObject.\n */\nmxSvgCanvas2D.prototype.createAlternateContent = function(fo, x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation)\n{\n\tif (this.foAltText != null)\n\t{\n\t\tvar s = this.state;\n\t\tvar alt = this.createElement('text');\n\t\talt.setAttribute('x', Math.round(w / 2));\n\t\talt.setAttribute('y', Math.round((h + s.fontSize) / 2));\n\t\talt.setAttribute('fill', s.fontColor || 'black');\n\t\talt.setAttribute('text-anchor', 'middle');\n\t\talt.setAttribute('font-size', s.fontSize + 'px');\n\t\talt.setAttribute('font-family', s.fontFamily);\n\t\t\n\t\tif ((s.fontStyle & mxConstants.FONT_BOLD) == mxConstants.FONT_BOLD)\n\t\t{\n\t\t\talt.setAttribute('font-weight', 'bold');\n\t\t}\n\t\t\n\t\tif ((s.fontStyle & mxConstants.FONT_ITALIC) == mxConstants.FONT_ITALIC)\n\t\t{\n\t\t\talt.setAttribute('font-style', 'italic');\n\t\t}\n\t\t\n\t\tif ((s.fontStyle & mxConstants.FONT_UNDERLINE) == mxConstants.FONT_UNDERLINE)\n\t\t{\n\t\t\talt.setAttribute('text-decoration', 'underline');\n\t\t}\n\t\t\n\t\tmxUtils.write(alt, this.foAltText);\n\t\t\n\t\treturn alt;\n\t}\n\telse\n\t{\n\t\treturn null;\n\t}\n};\n\n/**\n * Function: createGradientId\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.createGradientId = function(start, end, alpha1, alpha2, direction)\n{\n\t// Removes illegal characters from gradient ID\n\tif (start.charAt(0) == '#')\n\t{\n\t\tstart = start.substring(1);\n\t}\n\t\n\tif (end.charAt(0) == '#')\n\t{\n\t\tend = end.substring(1);\n\t}\n\t\n\t// Workaround for gradient IDs not working in Safari 5 / Chrome 6\n\t// if they contain uppercase characters\n\tstart = start.toLowerCase() + '-' + alpha1;\n\tend = end.toLowerCase() + '-' + alpha2;\n\n\t// Wrong gradient directions possible?\n\tvar dir = null;\n\t\n\tif (direction == null || direction == mxConstants.DIRECTION_SOUTH)\n\t{\n\t\tdir = 's';\n\t}\n\telse if (direction == mxConstants.DIRECTION_EAST)\n\t{\n\t\tdir = 'e';\n\t}\n\telse\n\t{\n\t\tvar tmp = start;\n\t\tstart = end;\n\t\tend = tmp;\n\t\t\n\t\tif (direction == mxConstants.DIRECTION_NORTH)\n\t\t{\n\t\t\tdir = 's';\n\t\t}\n\t\telse if (direction == mxConstants.DIRECTION_WEST)\n\t\t{\n\t\t\tdir = 'e';\n\t\t}\n\t}\n\t\n\treturn 'mx-gradient-' + start + '-' + end + '-' + dir;\n};\n\n/**\n * Function: getSvgGradient\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.getSvgGradient = function(start, end, alpha1, alpha2, direction)\n{\n\tvar id = this.createGradientId(start, end, alpha1, alpha2, direction);\n\tvar gradient = this.gradients[id];\n\t\n\tif (gradient == null)\n\t{\n\t\tvar svg = this.root.ownerSVGElement;\n\n\t\tvar counter = 0;\n\t\tvar tmpId = id + '-' + counter;\n\n\t\tif (svg != null)\n\t\t{\n\t\t\tgradient = svg.ownerDocument.getElementById(tmpId);\n\t\t\t\n\t\t\twhile (gradient != null && gradient.ownerSVGElement != svg)\n\t\t\t{\n\t\t\t\ttmpId = id + '-' + counter++;\n\t\t\t\tgradient = svg.ownerDocument.getElementById(tmpId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Uses shorter IDs for export\n\t\t\ttmpId = 'id' + (++this.refCount);\n\t\t}\n\t\t\n\t\tif (gradient == null)\n\t\t{\n\t\t\tgradient = this.createSvgGradient(start, end, alpha1, alpha2, direction);\n\t\t\tgradient.setAttribute('id', tmpId);\n\t\t\t\n\t\t\tif (this.defs != null)\n\t\t\t{\n\t\t\t\tthis.defs.appendChild(gradient);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsvg.appendChild(gradient);\n\t\t\t}\n\t\t}\n\n\t\tthis.gradients[id] = gradient;\n\t}\n\n\treturn gradient.getAttribute('id');\n};\n\n/**\n * Function: createSvgGradient\n * \n * Creates the given SVG gradient.\n */\nmxSvgCanvas2D.prototype.createSvgGradient = function(start, end, alpha1, alpha2, direction)\n{\n\tvar gradient = this.createElement('linearGradient');\n\tgradient.setAttribute('x1', '0%');\n\tgradient.setAttribute('y1', '0%');\n\tgradient.setAttribute('x2', '0%');\n\tgradient.setAttribute('y2', '0%');\n\t\n\tif (direction == null || direction == mxConstants.DIRECTION_SOUTH)\n\t{\n\t\tgradient.setAttribute('y2', '100%');\n\t}\n\telse if (direction == mxConstants.DIRECTION_EAST)\n\t{\n\t\tgradient.setAttribute('x2', '100%');\n\t}\n\telse if (direction == mxConstants.DIRECTION_NORTH)\n\t{\n\t\tgradient.setAttribute('y1', '100%');\n\t}\n\telse if (direction == mxConstants.DIRECTION_WEST)\n\t{\n\t\tgradient.setAttribute('x1', '100%');\n\t}\n\t\n\tvar op = (alpha1 < 1) ? ';stop-opacity:' + alpha1 : '';\n\t\n\tvar stop = this.createElement('stop');\n\tstop.setAttribute('offset', '0%');\n\tstop.setAttribute('style', 'stop-color:' + start + op);\n\tgradient.appendChild(stop);\n\t\n\top = (alpha2 < 1) ? ';stop-opacity:' + alpha2 : '';\n\t\n\tstop = this.createElement('stop');\n\tstop.setAttribute('offset', '100%');\n\tstop.setAttribute('style', 'stop-color:' + end + op);\n\tgradient.appendChild(stop);\n\t\n\treturn gradient;\n};\n\n/**\n * Function: addNode\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.addNode = function(filled, stroked)\n{\n\tvar node = this.node;\n\tvar s = this.state;\n\n\tif (node != null)\n\t{\n\t\tif (node.nodeName == 'path')\n\t\t{\n\t\t\t// Checks if the path is not empty\n\t\t\tif (this.path != null && this.path.length > 0)\n\t\t\t{\n\t\t\t\tnode.setAttribute('d', this.path.join(' '));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (filled && s.fillColor != null)\n\t\t{\n\t\t\tthis.updateFill();\n\t\t}\n\t\telse if (!this.styleEnabled)\n\t\t{\n\t\t\t// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=814952\n\t\t\tif (node.nodeName == 'ellipse' && mxClient.IS_FF)\n\t\t\t{\n\t\t\t\tnode.setAttribute('fill', 'transparent');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnode.setAttribute('fill', 'none');\n\t\t\t}\n\t\t\t\n\t\t\t// Sets the actual filled state for stroke tolerance\n\t\t\tfilled = false;\n\t\t}\n\t\t\n\t\tif (stroked && s.strokeColor != null)\n\t\t{\n\t\t\tthis.updateStroke();\n\t\t}\n\t\telse if (!this.styleEnabled)\n\t\t{\n\t\t\tnode.setAttribute('stroke', 'none');\n\t\t}\n\t\t\n\t\tif (s.transform != null && s.transform.length > 0)\n\t\t{\n\t\t\tnode.setAttribute('transform', s.transform);\n\t\t}\n\t\t\n\t\tif (s.shadow)\n\t\t{\n\t\t\tthis.root.appendChild(this.createShadow(node));\n\t\t}\n\t\n\t\t// Adds stroke tolerance\n\t\tif (this.strokeTolerance > 0 && !filled)\n\t\t{\n\t\t\tthis.root.appendChild(this.createTolerance(node));\n\t\t}\n\n\t\t// Adds pointer events\n\t\tif (this.pointerEvents && (node.nodeName != 'path' ||\n\t\t\tthis.path[this.path.length - 1] == this.closeOp))\n\t\t{\n\t\t\tnode.setAttribute('pointer-events', this.pointerEventsValue);\n\t\t}\n\t\t// Enables clicks for nodes inside a link element\n\t\telse if (!this.pointerEvents && this.originalRoot == null)\n\t\t{\n\t\t\tnode.setAttribute('pointer-events', 'none');\n\t\t}\n\t\t\n\t\t// Removes invisible nodes from output if they don't handle events\n\t\tif ((node.nodeName != 'rect' && node.nodeName != 'path' && node.nodeName != 'ellipse') ||\n\t\t\t(node.getAttribute('fill') != 'none' && node.getAttribute('fill') != 'transparent') ||\n\t\t\tnode.getAttribute('stroke') != 'none' || node.getAttribute('pointer-events') != 'none')\n\t\t{\n\t\t\t// LATER: Update existing DOM for performance\t\t\n\t\t\tthis.root.appendChild(node);\n\t\t}\n\t\t\n\t\tthis.node = null;\n\t}\n};\n\n/**\n * Function: updateFill\n * \n * Transfers the stroke attributes from <state> to <node>.\n */\nmxSvgCanvas2D.prototype.updateFill = function()\n{\n\tvar s = this.state;\n\t\n\tif (s.alpha < 1 || s.fillAlpha < 1)\n\t{\n\t\tthis.node.setAttribute('fill-opacity', s.alpha * s.fillAlpha);\n\t}\n\t\n\tif (s.fillColor != null)\n\t{\n\t\tif (s.gradientColor != null)\n\t\t{\n\t\t\tvar id = this.getSvgGradient(s.fillColor, s.gradientColor, s.gradientFillAlpha, s.gradientAlpha, s.gradientDirection);\n\t\t\t\n\t\t\tif (!mxClient.IS_CHROME_APP && !mxClient.IS_IE && !mxClient.IS_IE11 &&\n\t\t\t\t!mxClient.IS_EDGE && this.root.ownerDocument == document)\n\t\t\t{\n\t\t\t\t// Workaround for potential base tag and brackets must be escaped\n\t\t\t\tvar base = this.getBaseUrl().replace(/([\\(\\)])/g, '\\\\$1');\n\t\t\t\tthis.node.setAttribute('fill', 'url(' + base + '#' + id + ')');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.node.setAttribute('fill', 'url(#' + id + ')');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.node.setAttribute('fill', s.fillColor.toLowerCase());\n\t\t}\n\t}\n};\n\n/**\n * Function: getCurrentStrokeWidth\n * \n * Returns the current stroke width (>= 1), ie. max(1, this.format(this.state.strokeWidth * this.state.scale)).\n */\nmxSvgCanvas2D.prototype.getCurrentStrokeWidth = function()\n{\n\treturn Math.max(this.minStrokeWidth, Math.max(0.01, this.format(this.state.strokeWidth * this.state.scale)));\n};\n\n/**\n * Function: updateStroke\n * \n * Transfers the stroke attributes from <state> to <node>.\n */\nmxSvgCanvas2D.prototype.updateStroke = function()\n{\n\tvar s = this.state;\n\n\tthis.node.setAttribute('stroke', s.strokeColor.toLowerCase());\n\t\n\tif (s.alpha < 1 || s.strokeAlpha < 1)\n\t{\n\t\tthis.node.setAttribute('stroke-opacity', s.alpha * s.strokeAlpha);\n\t}\n\t\n\tvar sw = this.getCurrentStrokeWidth();\n\t\n\tif (sw != 1)\n\t{\n\t\tthis.node.setAttribute('stroke-width', sw);\n\t}\n\t\n\tif (this.node.nodeName == 'path')\n\t{\n\t\tthis.updateStrokeAttributes();\n\t}\n\t\n\tif (s.dashed)\n\t{\n\t\tthis.node.setAttribute('stroke-dasharray', this.createDashPattern(\n\t\t\t((s.fixDash) ? 1 : s.strokeWidth) * s.scale));\n\t}\n};\n\n/**\n * Function: updateStrokeAttributes\n * \n * Transfers the stroke attributes from <state> to <node>.\n */\nmxSvgCanvas2D.prototype.updateStrokeAttributes = function()\n{\n\tvar s = this.state;\n\t\n\t// Linejoin miter is default in SVG\n\tif (s.lineJoin != null && s.lineJoin != 'miter')\n\t{\n\t\tthis.node.setAttribute('stroke-linejoin', s.lineJoin);\n\t}\n\t\n\tif (s.lineCap != null)\n\t{\n\t\t// flat is called butt in SVG\n\t\tvar value = s.lineCap;\n\t\t\n\t\tif (value == 'flat')\n\t\t{\n\t\t\tvalue = 'butt';\n\t\t}\n\t\t\n\t\t// Linecap butt is default in SVG\n\t\tif (value != 'butt')\n\t\t{\n\t\t\tthis.node.setAttribute('stroke-linecap', value);\n\t\t}\n\t}\n\t\n\t// Miterlimit 10 is default in our document\n\tif (s.miterLimit != null && (!this.styleEnabled || s.miterLimit != 10))\n\t{\n\t\tthis.node.setAttribute('stroke-miterlimit', s.miterLimit);\n\t}\n};\n\n/**\n * Function: createDashPattern\n * \n * Creates the SVG dash pattern for the given state.\n */\nmxSvgCanvas2D.prototype.createDashPattern = function(scale)\n{\n\tvar pat = [];\n\t\n\tif (typeof(this.state.dashPattern) === 'string')\n\t{\n\t\tvar dash = this.state.dashPattern.split(' ');\n\t\t\n\t\tif (dash.length > 0)\n\t\t{\n\t\t\tfor (var i = 0; i < dash.length; i++)\n\t\t\t{\n\t\t\t\tpat[i] = Number(dash[i]) * scale;\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn pat.join(' ');\n};\n\n/**\n * Function: createTolerance\n * \n * Creates a hit detection tolerance shape for the given node.\n */\nmxSvgCanvas2D.prototype.createTolerance = function(node)\n{\n\tvar tol = node.cloneNode(true);\n\tvar sw = parseFloat(tol.getAttribute('stroke-width') || 1) + this.strokeTolerance;\n\ttol.setAttribute('pointer-events', 'stroke');\n\ttol.setAttribute('visibility', 'hidden');\n\ttol.removeAttribute('stroke-dasharray');\n\ttol.setAttribute('stroke-width', sw);\n\ttol.setAttribute('fill', 'none');\n\t\n\t// Workaround for Opera ignoring the visiblity attribute above while\n\t// other browsers need a stroke color to perform the hit-detection but\n\t// do not ignore the visibility attribute. Side-effect is that Opera's\n\t// hit detection for horizontal/vertical edges seems to ignore the tol.\n\ttol.setAttribute('stroke', (mxClient.IS_OT) ? 'none' : 'white');\n\t\n\treturn tol;\n};\n\n/**\n * Function: createShadow\n * \n * Creates a shadow for the given node.\n */\nmxSvgCanvas2D.prototype.createShadow = function(node)\n{\n\tvar shadow = node.cloneNode(true);\n\tvar s = this.state;\n\n\t// Firefox uses transparent for no fill in ellipses\n\tif (shadow.getAttribute('fill') != 'none' && (!mxClient.IS_FF || shadow.getAttribute('fill') != 'transparent'))\n\t{\n\t\tshadow.setAttribute('fill', s.shadowColor);\n\t}\n\t\n\tif (shadow.getAttribute('stroke') != 'none')\n\t{\n\t\tshadow.setAttribute('stroke', s.shadowColor);\n\t}\n\n\tshadow.setAttribute('transform', 'translate(' + this.format(s.shadowDx * s.scale) +\n\t\t',' + this.format(s.shadowDy * s.scale) + ')' + (s.transform || ''));\n\tshadow.setAttribute('opacity', s.shadowAlpha);\n\t\n\treturn shadow;\n};\n\n/**\n * Function: setLink\n * \n * Experimental implementation for hyperlinks.\n */\nmxSvgCanvas2D.prototype.setLink = function(link)\n{\n\tif (link == null)\n\t{\n\t\tthis.root = this.originalRoot;\n\t}\n\telse\n\t{\n\t\tthis.originalRoot = this.root;\n\t\t\n\t\tvar node = this.createElement('a');\n\t\t\n\t\t// Workaround for implicit namespace handling in HTML5 export, IE adds NS1 namespace so use code below\n\t\t// in all IE versions except quirks mode. KNOWN: Adds xlink namespace to each image tag in output.\n\t\tif (node.setAttributeNS == null || (this.root.ownerDocument != document && document.documentMode == null))\n\t\t{\n\t\t\tnode.setAttribute('xlink:href', link);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnode.setAttributeNS(mxConstants.NS_XLINK, 'xlink:href', link);\n\t\t}\n\t\t\n\t\tthis.root.appendChild(node);\n\t\tthis.root = node;\n\t}\n};\n\n/**\n * Function: rotate\n * \n * Sets the rotation of the canvas. Note that rotation cannot be concatenated.\n */\nmxSvgCanvas2D.prototype.rotate = function(theta, flipH, flipV, cx, cy)\n{\n\tif (theta != 0 || flipH || flipV)\n\t{\n\t\tvar s = this.state;\n\t\tcx += s.dx;\n\t\tcy += s.dy;\n\t\n\t\tcx *= s.scale;\n\t\tcy *= s.scale;\n\n\t\ts.transform = s.transform || '';\n\t\t\n\t\t// This implementation uses custom scale/translate and built-in rotation\n\t\t// Rotation state is part of the AffineTransform in state.transform\n\t\tif (flipH && flipV)\n\t\t{\n\t\t\ttheta += 180;\n\t\t}\n\t\telse if (flipH != flipV)\n\t\t{\n\t\t\tvar tx = (flipH) ? cx : 0;\n\t\t\tvar sx = (flipH) ? -1 : 1;\n\t\n\t\t\tvar ty = (flipV) ? cy : 0;\n\t\t\tvar sy = (flipV) ? -1 : 1;\n\n\t\t\ts.transform += 'translate(' + this.format(tx) + ',' + this.format(ty) + ')' +\n\t\t\t\t'scale(' + this.format(sx) + ',' + this.format(sy) + ')' +\n\t\t\t\t'translate(' + this.format(-tx) + ',' + this.format(-ty) + ')';\n\t\t}\n\t\t\n\t\tif (flipH ? !flipV : flipV)\n\t\t{\n\t\t\ttheta *= -1;\n\t\t}\n\t\t\n\t\tif (theta != 0)\n\t\t{\n\t\t\ts.transform += 'rotate(' + this.format(theta) + ',' + this.format(cx) + ',' + this.format(cy) + ')';\n\t\t}\n\t\t\n\t\ts.rotation = s.rotation + theta;\n\t\ts.rotationCx = cx;\n\t\ts.rotationCy = cy;\n\t}\n};\n\n/**\n * Function: begin\n * \n * Extends superclass to create path.\n */\nmxSvgCanvas2D.prototype.begin = function()\n{\n\tmxAbstractCanvas2D.prototype.begin.apply(this, arguments);\n\tthis.node = this.createElement('path');\n};\n\n/**\n * Function: rect\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.rect = function(x, y, w, h)\n{\n\tvar s = this.state;\n\tvar n = this.createElement('rect');\n\tn.setAttribute('x', this.format((x + s.dx) * s.scale));\n\tn.setAttribute('y', this.format((y + s.dy) * s.scale));\n\tn.setAttribute('width', this.format(w * s.scale));\n\tn.setAttribute('height', this.format(h * s.scale));\n\t\n\tthis.node = n;\n};\n\n/**\n * Function: roundrect\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.roundrect = function(x, y, w, h, dx, dy)\n{\n\tthis.rect(x, y, w, h);\n\t\n\tif (dx > 0)\n\t{\n\t\tthis.node.setAttribute('rx', this.format(dx * this.state.scale));\n\t}\n\t\n\tif (dy > 0)\n\t{\n\t\tthis.node.setAttribute('ry', this.format(dy * this.state.scale));\n\t}\n};\n\n/**\n * Function: ellipse\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.ellipse = function(x, y, w, h)\n{\n\tvar s = this.state;\n\tvar n = this.createElement('ellipse');\n\t// No rounding for consistent output with 1.x\n\tn.setAttribute('cx', Math.round((x + w / 2 + s.dx) * s.scale));\n\tn.setAttribute('cy', Math.round((y + h / 2 + s.dy) * s.scale));\n\tn.setAttribute('rx', w / 2 * s.scale);\n\tn.setAttribute('ry', h / 2 * s.scale);\n\tthis.node = n;\n};\n\n/**\n * Function: image\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.image = function(x, y, w, h, src, aspect, flipH, flipV)\n{\n\tsrc = this.converter.convert(src);\n\t\n\t// LATER: Add option for embedding images as base64.\n\taspect = (aspect != null) ? aspect : true;\n\tflipH = (flipH != null) ? flipH : false;\n\tflipV = (flipV != null) ? flipV : false;\n\t\n\tvar s = this.state;\n\tx += s.dx;\n\ty += s.dy;\n\t\n\tvar node = this.createElement('image');\n\tnode.setAttribute('x', this.format(x * s.scale) + this.imageOffset);\n\tnode.setAttribute('y', this.format(y * s.scale) + this.imageOffset);\n\tnode.setAttribute('width', this.format(w * s.scale));\n\tnode.setAttribute('height', this.format(h * s.scale));\n\t\n\t// Workaround for missing namespace support\n\tif (node.setAttributeNS == null)\n\t{\n\t\tnode.setAttribute('xlink:href', src);\n\t}\n\telse\n\t{\n\t\tnode.setAttributeNS(mxConstants.NS_XLINK, 'xlink:href', src);\n\t}\n\t\n\tif (!aspect)\n\t{\n\t\tnode.setAttribute('preserveAspectRatio', 'none');\n\t}\n\n\tif (s.alpha < 1 || s.fillAlpha < 1)\n\t{\n\t\tnode.setAttribute('opacity', s.alpha * s.fillAlpha);\n\t}\n\t\n\tvar tr = this.state.transform || '';\n\t\n\tif (flipH || flipV)\n\t{\n\t\tvar sx = 1;\n\t\tvar sy = 1;\n\t\tvar dx = 0;\n\t\tvar dy = 0;\n\t\t\n\t\tif (flipH)\n\t\t{\n\t\t\tsx = -1;\n\t\t\tdx = -w - 2 * x;\n\t\t}\n\t\t\n\t\tif (flipV)\n\t\t{\n\t\t\tsy = -1;\n\t\t\tdy = -h - 2 * y;\n\t\t}\n\t\t\n\t\t// Adds image tansformation to existing transform\n\t\ttr += 'scale(' + sx + ',' + sy + ')translate(' + (dx * s.scale) + ',' + (dy * s.scale) + ')';\n\t}\n\n\tif (tr.length > 0)\n\t{\n\t\tnode.setAttribute('transform', tr);\n\t}\n\t\n\tif (!this.pointerEvents)\n\t{\n\t\tnode.setAttribute('pointer-events', 'none');\n\t}\n\t\n\tthis.root.appendChild(node);\n\t\n\t// Disables control-clicks on images in Firefox to open in new tab\n\t// by putting a rect in the foreground that absorbs all events and\n\t// disabling all pointer-events on the original image tag.\n\tif (this.blockImagePointerEvents)\n\t{\n\t\tnode.setAttribute('style', 'pointer-events:none');\n\t\t\n\t\tnode = this.createElement('rect');\n\t\tnode.setAttribute('visibility', 'hidden');\n\t\tnode.setAttribute('pointer-events', 'fill');\n\t\tnode.setAttribute('x', this.format(x * s.scale));\n\t\tnode.setAttribute('y', this.format(y * s.scale));\n\t\tnode.setAttribute('width', this.format(w * s.scale));\n\t\tnode.setAttribute('height', this.format(h * s.scale));\n\t\tthis.root.appendChild(node);\n\t}\n};\n\n/**\n * Function: convertHtml\n * \n * Converts the given HTML string to XHTML.\n */\nmxSvgCanvas2D.prototype.convertHtml = function(val)\n{\n\tif (this.useDomParser)\n\t{\n\t\tvar doc = new DOMParser().parseFromString(val, 'text/html');\n\n\t\tif (doc != null)\n\t\t{\n\t\t\tval = new XMLSerializer().serializeToString(doc.body);\n\t\t\t\n\t\t\t// Extracts body content from DOM\n\t\t\tif (val.substring(0, 5) == '<body')\n\t\t\t{\n\t\t\t\tval = val.substring(val.indexOf('>', 5) + 1);\n\t\t\t}\n\t\t\t\n\t\t\tif (val.substring(val.length - 7, val.length) == '</body>')\n\t\t\t{\n\t\t\t\tval = val.substring(0, val.length - 7);\n\t\t\t}\n\t\t}\n\t}\n\telse if (document.implementation != null && document.implementation.createDocument != null)\n\t{\n\t\tvar xd = document.implementation.createDocument('http://www.w3.org/1999/xhtml', 'html', null);\n\t\tvar xb = xd.createElement('body');\n\t\txd.documentElement.appendChild(xb);\n\t\t\n\t\tvar div = document.createElement('div');\n\t\tdiv.innerHTML = val;\n\t\tvar child = div.firstChild;\n\t\t\n\t\twhile (child != null)\n\t\t{\n\t\t\tvar next = child.nextSibling;\n\t\t\txb.appendChild(xd.adoptNode(child));\n\t\t\tchild = next;\n\t\t}\n\t\t\n\t\treturn xb.innerHTML;\n\t}\n\telse\n\t{\n\t\tvar ta = document.createElement('textarea');\n\t\t\n\t\t// Handles special HTML entities < and > and double escaping\n\t\t// and converts unclosed br, hr and img tags to XHTML\n\t\t// LATER: Convert all unclosed tags\n\t\tta.innerHTML = val.replace(/&amp;/g, '&amp;amp;').\n\t\t\treplace(/&#60;/g, '&amp;lt;').replace(/&#62;/g, '&amp;gt;').\n\t\t\treplace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;').\n\t\t\treplace(/</g, '&lt;').replace(/>/g, '&gt;');\n\t\tval = ta.value.replace(/&/g, '&amp;').replace(/&amp;lt;/g, '&lt;').\n\t\t\treplace(/&amp;gt;/g, '&gt;').replace(/&amp;amp;/g, '&amp;').\n\t\t\treplace(/<br>/g, '<br />').replace(/<hr>/g, '<hr />').\n\t\t\treplace(/(<img[^>]+)>/gm, \"$1 />\");\n\t}\n\t\n\treturn val;\n};\n\n/**\n * Function: createDiv\n * \n * Private helper function to create SVG elements\n */\nmxSvgCanvas2D.prototype.createDiv = function(str, align, valign, style, overflow)\n{\n\tvar s = this.state;\n\n\t// Inline block for rendering HTML background over SVG in Safari\n\tvar lh = (mxConstants.ABSOLUTE_LINE_HEIGHT) ? (s.fontSize * mxConstants.LINE_HEIGHT) + 'px' :\n\t\t(mxConstants.LINE_HEIGHT * this.lineHeightCorrection);\n\t\n\tstyle = 'display:inline-block;font-size:' + s.fontSize + 'px;font-family:' + s.fontFamily +\n\t\t';color:' + s.fontColor + ';line-height:' + lh + ';' + style;\n\n\tif ((s.fontStyle & mxConstants.FONT_BOLD) == mxConstants.FONT_BOLD)\n\t{\n\t\tstyle += 'font-weight:bold;';\n\t}\n\n\tif ((s.fontStyle & mxConstants.FONT_ITALIC) == mxConstants.FONT_ITALIC)\n\t{\n\t\tstyle += 'font-style:italic;';\n\t}\n\t\n\tif ((s.fontStyle & mxConstants.FONT_UNDERLINE) == mxConstants.FONT_UNDERLINE)\n\t{\n\t\tstyle += 'text-decoration:underline;';\n\t}\n\t\n\tif (align == mxConstants.ALIGN_CENTER)\n\t{\n\t\tstyle += 'text-align:center;';\n\t}\n\telse if (align == mxConstants.ALIGN_RIGHT)\n\t{\n\t\tstyle += 'text-align:right;';\n\t}\n\n\tvar css = '';\n\t\n\tif (s.fontBackgroundColor != null)\n\t{\n\t\tcss += 'background-color:' + s.fontBackgroundColor + ';';\n\t}\n\t\n\tif (s.fontBorderColor != null)\n\t{\n\t\tcss += 'border:1px solid ' + s.fontBorderColor + ';';\n\t}\n\t\n\tvar val = str;\n\t\n\tif (!mxUtils.isNode(val))\n\t{\n\t\tval = this.convertHtml(val);\n\t\t\n\t\tif (overflow != 'fill' && overflow != 'width')\n\t\t{\n\t\t\t// Inner div always needed to measure wrapped text\n\t\t\tval = '<div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display:inline-block;text-align:inherit;text-decoration:inherit;' + css + '\">' + val + '</div>';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstyle += css;\n\t\t}\n\t}\n\n\t// Uses DOM API where available. This cannot be used in IE to avoid\n\t// an opening and two (!) closing TBODY tags being added to tables.\n\tif (!mxClient.IS_IE && document.createElementNS)\n\t{\n\t\tvar div = document.createElementNS('http://www.w3.org/1999/xhtml', 'div');\n\t\tdiv.setAttribute('style', style);\n\t\t\n\t\tif (mxUtils.isNode(val))\n\t\t{\n\t\t\t// Creates a copy for export\n\t\t\tif (this.root.ownerDocument != document)\n\t\t\t{\n\t\t\t\tdiv.appendChild(val.cloneNode(true));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdiv.appendChild(val);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdiv.innerHTML = val;\n\t\t}\n\t\t\n\t\treturn div;\n\t}\n\telse\n\t{\n\t\t// Serializes for export\n\t\tif (mxUtils.isNode(val) && this.root.ownerDocument != document)\n\t\t{\n\t\t\tval = val.outerHTML;\n\t\t}\n\n\t\t// NOTE: FF 3.6 crashes if content CSS contains \"height:100%\"\n\t\treturn mxUtils.parseXml('<div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"' + style + \n\t\t\t'\">' + val + '</div>').documentElement;\n\t}\n};\n\n/**\n * Invalidates the cached offset size for the given node.\n */\nmxSvgCanvas2D.prototype.invalidateCachedOffsetSize = function(node)\n{\n\tdelete node.firstChild.mxCachedOffsetWidth;\n\tdelete node.firstChild.mxCachedFinalOffsetWidth;\n\tdelete node.firstChild.mxCachedFinalOffsetHeight;\n};\n\n/**\n * Updates existing DOM nodes for text rendering. LATER: Merge common parts with text function below.\n */\nmxSvgCanvas2D.prototype.updateText = function(x, y, w, h, align, valign, wrap, overflow, clip, rotation, node)\n{\n\tif (node != null && node.firstChild != null && node.firstChild.firstChild != null &&\n\t\tnode.firstChild.firstChild.firstChild != null)\n\t{\n\t\t// Uses outer group for opacity and transforms to\n\t\t// fix rendering order in Chrome\n\t\tvar group = node.firstChild;\n\t\tvar fo = group.firstChild;\n\t\tvar div = fo.firstChild;\n\n\t\trotation = (rotation != null) ? rotation : 0;\n\t\t\n\t\tvar s = this.state;\n\t\tx += s.dx;\n\t\ty += s.dy;\n\t\t\n\t\tif (clip)\n\t\t{\n\t\t\tdiv.style.maxHeight = Math.round(h) + 'px';\n\t\t\tdiv.style.maxWidth = Math.round(w) + 'px';\n\t\t}\n\t\telse if (overflow == 'fill')\n\t\t{\n\t\t\tdiv.style.width = Math.round(w + 1) + 'px';\n\t\t\tdiv.style.height = Math.round(h + 1) + 'px';\n\t\t}\n\t\telse if (overflow == 'width')\n\t\t{\n\t\t\tdiv.style.width = Math.round(w + 1) + 'px';\n\t\t\t\n\t\t\tif (h > 0)\n\t\t\t{\n\t\t\t\tdiv.style.maxHeight = Math.round(h) + 'px';\n\t\t\t}\n\t\t}\n\n\t\tif (wrap && w > 0)\n\t\t{\n\t\t\tdiv.style.width = Math.round(w + 1) + 'px';\n\t\t}\n\t\t\n\t\t// Code that depends on the size which is computed after\n\t\t// the element was added to the DOM.\n\t\tvar ow = 0;\n\t\tvar oh = 0;\n\t\t\n\t\t// Padding avoids clipping on border and wrapping for differing font metrics on platforms\n\t\tvar padX = 0;\n\t\tvar padY = 2;\n\n\t\tvar sizeDiv = div;\n\t\t\n\t\tif (sizeDiv.firstChild != null && sizeDiv.firstChild.nodeName == 'DIV')\n\t\t{\n\t\t\tsizeDiv = sizeDiv.firstChild;\n\t\t}\n\t\t\n\t\tvar tmp = (group.mxCachedOffsetWidth != null) ? group.mxCachedOffsetWidth : sizeDiv.offsetWidth;\n\t\tow = tmp + padX;\n\n\t\t// Recomputes the height of the element for wrapped width\n\t\tif (wrap && overflow != 'fill')\n\t\t{\n\t\t\tif (clip)\n\t\t\t{\n\t\t\t\tow = Math.min(ow, w);\n\t\t\t}\n\t\t\t\n\t\t\tdiv.style.width = Math.round(ow + 1) + 'px';\n\t\t}\n\n\t\tow = (group.mxCachedFinalOffsetWidth != null) ? group.mxCachedFinalOffsetWidth : sizeDiv.offsetWidth;\n\t\toh = (group.mxCachedFinalOffsetHeight != null) ? group.mxCachedFinalOffsetHeight : sizeDiv.offsetHeight;\n\t\t\n\t\tif (this.cacheOffsetSize)\n\t\t{\n\t\t\tgroup.mxCachedOffsetWidth = tmp;\n\t\t\tgroup.mxCachedFinalOffsetWidth = ow;\n\t\t\tgroup.mxCachedFinalOffsetHeight = oh;\n\t\t}\n\t\t\n\t\tow += padX;\n\t\toh -= 2;\n\t\t\n\t\tif (clip)\n\t\t{\n\t\t\toh = Math.min(oh, h);\n\t\t\tow = Math.min(ow, w);\n\t\t}\n\n\t\tif (overflow == 'width')\n\t\t{\n\t\t\th = oh;\n\t\t}\n\t\telse if (overflow != 'fill')\n\t\t{\n\t\t\tw = ow;\n\t\t\th = oh;\n\t\t}\n\n\t\tvar dx = 0;\n\t\tvar dy = 0;\n\n\t\tif (align == mxConstants.ALIGN_CENTER)\n\t\t{\n\t\t\tdx -= w / 2;\n\t\t}\n\t\telse if (align == mxConstants.ALIGN_RIGHT)\n\t\t{\n\t\t\tdx -= w;\n\t\t}\n\t\t\n\t\tx += dx;\n\t\t\n\t\t// FIXME: LINE_HEIGHT not ideal for all text sizes, fix for export\n\t\tif (valign == mxConstants.ALIGN_MIDDLE)\n\t\t{\n\t\t\tdy -= h / 2;\n\t\t}\n\t\telse if (valign == mxConstants.ALIGN_BOTTOM)\n\t\t{\n\t\t\tdy -= h;\n\t\t}\n\t\t\n\t\t// Workaround for rendering offsets\n\t\t// TODO: Check if export needs these fixes, too\n\t\tif (overflow != 'fill' && mxClient.IS_FF && mxClient.IS_WIN)\n\t\t{\n\t\t\tdy -= 2;\n\t\t}\n\t\t\n\t\ty += dy;\n\n\t\tvar tr = (s.scale != 1) ? 'scale(' + s.scale + ')' : '';\n\n\t\tif (s.rotation != 0 && this.rotateHtml)\n\t\t{\n\t\t\ttr += 'rotate(' + (s.rotation) + ',' + (w / 2) + ',' + (h / 2) + ')';\n\t\t\tvar pt = this.rotatePoint((x + w / 2) * s.scale, (y + h / 2) * s.scale,\n\t\t\t\ts.rotation, s.rotationCx, s.rotationCy);\n\t\t\tx = pt.x - w * s.scale / 2;\n\t\t\ty = pt.y - h * s.scale / 2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tx *= s.scale;\n\t\t\ty *= s.scale;\n\t\t}\n\n\t\tif (rotation != 0)\n\t\t{\n\t\t\ttr += 'rotate(' + (rotation) + ',' + (-dx) + ',' + (-dy) + ')';\n\t\t}\n\n\t\tgroup.setAttribute('transform', 'translate(' + Math.round(x) + ',' + Math.round(y) + ')' + tr);\n\t\tfo.setAttribute('width', Math.round(Math.max(1, w)));\n\t\tfo.setAttribute('height', Math.round(Math.max(1, h)));\n\t}\n};\n\n/**\n * Function: text\n * \n * Paints the given text. Possible values for format are empty string for plain\n * text and html for HTML markup. Note that HTML markup is only supported if\n * foreignObject is supported and <foEnabled> is true. (This means IE9 and later\n * does currently not support HTML text as part of shapes.)\n */\nmxSvgCanvas2D.prototype.text = function(x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation, dir)\n{\n\tif (this.textEnabled && str != null)\n\t{\n\t\trotation = (rotation != null) ? rotation : 0;\n\t\t\n\t\tvar s = this.state;\n\t\tx += s.dx;\n\t\ty += s.dy;\n\t\t\n\t\tif (this.foEnabled && format == 'html')\n\t\t{\n\t\t\tvar style = 'vertical-align:top;';\n\t\t\t\n\t\t\tif (clip)\n\t\t\t{\n\t\t\t\tstyle += 'overflow:hidden;max-height:' + Math.round(h) + 'px;max-width:' + Math.round(w) + 'px;';\n\t\t\t}\n\t\t\telse if (overflow == 'fill')\n\t\t\t{\n\t\t\t\tstyle += 'width:' + Math.round(w + 1) + 'px;height:' + Math.round(h + 1) + 'px;overflow:hidden;';\n\t\t\t}\n\t\t\telse if (overflow == 'width')\n\t\t\t{\n\t\t\t\tstyle += 'width:' + Math.round(w + 1) + 'px;';\n\t\t\t\t\n\t\t\t\tif (h > 0)\n\t\t\t\t{\n\t\t\t\t\tstyle += 'max-height:' + Math.round(h) + 'px;overflow:hidden;';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (wrap && w > 0)\n\t\t\t{\n\t\t\t\tstyle += 'width:' + Math.round(w + 1) + 'px;white-space:normal;word-wrap:' +\n\t\t\t\t\tmxConstants.WORD_WRAP + ';';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstyle += 'white-space:nowrap;';\n\t\t\t}\n\t\t\t\n\t\t\t// Uses outer group for opacity and transforms to\n\t\t\t// fix rendering order in Chrome\n\t\t\tvar group = this.createElement('g');\n\t\t\t\n\t\t\tif (s.alpha < 1)\n\t\t\t{\n\t\t\t\tgroup.setAttribute('opacity', s.alpha);\n\t\t\t}\n\n\t\t\tvar fo = this.createElement('foreignObject');\n\t\t\tfo.setAttribute('style', 'overflow:visible;');\n\t\t\tfo.setAttribute('pointer-events', 'all');\n\t\t\t\n\t\t\tvar div = this.createDiv(str, align, valign, style, overflow);\n\t\t\t\n\t\t\t// Ignores invalid XHTML labels\n\t\t\tif (div == null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (dir != null)\n\t\t\t{\n\t\t\t\tdiv.setAttribute('dir', dir);\n\t\t\t}\n\n\t\t\tgroup.appendChild(fo);\n\t\t\tthis.root.appendChild(group);\n\t\t\t\n\t\t\t// Code that depends on the size which is computed after\n\t\t\t// the element was added to the DOM.\n\t\t\tvar ow = 0;\n\t\t\tvar oh = 0;\n\t\t\t\n\t\t\t// Padding avoids clipping on border and wrapping for differing font metrics on platforms\n\t\t\tvar padX = 2;\n\t\t\tvar padY = 2;\n\n\t\t\t// NOTE: IE is always export as it does not support foreign objects\n\t\t\tif (mxClient.IS_IE && (document.documentMode == 9 || !mxClient.IS_SVG))\n\t\t\t{\n\t\t\t\t// Handles non-standard namespace for getting size in IE\n\t\t\t\tvar clone = document.createElement('div');\n\t\t\t\t\n\t\t\t\tclone.style.cssText = div.getAttribute('style');\n\t\t\t\tclone.style.display = (mxClient.IS_QUIRKS) ? 'inline' : 'inline-block';\n\t\t\t\tclone.style.position = 'absolute';\n\t\t\t\tclone.style.visibility = 'hidden';\n\n\t\t\t\t// Inner DIV is needed for text measuring\n\t\t\t\tvar div2 = document.createElement('div');\n\t\t\t\tdiv2.style.display = (mxClient.IS_QUIRKS) ? 'inline' : 'inline-block';\n\t\t\t\tdiv2.style.wordWrap = mxConstants.WORD_WRAP;\n\t\t\t\tdiv2.innerHTML = (mxUtils.isNode(str)) ? str.outerHTML : str;\n\t\t\t\tclone.appendChild(div2);\n\n\t\t\t\tdocument.body.appendChild(clone);\n\n\t\t\t\t// Workaround for different box models\n\t\t\t\tif (document.documentMode != 8 && document.documentMode != 9 && s.fontBorderColor != null)\n\t\t\t\t{\n\t\t\t\t\tpadX += 2;\n\t\t\t\t\tpadY += 2;\n\t\t\t\t}\n\n\t\t\t\tif (wrap && w > 0)\n\t\t\t\t{\n\t\t\t\t\tvar tmp = div2.offsetWidth;\n\t\t\t\t\t\n\t\t\t\t\t// Workaround for adding padding twice in IE8/IE9 standards mode if label is wrapped\n\t\t\t\t\tpadDx = 0;\n\t\t\t\t\t\n\t\t\t\t\t// For export, if no wrapping occurs, we add a large padding to make\n\t\t\t\t\t// sure there is no wrapping even if the text metrics are different.\n\t\t\t\t\t// This adds support for text metrics on different operating systems.\n\t\t\t\t\t// Disables wrapping if text is not wrapped for given width\n\t\t\t\t\tif (!clip && wrap && w > 0 && this.root.ownerDocument != document && overflow != 'fill')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar ws = clone.style.whiteSpace;\n\t\t\t\t\t\tdiv2.style.whiteSpace = 'nowrap';\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (tmp < div2.offsetWidth)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclone.style.whiteSpace = ws;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (clip)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp = Math.min(tmp, w);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tclone.style.width = tmp + 'px';\n\t\n\t\t\t\t\t// Padding avoids clipping on border\n\t\t\t\t\tow = div2.offsetWidth + padX + padDx;\n\t\t\t\t\toh = div2.offsetHeight + padY;\n\t\t\t\t\t\n\t\t\t\t\t// Overrides the width of the DIV via XML DOM by using the\n\t\t\t\t\t// clone DOM style, getting the CSS text for that and\n\t\t\t\t\t// then setting that on the DIV via setAttribute\n\t\t\t\t\tclone.style.display = 'inline-block';\n\t\t\t\t\tclone.style.position = '';\n\t\t\t\t\tclone.style.visibility = '';\n\t\t\t\t\tclone.style.width = ow + 'px';\n\t\t\t\t\t\n\t\t\t\t\tdiv.setAttribute('style', clone.style.cssText);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t// Padding avoids clipping on border\n\t\t\t\t\tow = div2.offsetWidth + padX;\n\t\t\t\t\toh = div2.offsetHeight + padY;\n\t\t\t\t}\n\n\t\t\t\tclone.parentNode.removeChild(clone);\n\t\t\t\tfo.appendChild(div);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Uses document for text measuring during export\n\t\t\t\tif (this.root.ownerDocument != document)\n\t\t\t\t{\n\t\t\t\t\tdiv.style.visibility = 'hidden';\n\t\t\t\t\tdocument.body.appendChild(div);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfo.appendChild(div);\n\t\t\t\t}\n\n\t\t\t\tvar sizeDiv = div;\n\t\t\t\t\n\t\t\t\tif (sizeDiv.firstChild != null && sizeDiv.firstChild.nodeName == 'DIV')\n\t\t\t\t{\n\t\t\t\t\tsizeDiv = sizeDiv.firstChild;\n\t\t\t\t\t\n\t\t\t\t\tif (wrap && div.style.wordWrap == 'break-word')\n\t\t\t\t\t{\n\t\t\t\t\t\tsizeDiv.style.width = '100%';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar tmp = sizeDiv.offsetWidth;\n\t\t\t\t\n\t\t\t\t// Workaround for text measuring in hidden containers\n\t\t\t\tif (tmp == 0 && div.parentNode == fo)\n\t\t\t\t{\n\t\t\t\t\tdiv.style.visibility = 'hidden';\n\t\t\t\t\tdocument.body.appendChild(div);\n\t\t\t\t\t\n\t\t\t\t\ttmp = sizeDiv.offsetWidth;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this.cacheOffsetSize)\n\t\t\t\t{\n\t\t\t\t\tgroup.mxCachedOffsetWidth = tmp;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Disables wrapping if text is not wrapped for given width\n\t\t\t\tif (!clip && wrap && w > 0 && this.root.ownerDocument != document &&\n\t\t\t\t\toverflow != 'fill' && overflow != 'width')\n\t\t\t\t{\n\t\t\t\t\tvar ws = div.style.whiteSpace;\n\t\t\t\t\tdiv.style.whiteSpace = 'nowrap';\n\t\t\t\t\t\n\t\t\t\t\tif (tmp < sizeDiv.offsetWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiv.style.whiteSpace = ws;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tow = tmp + padX - 1;\n\n\t\t\t\t// Recomputes the height of the element for wrapped width\n\t\t\t\tif (wrap && overflow != 'fill' && overflow != 'width')\n\t\t\t\t{\n\t\t\t\t\tif (clip)\n\t\t\t\t\t{\n\t\t\t\t\t\tow = Math.min(ow, w);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdiv.style.width = ow + 'px';\n\t\t\t\t}\n\n\t\t\t\tow = sizeDiv.offsetWidth;\n\t\t\t\toh = sizeDiv.offsetHeight;\n\t\t\t\t\n\t\t\t\tif (this.cacheOffsetSize)\n\t\t\t\t{\n\t\t\t\t\tgroup.mxCachedFinalOffsetWidth = ow;\n\t\t\t\t\tgroup.mxCachedFinalOffsetHeight = oh;\n\t\t\t\t}\n\n\t\t\t\toh -= padY;\n\t\t\t\t\n\t\t\t\tif (div.parentNode != fo)\n\t\t\t\t{\n\t\t\t\t\tfo.appendChild(div);\n\t\t\t\t\tdiv.style.visibility = '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (clip)\n\t\t\t{\n\t\t\t\toh = Math.min(oh, h);\n\t\t\t\tow = Math.min(ow, w);\n\t\t\t}\n\n\t\t\tif (overflow == 'width')\n\t\t\t{\n\t\t\t\th = oh;\n\t\t\t}\n\t\t\telse if (overflow != 'fill')\n\t\t\t{\n\t\t\t\tw = ow;\n\t\t\t\th = oh;\n\t\t\t}\n\n\t\t\tif (s.alpha < 1)\n\t\t\t{\n\t\t\t\tgroup.setAttribute('opacity', s.alpha);\n\t\t\t}\n\t\t\t\n\t\t\tvar dx = 0;\n\t\t\tvar dy = 0;\n\n\t\t\tif (align == mxConstants.ALIGN_CENTER)\n\t\t\t{\n\t\t\t\tdx -= w / 2;\n\t\t\t}\n\t\t\telse if (align == mxConstants.ALIGN_RIGHT)\n\t\t\t{\n\t\t\t\tdx -= w;\n\t\t\t}\n\t\t\t\n\t\t\tx += dx;\n\t\t\t\n\t\t\t// FIXME: LINE_HEIGHT not ideal for all text sizes, fix for export\n\t\t\tif (valign == mxConstants.ALIGN_MIDDLE)\n\t\t\t{\n\t\t\t\tdy -= h / 2;\n\t\t\t}\n\t\t\telse if (valign == mxConstants.ALIGN_BOTTOM)\n\t\t\t{\n\t\t\t\tdy -= h;\n\t\t\t}\n\t\t\t\n\t\t\t// Workaround for rendering offsets\n\t\t\t// TODO: Check if export needs these fixes, too\n\t\t\t//if (this.root.ownerDocument == document)\n\t\t\tif (overflow != 'fill' && mxClient.IS_FF && mxClient.IS_WIN)\n\t\t\t{\n\t\t\t\tdy -= 2;\n\t\t\t}\n\t\t\t\n\t\t\ty += dy;\n\n\t\t\tvar tr = (s.scale != 1) ? 'scale(' + s.scale + ')' : '';\n\n\t\t\tif (s.rotation != 0 && this.rotateHtml)\n\t\t\t{\n\t\t\t\ttr += 'rotate(' + (s.rotation) + ',' + (w / 2) + ',' + (h / 2) + ')';\n\t\t\t\tvar pt = this.rotatePoint((x + w / 2) * s.scale, (y + h / 2) * s.scale,\n\t\t\t\t\ts.rotation, s.rotationCx, s.rotationCy);\n\t\t\t\tx = pt.x - w * s.scale / 2;\n\t\t\t\ty = pt.y - h * s.scale / 2;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tx *= s.scale;\n\t\t\t\ty *= s.scale;\n\t\t\t}\n\n\t\t\tif (rotation != 0)\n\t\t\t{\n\t\t\t\ttr += 'rotate(' + (rotation) + ',' + (-dx) + ',' + (-dy) + ')';\n\t\t\t}\n\n\t\t\tgroup.setAttribute('transform', 'translate(' + (Math.round(x) + this.foOffset) + ',' +\n\t\t\t\t(Math.round(y) + this.foOffset) + ')' + tr);\n\t\t\tfo.setAttribute('width', Math.round(Math.max(1, w)));\n\t\t\tfo.setAttribute('height', Math.round(Math.max(1, h)));\n\t\t\t\n\t\t\t// Adds alternate content if foreignObject not supported in viewer\n\t\t\tif (this.root.ownerDocument != document)\n\t\t\t{\n\t\t\t\tvar alt = this.createAlternateContent(fo, x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation);\n\t\t\t\t\n\t\t\t\tif (alt != null)\n\t\t\t\t{\n\t\t\t\t\tfo.setAttribute('requiredFeatures', 'http://www.w3.org/TR/SVG11/feature#Extensibility');\n\t\t\t\t\tvar sw = this.createElement('switch');\n\t\t\t\t\tsw.appendChild(fo);\n\t\t\t\t\tsw.appendChild(alt);\n\t\t\t\t\tgroup.appendChild(sw);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.plainText(x, y, w, h, str, align, valign, wrap, overflow, clip, rotation, dir);\n\t\t}\n\t}\n};\n\n/**\n * Function: createClip\n * \n * Creates a clip for the given coordinates.\n */\nmxSvgCanvas2D.prototype.createClip = function(x, y, w, h)\n{\n\tx = Math.round(x);\n\ty = Math.round(y);\n\tw = Math.round(w);\n\th = Math.round(h);\n\t\n\tvar id = 'mx-clip-' + x + '-' + y + '-' + w + '-' + h;\n\n\tvar counter = 0;\n\tvar tmp = id + '-' + counter;\n\t\n\t// Resolves ID conflicts\n\twhile (document.getElementById(tmp) != null)\n\t{\n\t\ttmp = id + '-' + (++counter);\n\t}\n\t\n\tclip = this.createElement('clipPath');\n\tclip.setAttribute('id', tmp);\n\t\n\tvar rect = this.createElement('rect');\n\trect.setAttribute('x', x);\n\trect.setAttribute('y', y);\n\trect.setAttribute('width', w);\n\trect.setAttribute('height', h);\n\t\t\n\tclip.appendChild(rect);\n\t\n\treturn clip;\n};\n\n/**\n * Function: text\n * \n * Paints the given text. Possible values for format are empty string for\n * plain text and html for HTML markup.\n */\nmxSvgCanvas2D.prototype.plainText = function(x, y, w, h, str, align, valign, wrap, overflow, clip, rotation, dir)\n{\n\trotation = (rotation != null) ? rotation : 0;\n\tvar s = this.state;\n\tvar size = s.fontSize;\n\tvar node = this.createElement('g');\n\tvar tr = s.transform || '';\n\tthis.updateFont(node);\n\t\n\t// Non-rotated text\n\tif (rotation != 0)\n\t{\n\t\ttr += 'rotate(' + rotation  + ',' + this.format(x * s.scale) + ',' + this.format(y * s.scale) + ')';\n\t}\n\t\n\tif (dir != null)\n\t{\n\t\tnode.setAttribute('direction', dir);\n\t}\n\n\tif (clip && w > 0 && h > 0)\n\t{\n\t\tvar cx = x;\n\t\tvar cy = y;\n\t\t\n\t\tif (align == mxConstants.ALIGN_CENTER)\n\t\t{\n\t\t\tcx -= w / 2;\n\t\t}\n\t\telse if (align == mxConstants.ALIGN_RIGHT)\n\t\t{\n\t\t\tcx -= w;\n\t\t}\n\t\t\n\t\tif (overflow != 'fill')\n\t\t{\n\t\t\tif (valign == mxConstants.ALIGN_MIDDLE)\n\t\t\t{\n\t\t\t\tcy -= h / 2;\n\t\t\t}\n\t\t\telse if (valign == mxConstants.ALIGN_BOTTOM)\n\t\t\t{\n\t\t\t\tcy -= h;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// LATER: Remove spacing from clip rectangle\n\t\tvar c = this.createClip(cx * s.scale - 2, cy * s.scale - 2, w * s.scale + 4, h * s.scale + 4);\n\t\t\n\t\tif (this.defs != null)\n\t\t{\n\t\t\tthis.defs.appendChild(c);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Makes sure clip is removed with referencing node\n\t\t\tthis.root.appendChild(c);\n\t\t}\n\t\t\n\t\tif (!mxClient.IS_CHROME_APP && !mxClient.IS_IE && !mxClient.IS_IE11 &&\n\t\t\t!mxClient.IS_EDGE && this.root.ownerDocument == document)\n\t\t{\n\t\t\t// Workaround for potential base tag\n\t\t\tvar base = this.getBaseUrl().replace(/([\\(\\)])/g, '\\\\$1');\n\t\t\tnode.setAttribute('clip-path', 'url(' + base + '#' + c.getAttribute('id') + ')');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnode.setAttribute('clip-path', 'url(#' + c.getAttribute('id') + ')');\n\t\t}\n\t}\n\n\t// Default is left\n\tvar anchor = (align == mxConstants.ALIGN_RIGHT) ? 'end' :\n\t\t\t\t\t(align == mxConstants.ALIGN_CENTER) ? 'middle' :\n\t\t\t\t\t'start';\n\n\t// Text-anchor start is default in SVG\n\tif (anchor != 'start')\n\t{\n\t\tnode.setAttribute('text-anchor', anchor);\n\t}\n\t\n\tif (!this.styleEnabled || size != mxConstants.DEFAULT_FONTSIZE)\n\t{\n\t\tnode.setAttribute('font-size', (size * s.scale) + 'px');\n\t}\n\t\n\tif (tr.length > 0)\n\t{\n\t\tnode.setAttribute('transform', tr);\n\t}\n\t\n\tif (s.alpha < 1)\n\t{\n\t\tnode.setAttribute('opacity', s.alpha);\n\t}\n\t\n\tvar lines = str.split('\\n');\n\tvar lh = Math.round(size * mxConstants.LINE_HEIGHT);\n\tvar textHeight = size + (lines.length - 1) * lh;\n\n\tvar cy = y + size - 1;\n\n\tif (valign == mxConstants.ALIGN_MIDDLE)\n\t{\n\t\tif (overflow == 'fill')\n\t\t{\n\t\t\tcy -= h / 2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar dy = ((this.matchHtmlAlignment && clip && h > 0) ? Math.min(textHeight, h) : textHeight) / 2;\n\t\t\tcy -= dy + 1;\n\t\t}\n\t}\n\telse if (valign == mxConstants.ALIGN_BOTTOM)\n\t{\n\t\tif (overflow == 'fill')\n\t\t{\n\t\t\tcy -= h;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar dy = (this.matchHtmlAlignment && clip && h > 0) ? Math.min(textHeight, h) : textHeight;\n\t\t\tcy -= dy + 2;\n\t\t}\n\t}\n\n\tfor (var i = 0; i < lines.length; i++)\n\t{\n\t\t// Workaround for bounding box of empty lines and spaces\n\t\tif (lines[i].length > 0 && mxUtils.trim(lines[i]).length > 0)\n\t\t{\n\t\t\tvar text = this.createElement('text');\n\t\t\t// LATER: Match horizontal HTML alignment\n\t\t\ttext.setAttribute('x', this.format(x * s.scale) + this.textOffset);\n\t\t\ttext.setAttribute('y', this.format(cy * s.scale) + this.textOffset);\n\t\t\t\n\t\t\tmxUtils.write(text, lines[i]);\n\t\t\tnode.appendChild(text);\n\t\t}\n\n\t\tcy += lh;\n\t}\n\n\tthis.root.appendChild(node);\n\tthis.addTextBackground(node, str, x, y, w, (overflow == 'fill') ? h : textHeight, align, valign, overflow);\n};\n\n/**\n * Function: updateFont\n * \n * Updates the text properties for the given node. (NOTE: For this to work in\n * IE, the given node must be a text or tspan element.)\n */\nmxSvgCanvas2D.prototype.updateFont = function(node)\n{\n\tvar s = this.state;\n\n\tnode.setAttribute('fill', s.fontColor);\n\t\n\tif (!this.styleEnabled || s.fontFamily != mxConstants.DEFAULT_FONTFAMILY)\n\t{\n\t\tnode.setAttribute('font-family', s.fontFamily);\n\t}\n\n\tif ((s.fontStyle & mxConstants.FONT_BOLD) == mxConstants.FONT_BOLD)\n\t{\n\t\tnode.setAttribute('font-weight', 'bold');\n\t}\n\n\tif ((s.fontStyle & mxConstants.FONT_ITALIC) == mxConstants.FONT_ITALIC)\n\t{\n\t\tnode.setAttribute('font-style', 'italic');\n\t}\n\t\n\tif ((s.fontStyle & mxConstants.FONT_UNDERLINE) == mxConstants.FONT_UNDERLINE)\n\t{\n\t\tnode.setAttribute('text-decoration', 'underline');\n\t}\n};\n\n/**\n * Function: addTextBackground\n * \n * Background color and border\n */\nmxSvgCanvas2D.prototype.addTextBackground = function(node, str, x, y, w, h, align, valign, overflow)\n{\n\tvar s = this.state;\n\n\tif (s.fontBackgroundColor != null || s.fontBorderColor != null)\n\t{\n\t\tvar bbox = null;\n\t\t\n\t\tif (overflow == 'fill' || overflow == 'width')\n\t\t{\n\t\t\tif (align == mxConstants.ALIGN_CENTER)\n\t\t\t{\n\t\t\t\tx -= w / 2;\n\t\t\t}\n\t\t\telse if (align == mxConstants.ALIGN_RIGHT)\n\t\t\t{\n\t\t\t\tx -= w;\n\t\t\t}\n\t\t\t\n\t\t\tif (valign == mxConstants.ALIGN_MIDDLE)\n\t\t\t{\n\t\t\t\ty -= h / 2;\n\t\t\t}\n\t\t\telse if (valign == mxConstants.ALIGN_BOTTOM)\n\t\t\t{\n\t\t\t\ty -= h;\n\t\t\t}\n\t\t\t\n\t\t\tbbox = new mxRectangle((x + 1) * s.scale, y * s.scale, (w - 2) * s.scale, (h + 2) * s.scale);\n\t\t}\n\t\telse if (node.getBBox != null && this.root.ownerDocument == document)\n\t\t{\n\t\t\t// Uses getBBox only if inside document for correct size\n\t\t\ttry\n\t\t\t{\n\t\t\t\tbbox = node.getBBox();\n\t\t\t\tvar ie = mxClient.IS_IE && mxClient.IS_SVG;\n\t\t\t\tbbox = new mxRectangle(bbox.x, bbox.y + ((ie) ? 0 : 1), bbox.width, bbox.height + ((ie) ? 1 : 0));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\t// Ignores NS_ERROR_FAILURE in FF if container display is none.\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Computes size if not in document or no getBBox available\n\t\t\tvar div = document.createElement('div');\n\n\t\t\t// Wrapping and clipping can be ignored here\n\t\t\tdiv.style.lineHeight = (mxConstants.ABSOLUTE_LINE_HEIGHT) ? (s.fontSize * mxConstants.LINE_HEIGHT) + 'px' : mxConstants.LINE_HEIGHT;\n\t\t\tdiv.style.fontSize = s.fontSize + 'px';\n\t\t\tdiv.style.fontFamily = s.fontFamily;\n\t\t\tdiv.style.whiteSpace = 'nowrap';\n\t\t\tdiv.style.position = 'absolute';\n\t\t\tdiv.style.visibility = 'hidden';\n\t\t\tdiv.style.display = (mxClient.IS_QUIRKS) ? 'inline' : 'inline-block';\n\t\t\tdiv.style.zoom = '1';\n\t\t\t\n\t\t\tif ((s.fontStyle & mxConstants.FONT_BOLD) == mxConstants.FONT_BOLD)\n\t\t\t{\n\t\t\t\tdiv.style.fontWeight = 'bold';\n\t\t\t}\n\n\t\t\tif ((s.fontStyle & mxConstants.FONT_ITALIC) == mxConstants.FONT_ITALIC)\n\t\t\t{\n\t\t\t\tdiv.style.fontStyle = 'italic';\n\t\t\t}\n\t\t\t\n\t\t\tstr = mxUtils.htmlEntities(str, false);\n\t\t\tdiv.innerHTML = str.replace(/\\n/g, '<br/>');\n\t\t\t\n\t\t\tdocument.body.appendChild(div);\n\t\t\tvar w = div.offsetWidth;\n\t\t\tvar h = div.offsetHeight;\n\t\t\tdiv.parentNode.removeChild(div);\n\t\t\t\n\t\t\tif (align == mxConstants.ALIGN_CENTER)\n\t\t\t{\n\t\t\t\tx -= w / 2;\n\t\t\t}\n\t\t\telse if (align == mxConstants.ALIGN_RIGHT)\n\t\t\t{\n\t\t\t\tx -= w;\n\t\t\t}\n\t\t\t\n\t\t\tif (valign == mxConstants.ALIGN_MIDDLE)\n\t\t\t{\n\t\t\t\ty -= h / 2;\n\t\t\t}\n\t\t\telse if (valign == mxConstants.ALIGN_BOTTOM)\n\t\t\t{\n\t\t\t\ty -= h;\n\t\t\t}\n\t\t\t\n\t\t\tbbox = new mxRectangle((x + 1) * s.scale, (y + 2) * s.scale, w * s.scale, (h + 1) * s.scale);\n\t\t}\n\t\t\n\t\tif (bbox != null)\n\t\t{\n\t\t\tvar n = this.createElement('rect');\n\t\t\tn.setAttribute('fill', s.fontBackgroundColor || 'none');\n\t\t\tn.setAttribute('stroke', s.fontBorderColor || 'none');\n\t\t\tn.setAttribute('x', Math.floor(bbox.x - 1));\n\t\t\tn.setAttribute('y', Math.floor(bbox.y - 1));\n\t\t\tn.setAttribute('width', Math.ceil(bbox.width + 2));\n\t\t\tn.setAttribute('height', Math.ceil(bbox.height));\n\n\t\t\tvar sw = (s.fontBorderColor != null) ? Math.max(1, this.format(s.scale)) : 0;\n\t\t\tn.setAttribute('stroke-width', sw);\n\t\t\t\n\t\t\t// Workaround for crisp rendering - only required if not exporting\n\t\t\tif (this.root.ownerDocument == document && mxUtils.mod(sw, 2) == 1)\n\t\t\t{\n\t\t\t\tn.setAttribute('transform', 'translate(0.5, 0.5)');\n\t\t\t}\n\t\t\t\n\t\t\tnode.insertBefore(n, node.firstChild);\n\t\t}\n\t}\n};\n\n/**\n * Function: stroke\n * \n * Paints the outline of the current path.\n */\nmxSvgCanvas2D.prototype.stroke = function()\n{\n\tthis.addNode(false, true);\n};\n\n/**\n * Function: fill\n * \n * Fills the current path.\n */\nmxSvgCanvas2D.prototype.fill = function()\n{\n\tthis.addNode(true, false);\n};\n\n/**\n * Function: fillAndStroke\n * \n * Fills and paints the outline of the current path.\n */\nmxSvgCanvas2D.prototype.fillAndStroke = function()\n{\n\tthis.addNode(true, true);\n};\n\n__mxOutput.mxSvgCanvas2D = typeof mxSvgCanvas2D !== 'undefined' ? mxSvgCanvas2D : undefined;\n"]}