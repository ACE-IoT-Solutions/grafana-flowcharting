{"version":3,"sources":["../../../../../../src/mxgraph/javascript/dist/js/handler/mxEdgeSegmentHandler.js"],"names":["mxEdgeSegmentHandler","state","mxEdgeHandler","call","mxUtils","extend","mxElbowEdgeHandler","prototype","getCurrentPoints","pts","absolutePoints","tol","Math","max","graph","view","scale","length","abs","x","y","cx","cy","mxPoint","getPreviewPoints","point","isSource","isTarget","apply","arguments","last","convertPoint","clone","result","i","pt","index","round","push","source","getVisibleTerminalState","target","getScale","tr","getTranslate","contains","updatePreviewState","edge","terminalState","me","pt0","pt1","pt2","rpts","getView","y0","getRoutingCenterY","sc","getConnectionConstraint","getConnectionPoint","ye","tc","points","updateFixedTerminalPoints","updatePoints","updateFloatingTerminalPoints","connect","terminal","isClone","model","getModel","geo","getGeometry","abspoints","beginUpdate","setGeometry","endUpdate","getTooltipForNode","node","start","bends","setOpacity","createBends","bend","createHandleShape","initBend","setCursor","mxConstants","CURSOR_TERMINAL_HANDLE","isCellBendable","cell","createVirtualBend","horizontal","redraw","refresh","redrawInnerBends","p0","pe","straight","b","bounds","mxRectangle","floor","width","height","manageLabelHandle","checkLabelHandle","virtualBendOpacity","__mxOutput","undefined"],"mappings":"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","file":"mxEdgeSegmentHandler.js","sourcesContent":["/**\n * Copyright (c) 2006-2015, JGraph Ltd\n * Copyright (c) 2006-2015, Gaudenz Alder\n */\nfunction mxEdgeSegmentHandler(state)\n{\n\tmxEdgeHandler.call(this, state);\n};\n\n/**\n * Extends mxEdgeHandler.\n */\nmxUtils.extend(mxEdgeSegmentHandler, mxElbowEdgeHandler);\n\n/**\n * Function: getCurrentPoints\n * \n * Returns the current absolute points.\n */\nmxEdgeSegmentHandler.prototype.getCurrentPoints = function()\n{\n\tvar pts = this.state.absolutePoints;\n\t\n\tif (pts != null)\n\t{\n\t\t// Special case for straight edges where we add a virtual middle handle for moving the edge\n\t\tvar tol = Math.max(1, this.graph.view.scale);\n\t\t\n\t\tif (pts.length == 2 || (pts.length == 3 &&\n\t\t\t(Math.abs(pts[0].x - pts[1].x) < tol && Math.abs(pts[1].x - pts[2].x) < tol ||\n\t\t\tMath.abs(pts[0].y - pts[1].y) < tol && Math.abs(pts[1].y - pts[2].y) < tol)))\n\t\t{\n\t\t\tvar cx = pts[0].x + (pts[pts.length - 1].x - pts[0].x) / 2;\n\t\t\tvar cy = pts[0].y + (pts[pts.length - 1].y - pts[0].y) / 2;\n\t\t\t\n\t\t\tpts = [pts[0], new mxPoint(cx, cy), new mxPoint(cx, cy), pts[pts.length - 1]];\t\n\t\t}\n\t}\n\n\treturn pts;\n};\n\n/**\n * Function: getPreviewPoints\n * \n * Updates the given preview state taking into account the state of the constraint handler.\n */\nmxEdgeSegmentHandler.prototype.getPreviewPoints = function(point)\n{\n\tif (this.isSource || this.isTarget)\n\t{\n\t\treturn mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this, arguments);\n\t}\n\telse\n\t{\n\t\tvar pts = this.getCurrentPoints();\n\t\tvar last = this.convertPoint(pts[0].clone(), false);\n\t\tpoint = this.convertPoint(point.clone(), false);\n\t\tvar result = [];\n\n\t\tfor (var i = 1; i < pts.length; i++)\n\t\t{\n\t\t\tvar pt = this.convertPoint(pts[i].clone(), false);\n\t\t\t\n\t\t\tif (i == this.index)\n\t\t\t{\n\t\t\t\tif (Math.round(last.x - pt.x) == 0)\n\t\t \t\t{\n\t\t\t\t\tlast.x = point.x;\n\t\t\t\t\tpt.x = point.x;\n\t\t \t\t}\n\t\t \t\t\n\t\t\t\tif (Math.round(last.y - pt.y) == 0)\n\t\t \t\t{\n\t\t \t\t\tlast.y = point.y;\n\t\t \t\t\tpt.y = point.y;\n\t\t \t\t}\n\t\t\t}\n\n\t\t\tif (i < pts.length - 1)\n\t\t\t{\n\t\t\t\tresult.push(pt);\n\t\t\t}\n\n\t\t\tlast = pt;\n\t\t}\n\t\t\n\t\t// Replaces single point that intersects with source or target\n\t\tif (result.length == 1)\n\t\t{\n\t\t\tvar source = this.state.getVisibleTerminalState(true);\n\t\t\tvar target = this.state.getVisibleTerminalState(false);\n\t\t\tvar scale = this.state.view.getScale();\n\t\t\tvar tr = this.state.view.getTranslate();\n\t\t\t\n\t\t\tvar x = result[0].x * scale + tr.x;\n\t\t\tvar y = result[0].y * scale + tr.y;\n\t\t\t\n\t\t\tif ((source != null && mxUtils.contains(source, x, y)) ||\n\t\t\t\t(target != null && mxUtils.contains(target, x, y)))\n\t\t\t{\n\t\t\t\tresult = [point, point];\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n};\n\n/**\n * Function: updatePreviewState\n * \n * Overridden to perform optimization of the edge style result.\n */\nmxEdgeSegmentHandler.prototype.updatePreviewState = function(edge, point, terminalState, me)\n{\n\tmxEdgeHandler.prototype.updatePreviewState.apply(this, arguments);\n\n\t// Checks and corrects preview by running edge style again\n\tif (!this.isSource && !this.isTarget)\n\t{\n\t\tpoint = this.convertPoint(point.clone(), false);\n\t\tvar pts = edge.absolutePoints;\n\t\tvar pt0 = pts[0];\n\t\tvar pt1 = pts[1];\n\n\t\tvar result = [];\n\t\t\n\t\tfor (var i = 2; i < pts.length; i++)\n\t\t{\n\t\t\tvar pt2 = pts[i];\n\t\t\n\t\t\t// Merges adjacent segments only if more than 2 to allow for straight edges\n\t\t\tif ((Math.round(pt0.x - pt1.x) != 0 || Math.round(pt1.x - pt2.x) != 0) &&\n\t\t\t\t(Math.round(pt0.y - pt1.y) != 0 || Math.round(pt1.y - pt2.y) != 0))\n\t\t\t{\n\t\t\t\tresult.push(this.convertPoint(pt1.clone(), false));\n\t\t\t}\n\n\t\t\tpt0 = pt1;\n\t\t\tpt1 = pt2;\n\t\t}\n\t\t\n\t\tvar source = this.state.getVisibleTerminalState(true);\n\t\tvar target = this.state.getVisibleTerminalState(false);\n\t\tvar rpts = this.state.absolutePoints;\n\t\t\n\t\t// A straight line is represented by 3 handles\n\t\tif (result.length == 0 && (Math.round(pts[0].x - pts[pts.length - 1].x) == 0 ||\n\t\t\tMath.round(pts[0].y - pts[pts.length - 1].y) == 0))\n\t\t{\n\t\t\tresult = [point, point];\n\t\t}\n\t\t// Handles special case of transitions from straight vertical to routed\n\t\telse if (pts.length == 5 && result.length == 2 && source != null && target != null &&\n\t\t\t\trpts != null && Math.round(rpts[0].x - rpts[rpts.length - 1].x) == 0)\n\t\t{\n\t\t\tvar view = this.graph.getView();\n\t\t\tvar scale = view.getScale();\n\t\t\tvar tr = view.getTranslate();\n\t\t\t\n\t\t\tvar y0 = view.getRoutingCenterY(source) / scale - tr.y;\n\t\t\t\n\t\t\t// Use fixed connection point y-coordinate if one exists\n\t\t\tvar sc = this.graph.getConnectionConstraint(edge, source, true);\n\t\t\t\n\t\t\tif (sc != null)\n\t\t\t{\n\t\t\t\tvar pt = this.graph.getConnectionPoint(source, sc);\n\t\t\t\t\n\t\t\t\tif (pt != null)\n\t\t\t\t{\n\t\t\t\t\tthis.convertPoint(pt, false);\n\t\t\t\t\ty0 = pt.y;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar ye = view.getRoutingCenterY(target) / scale - tr.y;\n\t\t\t\n\t\t\t// Use fixed connection point y-coordinate if one exists\n\t\t\tvar tc = this.graph.getConnectionConstraint(edge, target, false);\n\t\t\t\n\t\t\tif (tc)\n\t\t\t{\n\t\t\t\tvar pt = this.graph.getConnectionPoint(target, tc);\n\t\t\t\t\n\t\t\t\tif (pt != null)\n\t\t\t\t{\n\t\t\t\t\tthis.convertPoint(pt, false);\n\t\t\t\t\tye = pt.y;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tresult = [new mxPoint(point.x, y0), new mxPoint(point.x, ye)];\n\t\t}\n\n\t\tthis.points = result;\n\n\t\t// LATER: Check if points and result are different\n\t\tedge.view.updateFixedTerminalPoints(edge, source, target);\n\t\tedge.view.updatePoints(edge, this.points, source, target);\n\t\tedge.view.updateFloatingTerminalPoints(edge, source, target);\n\t}\n};\n\n/**\n * Overriden to merge edge segments.\n */\nmxEdgeSegmentHandler.prototype.connect = function(edge, terminal, isSource, isClone, me)\n{\n\tvar model = this.graph.getModel();\n\tvar geo = model.getGeometry(edge);\n\tvar result = null;\n\t\n\t// Merges adjacent edge segments\n\tif (geo != null && geo.points != null && geo.points.length > 0)\n\t{\n\t\tvar pts = this.abspoints;\n\t\tvar pt0 = pts[0];\n\t\tvar pt1 = pts[1];\n\t\tresult = [];\n\t\t\n\t\tfor (var i = 2; i < pts.length; i++)\n\t\t{\n\t\t\tvar pt2 = pts[i];\n\t\t\n\t\t\t// Merges adjacent segments only if more than 2 to allow for straight edges\n\t\t\tif ((Math.round(pt0.x - pt1.x) != 0 || Math.round(pt1.x - pt2.x) != 0) &&\n\t\t\t\t(Math.round(pt0.y - pt1.y) != 0 || Math.round(pt1.y - pt2.y) != 0))\n\t\t\t{\n\t\t\t\tresult.push(this.convertPoint(pt1.clone(), false));\n\t\t\t}\n\t\n\t\t\tpt0 = pt1;\n\t\t\tpt1 = pt2;\n\t\t}\n\t}\n\t\n\tmodel.beginUpdate();\n\ttry\n\t{\n\t\tif (result != null)\n\t\t{\n\t\t\tvar geo = model.getGeometry(edge);\n\t\t\t\n\t\t\tif (geo != null)\n\t\t\t{\n\t\t\t\tgeo = geo.clone();\n\t\t\t\tgeo.points = result;\n\t\t\t\t\n\t\t\t\tmodel.setGeometry(edge, geo);\n\t\t\t}\n\t\t}\n\t\t\n\t\tedge = mxEdgeHandler.prototype.connect.apply(this, arguments);\n\t}\n\tfinally\n\t{\n\t\tmodel.endUpdate();\n\t}\n\t\n\treturn edge;\n};\n\n/**\n * Function: getTooltipForNode\n * \n * Returns no tooltips.\n */\nmxEdgeSegmentHandler.prototype.getTooltipForNode = function(node)\n{\n\treturn null;\n};\n\n/**\n * Function: createBends\n * \n * Adds custom bends for the center of each segment.\n */\nmxEdgeSegmentHandler.prototype.start = function(x, y, index)\n{\n\tmxEdgeHandler.prototype.start.apply(this, arguments);\n\t\n\tif (this.bends != null && this.bends[index] != null &&\n\t\t!this.isSource && !this.isTarget)\n\t{\n\t\tmxUtils.setOpacity(this.bends[index].node, 100);\n\t}\n};\n\n/**\n * Function: createBends\n * \n * Adds custom bends for the center of each segment.\n */\nmxEdgeSegmentHandler.prototype.createBends = function()\n{\n\tvar bends = [];\n\t\n\t// Source\n\tvar bend = this.createHandleShape(0);\n\tthis.initBend(bend);\n\tbend.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE);\n\tbends.push(bend);\n\n\tvar pts = this.getCurrentPoints();\n\n\t// Waypoints (segment handles)\n\tif (this.graph.isCellBendable(this.state.cell))\n\t{\n\t\tif (this.points == null)\n\t\t{\n\t\t\tthis.points = [];\n\t\t}\n\n\t\tfor (var i = 0; i < pts.length - 1; i++)\n\t\t{\n\t\t\tbend = this.createVirtualBend();\n\t\t\tbends.push(bend);\n\t\t\tvar horizontal = Math.round(pts[i].x - pts[i + 1].x) == 0;\n\t\t\t\n\t\t\t// Special case where dy is 0 as well\n\t\t\tif (Math.round(pts[i].y - pts[i + 1].y) == 0 && i < pts.length - 2)\n\t\t\t{\n\t\t\t\thorizontal = Math.round(pts[i].x - pts[i + 2].x) == 0;\n\t\t\t}\n\t\t\t\n\t\t\tbend.setCursor((horizontal) ? 'col-resize' : 'row-resize');\n\t\t\tthis.points.push(new mxPoint(0,0));\n\t\t}\n\t}\n\n\t// Target\n\tvar bend = this.createHandleShape(pts.length);\n\tthis.initBend(bend);\n\tbend.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE);\n\tbends.push(bend);\n\n\treturn bends;\n};\n\n/**\n * Function: redraw\n * \n * Overridden to invoke <refresh> before the redraw.\n */\nmxEdgeSegmentHandler.prototype.redraw = function()\n{\n\tthis.refresh();\n\tmxEdgeHandler.prototype.redraw.apply(this, arguments);\n};\n\n/**\n * Function: redrawInnerBends\n * \n * Updates the position of the custom bends.\n */\nmxEdgeSegmentHandler.prototype.redrawInnerBends = function(p0, pe)\n{\n\tif (this.graph.isCellBendable(this.state.cell))\n\t{\n\t\tvar pts = this.getCurrentPoints();\n\t\t\n\t\tif (pts != null && pts.length > 1)\n\t\t{\n\t\t\tvar straight = false;\n\t\t\t\n\t\t\t// Puts handle in the center of straight edges\n\t\t\tif (pts.length == 4 && Math.round(pts[1].x - pts[2].x) == 0 && Math.round(pts[1].y - pts[2].y) == 0)\n\t\t\t{\n\t\t\t\tstraight = true;\n\t\t\t\t\n\t\t\t\tif (Math.round(pts[0].y - pts[pts.length - 1].y) == 0)\n\t\t\t\t{\n\t\t\t\t\tvar cx = pts[0].x + (pts[pts.length - 1].x - pts[0].x) / 2;\n\t\t\t\t\tpts[1] = new mxPoint(cx, pts[1].y);\n\t\t\t\t\tpts[2] = new mxPoint(cx, pts[2].y);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar cy = pts[0].y + (pts[pts.length - 1].y - pts[0].y) / 2;\n\t\t\t\t\tpts[1] = new mxPoint(pts[1].x, cy);\n\t\t\t\t\tpts[2] = new mxPoint(pts[2].x, cy);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfor (var i = 0; i < pts.length - 1; i++)\n\t\t\t{\n\t\t\t\tif (this.bends[i + 1] != null)\n\t\t\t\t{\n\t\t \t\t\tvar p0 = pts[i];\n\t \t\t\t\tvar pe = pts[i + 1];\n\t\t\t \t\tvar pt = new mxPoint(p0.x + (pe.x - p0.x) / 2, p0.y + (pe.y - p0.y) / 2);\n\t\t\t \t\tvar b = this.bends[i + 1].bounds;\n\t\t\t \t\tthis.bends[i + 1].bounds = new mxRectangle(Math.floor(pt.x - b.width / 2),\n\t\t\t \t\t\t\tMath.floor(pt.y - b.height / 2), b.width, b.height);\n\t\t\t\t \tthis.bends[i + 1].redraw();\n\t\t\t\t \t\n\t\t\t\t \tif (this.manageLabelHandle)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.checkLabelHandle(this.bends[i + 1].bounds);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (straight)\n\t\t\t{\n\t\t\t\tmxUtils.setOpacity(this.bends[1].node, this.virtualBendOpacity);\n\t\t\t\tmxUtils.setOpacity(this.bends[3].node, this.virtualBendOpacity);\n\t\t\t}\n\t\t}\n\t}\n};\n\n__mxOutput.mxEdgeSegmentHandler = typeof mxEdgeSegmentHandler !== 'undefined' ? mxEdgeSegmentHandler : undefined;\n"]}