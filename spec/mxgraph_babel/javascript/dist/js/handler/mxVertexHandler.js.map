{"version":3,"sources":["../../../../../../src/mxgraph/javascript/dist/js/handler/mxVertexHandler.js"],"names":["mxVertexHandler","state","init","escapeHandler","mxUtils","bind","sender","evt","livePreview","index","view","graph","cellRenderer","redraw","invalidate","cell","invalid","validate","reset","addListener","mxEvent","ESCAPE","prototype","singleSizer","allowHandleBoundsCheck","handleImage","tolerance","rotationEnabled","parentHighlightEnabled","rotationRaster","rotationCursor","manageSizers","constrainGroupByChildren","rotationHandleVSpacing","horizontalOffset","verticalOffset","selectionBounds","getSelectionBounds","bounds","mxRectangle","x","y","width","height","selectionBorder","createSelectionShape","dialect","mxConstants","DIALECT_SVG","DIALECT_VML","pointerEvents","rotation","Number","style","STYLE_ROTATION","getView","getOverlayPane","redirectMouseEvents","node","isCellMovable","setCursor","CURSOR_MOVABLE_VERTEX","mxGraphHandler","maxCells","getSelectionCount","resizable","isCellResizable","sizers","isLabelMovable","i","push","createSizer","geo","model","getGeometry","relative","isSwimlane","labelShape","CURSOR_LABEL_HANDLE","LABEL_HANDLE","LABEL_HANDLE_SIZE","LABEL_HANDLE_FILLCOLOR","isRotationHandleVisible","rotationShape","ROTATION_HANDLE","HANDLE_SIZE","HANDLE_FILLCOLOR","customHandles","createCustomHandles","updateMinBounds","isEnabled","isCellRotatable","isConstrainedEvent","me","isShiftDown","getEvent","STYLE_ASPECT","isCenteredEvent","children","getChildCells","length","minBounds","getBounds","s","scale","t","translate","x0","y0","Math","round","createParentHighlightShape","shape","mxRectangleShape","getSelectionColor","strokewidth","getSelectionStrokeWidth","isDashed","isSelectionDashed","VERTEX_SELECTION_COLOR","VERTEX_SELECTION_STROKEWIDTH","VERTEX_SELECTION_DASHED","cursor","size","fillColor","sizer","createSizerShape","isHtmlAllowed","text","parentNode","container","DIALECT_STRICTHTML","DIALECT_MIXEDHTML","isSizerVisible","visible","mxImageShape","src","preserveImageAspect","mxEllipse","HANDLE_STROKECOLOR","moveSizerTo","floor","display","getHandleForEvent","tol","isMouseEvent","hit","mxClient","IS_IE","getGraphX","getGraphY","checkShape","isSource","intersects","visibility","isCustomHandleEvent","CUSTOM_HANDLE","mouseDown","isConsumed","getState","handle","start","consume","isLivePreviewBorder","fill","stroke","inTolerance","childOffsetX","childOffsetY","startX","startY","parent","getParent","currentRoot","isVertex","isEdge","parentState","preview","IS_SVG","hideSizers","setVisible","edges","getEdges","edgeHandlers","handler","selectionCellsHandler","getHandler","setHandlesVisible","checkTolerance","abs","updateHint","removeHint","roundAngle","angle","roundLength","mouseMove","processEvent","active","moveLabel","rotateVertex","resizeVertex","isMouseDown","point","mxPoint","tr","isGridEnabledEvent","snap","dx","dy","currentAlpha","atan","PI","getCenterX","getCenterY","dist","sqrt","raster","max","min","redrawHandles","ct","alpha","toRadians","cos","sin","tx","ty","getCellGeometry","unscaledBounds","union","getMaximumGraphBounds","fromRectangle","isConstrainChild","tmp","getCellContainmentArea","overlap","getOverlap","intersect","c2","dx2","dy2","dx3","dy3","dx4","dy4","dx5","dy5","isCellCollapsed","updateLivePreview","drawPreview","tempState","clone","origin","unscaledWidth","off","absoluteOffset","offset","EMPTY_POINT","updateVertexLabelOffset","setState","mouseUp","getModel","beginUpdate","execute","delta","rotateCell","rotateClick","gridEnabled","recurse","isRecursiveResize","resizeCell","endUpdate","getCellStyle","total","setCellStyles","pgeo","rotate","setGeometry","childCount","getChildCount","getChildAt","destroy","constrained","moveChildren","child","centered","rect","add","w0","h0","left","right","top","bottom","cx","cy","aspect","cdx","cdy","result","getHandlePadding","padding","r","b","crs","da","pt","getRotatedPoint","mod","getRotationHandlePosition","isEditing","temp","updateParentHighlight","parentHighlight","pstate","removeListener","__mxOutput","undefined"],"mappings":"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","file":"mxVertexHandler.js","sourcesContent":["/**\n * Copyright (c) 2006-2015, JGraph Ltd\n * Copyright (c) 2006-2015, Gaudenz Alder\n */\n/**\n * Class: mxVertexHandler\n * \n * Event handler for resizing cells. This handler is automatically created in\n * <mxGraph.createHandler>.\n * \n * Constructor: mxVertexHandler\n * \n * Constructs an event handler that allows to resize vertices\n * and groups.\n * \n * Parameters:\n * \n * state - <mxCellState> of the cell to be resized.\n */\nfunction mxVertexHandler(state)\n{\n\tif (state != null)\n\t{\n\t\tthis.state = state;\n\t\tthis.init();\n\t\t\n\t\t// Handles escape keystrokes\n\t\tthis.escapeHandler = mxUtils.bind(this, function(sender, evt)\n\t\t{\n\t\t\tif (this.livePreview && this.index != null)\n\t\t\t{\n\t\t\t\t// Redraws the live preview\n\t\t\t\tthis.state.view.graph.cellRenderer.redraw(this.state, true);\n\t\t\t\t\n\t\t\t\t// Redraws connected edges\n\t\t\t\tthis.state.view.invalidate(this.state.cell);\n\t\t\t\tthis.state.invalid = false;\n\t\t\t\tthis.state.view.validate();\n\t\t\t}\n\t\t\t\n\t\t\tthis.reset();\n\t\t});\n\t\t\n\t\tthis.state.view.graph.addListener(mxEvent.ESCAPE, this.escapeHandler);\n\t}\n};\n\n/**\n * Variable: graph\n * \n * Reference to the enclosing <mxGraph>.\n */\nmxVertexHandler.prototype.graph = null;\n\n/**\n * Variable: state\n * \n * Reference to the <mxCellState> being modified.\n */\nmxVertexHandler.prototype.state = null;\n\n/**\n * Variable: singleSizer\n * \n * Specifies if only one sizer handle at the bottom, right corner should be\n * used. Default is false.\n */\nmxVertexHandler.prototype.singleSizer = false;\n\n/**\n * Variable: index\n * \n * Holds the index of the current handle.\n */\nmxVertexHandler.prototype.index = null;\n\n/**\n * Variable: allowHandleBoundsCheck\n * \n * Specifies if the bounds of handles should be used for hit-detection in IE or\n * if <tolerance> > 0. Default is true.\n */\nmxVertexHandler.prototype.allowHandleBoundsCheck = true;\n\n/**\n * Variable: handleImage\n * \n * Optional <mxImage> to be used as handles. Default is null.\n */\nmxVertexHandler.prototype.handleImage = null;\n\n/**\n * Variable: tolerance\n * \n * Optional tolerance for hit-detection in <getHandleForEvent>. Default is 0.\n */\nmxVertexHandler.prototype.tolerance = 0;\n\n/**\n * Variable: rotationEnabled\n * \n * Specifies if a rotation handle should be visible. Default is false.\n */\nmxVertexHandler.prototype.rotationEnabled = false;\n\n/**\n * Variable: parentHighlightEnabled\n * \n * Specifies if the parent should be highlighted if a child cell is selected.\n * Default is false.\n */\nmxVertexHandler.prototype.parentHighlightEnabled = false;\n\n/**\n * Variable: rotationRaster\n * \n * Specifies if rotation steps should be \"rasterized\" depening on the distance\n * to the handle. Default is true.\n */\nmxVertexHandler.prototype.rotationRaster = true;\n\n/**\n * Variable: rotationCursor\n * \n * Specifies the cursor for the rotation handle. Default is 'crosshair'.\n */\nmxVertexHandler.prototype.rotationCursor = 'crosshair';\n\n/**\n * Variable: livePreview\n * \n * Specifies if resize should change the cell in-place. This is an experimental\n * feature for non-touch devices. Default is false.\n */\nmxVertexHandler.prototype.livePreview = false;\n\n/**\n * Variable: manageSizers\n * \n * Specifies if sizers should be hidden and spaced if the vertex is small.\n * Default is false.\n */\nmxVertexHandler.prototype.manageSizers = false;\n\n/**\n * Variable: constrainGroupByChildren\n * \n * Specifies if the size of groups should be constrained by the children.\n * Default is false.\n */\nmxVertexHandler.prototype.constrainGroupByChildren = false;\n\n/**\n * Variable: rotationHandleVSpacing\n * \n * Vertical spacing for rotation icon. Default is -16.\n */\nmxVertexHandler.prototype.rotationHandleVSpacing = -16;\n\n/**\n * Variable: horizontalOffset\n * \n * The horizontal offset for the handles. This is updated in <redrawHandles>\n * if <manageSizers> is true and the sizers are offset horizontally.\n */\nmxVertexHandler.prototype.horizontalOffset = 0;\n\n/**\n * Variable: verticalOffset\n * \n * The horizontal offset for the handles. This is updated in <redrawHandles>\n * if <manageSizers> is true and the sizers are offset vertically.\n */\nmxVertexHandler.prototype.verticalOffset = 0;\n\n/**\n * Function: init\n * \n * Initializes the shapes required for this vertex handler.\n */\nmxVertexHandler.prototype.init = function()\n{\n\tthis.graph = this.state.view.graph;\n\tthis.selectionBounds = this.getSelectionBounds(this.state);\n\tthis.bounds = new mxRectangle(this.selectionBounds.x, this.selectionBounds.y, this.selectionBounds.width, this.selectionBounds.height);\n\tthis.selectionBorder = this.createSelectionShape(this.bounds);\n\t// VML dialect required here for event transparency in IE\n\tthis.selectionBorder.dialect = (this.graph.dialect != mxConstants.DIALECT_SVG) ? mxConstants.DIALECT_VML : mxConstants.DIALECT_SVG;\n\tthis.selectionBorder.pointerEvents = false;\n\tthis.selectionBorder.rotation = Number(this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\tthis.selectionBorder.init(this.graph.getView().getOverlayPane());\n\tmxEvent.redirectMouseEvents(this.selectionBorder.node, this.graph, this.state);\n\t\n\tif (this.graph.isCellMovable(this.state.cell))\n\t{\n\t\tthis.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX);\n\t}\n\n\t// Adds the sizer handles\n\tif (mxGraphHandler.prototype.maxCells <= 0 || this.graph.getSelectionCount() < mxGraphHandler.prototype.maxCells)\n\t{\n\t\tvar resizable = this.graph.isCellResizable(this.state.cell);\n\t\tthis.sizers = [];\n\n\t\tif (resizable || (this.graph.isLabelMovable(this.state.cell) &&\n\t\t\tthis.state.width >= 2 && this.state.height >= 2))\n\t\t{\n\t\t\tvar i = 0;\n\n\t\t\tif (resizable)\n\t\t\t{\n\t\t\t\tif (!this.singleSizer)\n\t\t\t\t{\n\t\t\t\t\tthis.sizers.push(this.createSizer('nw-resize', i++));\n\t\t\t\t\tthis.sizers.push(this.createSizer('n-resize', i++));\n\t\t\t\t\tthis.sizers.push(this.createSizer('ne-resize', i++));\n\t\t\t\t\tthis.sizers.push(this.createSizer('w-resize', i++));\n\t\t\t\t\tthis.sizers.push(this.createSizer('e-resize', i++));\n\t\t\t\t\tthis.sizers.push(this.createSizer('sw-resize', i++));\n\t\t\t\t\tthis.sizers.push(this.createSizer('s-resize', i++));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.sizers.push(this.createSizer('se-resize', i++));\n\t\t\t}\n\t\t\t\n\t\t\tvar geo = this.graph.model.getGeometry(this.state.cell);\n\t\t\t\n\t\t\tif (geo != null && !geo.relative && !this.graph.isSwimlane(this.state.cell) &&\n\t\t\t\tthis.graph.isLabelMovable(this.state.cell))\n\t\t\t{\n\t\t\t\t// Marks this as the label handle for getHandleForEvent\n\t\t\t\tthis.labelShape = this.createSizer(mxConstants.CURSOR_LABEL_HANDLE, mxEvent.LABEL_HANDLE, mxConstants.LABEL_HANDLE_SIZE, mxConstants.LABEL_HANDLE_FILLCOLOR);\n\t\t\t\tthis.sizers.push(this.labelShape);\n\t\t\t}\n\t\t}\n\t\telse if (this.graph.isCellMovable(this.state.cell) && !this.graph.isCellResizable(this.state.cell) &&\n\t\t\tthis.state.width < 2 && this.state.height < 2)\n\t\t{\n\t\t\tthis.labelShape = this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,\n\t\t\t\tmxEvent.LABEL_HANDLE, null, mxConstants.LABEL_HANDLE_FILLCOLOR);\n\t\t\tthis.sizers.push(this.labelShape);\n\t\t}\n\t}\n\t\n\t// Adds the rotation handler\n\tif (this.isRotationHandleVisible())\n\t{\n\t\tthis.rotationShape = this.createSizer(this.rotationCursor, mxEvent.ROTATION_HANDLE,\n\t\t\tmxConstants.HANDLE_SIZE + 3, mxConstants.HANDLE_FILLCOLOR);\n\t\tthis.sizers.push(this.rotationShape);\n\t}\n\n\tthis.customHandles = this.createCustomHandles();\n\tthis.redraw();\n\t\n\tif (this.constrainGroupByChildren)\n\t{\n\t\tthis.updateMinBounds();\n\t}\n};\n\n/**\n * Function: isRotationHandleVisible\n * \n * Returns true if the rotation handle should be showing.\n */\nmxVertexHandler.prototype.isRotationHandleVisible = function()\n{\n\treturn this.graph.isEnabled() && this.rotationEnabled && this.graph.isCellRotatable(this.state.cell) &&\n\t\t(mxGraphHandler.prototype.maxCells <= 0 || this.graph.getSelectionCount() < mxGraphHandler.prototype.maxCells) &&\n\t\tthis.state.width >= 2 && this.state.height >= 2;\n};\n\n/**\n * Function: isConstrainedEvent\n * \n * Returns true if the aspect ratio if the cell should be maintained.\n */\nmxVertexHandler.prototype.isConstrainedEvent = function(me)\n{\n\treturn mxEvent.isShiftDown(me.getEvent()) || this.state.style[mxConstants.STYLE_ASPECT] == 'fixed';\n};\n\n/**\n * Function: isCenteredEvent\n * \n * Returns true if the center of the vertex should be maintained during the resize.\n */\nmxVertexHandler.prototype.isCenteredEvent = function(state, me)\n{\n\treturn false;\n};\n\n/**\n * Function: createCustomHandles\n * \n * Returns an array of custom handles. This implementation returns null.\n */\nmxVertexHandler.prototype.createCustomHandles = function()\n{\n\treturn null;\n};\n\n/**\n * Function: updateMinBounds\n * \n * Initializes the shapes required for this vertex handler.\n */\nmxVertexHandler.prototype.updateMinBounds = function()\n{\n\tvar children = this.graph.getChildCells(this.state.cell);\n\t\n\tif (children.length > 0)\n\t{\n\t\tthis.minBounds = this.graph.view.getBounds(children);\n\t\t\n\t\tif (this.minBounds != null)\n\t\t{\n\t\t\tvar s = this.state.view.scale;\n\t\t\tvar t = this.state.view.translate;\n\n\t\t\tthis.minBounds.x -= this.state.x;\n\t\t\tthis.minBounds.y -= this.state.y;\n\t\t\tthis.minBounds.x /= s;\n\t\t\tthis.minBounds.y /= s;\n\t\t\tthis.minBounds.width /= s;\n\t\t\tthis.minBounds.height /= s;\n\t\t\tthis.x0 = this.state.x / s - t.x;\n\t\t\tthis.y0 = this.state.y / s - t.y;\n\t\t}\n\t}\n};\n\n/**\n * Function: getSelectionBounds\n * \n * Returns the mxRectangle that defines the bounds of the selection\n * border.\n */\nmxVertexHandler.prototype.getSelectionBounds = function(state)\n{\n\treturn new mxRectangle(Math.round(state.x), Math.round(state.y), Math.round(state.width), Math.round(state.height));\n};\n\n/**\n * Function: createParentHighlightShape\n * \n * Creates the shape used to draw the selection border.\n */\nmxVertexHandler.prototype.createParentHighlightShape = function(bounds)\n{\n\treturn this.createSelectionShape(bounds);\n};\n\n/**\n * Function: createSelectionShape\n * \n * Creates the shape used to draw the selection border.\n */\nmxVertexHandler.prototype.createSelectionShape = function(bounds)\n{\n\tvar shape = new mxRectangleShape(bounds, null, this.getSelectionColor());\n\tshape.strokewidth = this.getSelectionStrokeWidth();\n\tshape.isDashed = this.isSelectionDashed();\n\t\n\treturn shape;\n};\n\n/**\n * Function: getSelectionColor\n * \n * Returns <mxConstants.VERTEX_SELECTION_COLOR>.\n */\nmxVertexHandler.prototype.getSelectionColor = function()\n{\n\treturn mxConstants.VERTEX_SELECTION_COLOR;\n};\n\n/**\n * Function: getSelectionStrokeWidth\n * \n * Returns <mxConstants.VERTEX_SELECTION_STROKEWIDTH>.\n */\nmxVertexHandler.prototype.getSelectionStrokeWidth = function()\n{\n\treturn mxConstants.VERTEX_SELECTION_STROKEWIDTH;\n};\n\n/**\n * Function: isSelectionDashed\n * \n * Returns <mxConstants.VERTEX_SELECTION_DASHED>.\n */\nmxVertexHandler.prototype.isSelectionDashed = function()\n{\n\treturn mxConstants.VERTEX_SELECTION_DASHED;\n};\n\n/**\n * Function: createSizer\n * \n * Creates a sizer handle for the specified cursor and index and returns\n * the new <mxRectangleShape> that represents the handle.\n */\nmxVertexHandler.prototype.createSizer = function(cursor, index, size, fillColor)\n{\n\tsize = size || mxConstants.HANDLE_SIZE;\n\t\n\tvar bounds = new mxRectangle(0, 0, size, size);\n\tvar sizer = this.createSizerShape(bounds, index, fillColor);\n\n\tif (sizer.isHtmlAllowed() && this.state.text != null && this.state.text.node.parentNode == this.graph.container)\n\t{\n\t\tsizer.bounds.height -= 1;\n\t\tsizer.bounds.width -= 1;\n\t\tsizer.dialect = mxConstants.DIALECT_STRICTHTML;\n\t\tsizer.init(this.graph.container);\n\t}\n\telse\n\t{\n\t\tsizer.dialect = (this.graph.dialect != mxConstants.DIALECT_SVG) ?\n\t\t\t\tmxConstants.DIALECT_MIXEDHTML : mxConstants.DIALECT_SVG;\n\t\tsizer.init(this.graph.getView().getOverlayPane());\n\t}\n\n\tmxEvent.redirectMouseEvents(sizer.node, this.graph, this.state);\n\t\n\tif (this.graph.isEnabled())\n\t{\n\t\tsizer.setCursor(cursor);\n\t}\n\t\n\tif (!this.isSizerVisible(index))\n\t{\n\t\tsizer.visible = false;\n\t}\n\t\n\treturn sizer;\n};\n\n/**\n * Function: isSizerVisible\n * \n * Returns true if the sizer for the given index is visible.\n * This returns true for all given indices.\n */\nmxVertexHandler.prototype.isSizerVisible = function(index)\n{\n\treturn true;\n};\n\n/**\n * Function: createSizerShape\n * \n * Creates the shape used for the sizer handle for the specified bounds an\n * index. Only images and rectangles should be returned if support for HTML\n * labels with not foreign objects is required.\n */\nmxVertexHandler.prototype.createSizerShape = function(bounds, index, fillColor)\n{\n\tif (this.handleImage != null)\n\t{\n\t\tbounds = new mxRectangle(bounds.x, bounds.y, this.handleImage.width, this.handleImage.height);\n\t\tvar shape = new mxImageShape(bounds, this.handleImage.src);\n\t\t\n\t\t// Allows HTML rendering of the images\n\t\tshape.preserveImageAspect = false;\n\n\t\treturn shape;\n\t}\n\telse if (index == mxEvent.ROTATION_HANDLE)\n\t{\n\t\treturn new mxEllipse(bounds, fillColor || mxConstants.HANDLE_FILLCOLOR, mxConstants.HANDLE_STROKECOLOR);\n\t}\n\telse\n\t{\n\t\treturn new mxRectangleShape(bounds, fillColor || mxConstants.HANDLE_FILLCOLOR, mxConstants.HANDLE_STROKECOLOR);\n\t}\n};\n\n/**\n * Function: createBounds\n * \n * Helper method to create an <mxRectangle> around the given centerpoint\n * with a width and height of 2*s or 6, if no s is given.\n */\nmxVertexHandler.prototype.moveSizerTo = function(shape, x, y)\n{\n\tif (shape != null)\n\t{\n\t\tshape.bounds.x = Math.floor(x - shape.bounds.width / 2);\n\t\tshape.bounds.y = Math.floor(y - shape.bounds.height / 2);\n\t\t\n\t\t// Fixes visible inactive handles in VML\n\t\tif (shape.node != null && shape.node.style.display != 'none')\n\t\t{\n\t\t\tshape.redraw();\n\t\t}\n\t}\n};\n\n/**\n * Function: getHandleForEvent\n * \n * Returns the index of the handle for the given event. This returns the index\n * of the sizer from where the event originated or <mxEvent.LABEL_INDEX>.\n */\nmxVertexHandler.prototype.getHandleForEvent = function(me)\n{\n\t// Connection highlight may consume events before they reach sizer handle\n\tvar tol = (!mxEvent.isMouseEvent(me.getEvent())) ? this.tolerance : 1;\n\tvar hit = (this.allowHandleBoundsCheck && (mxClient.IS_IE || tol > 0)) ?\n\t\tnew mxRectangle(me.getGraphX() - tol, me.getGraphY() - tol, 2 * tol, 2 * tol) : null;\n\t\n\tfunction checkShape(shape)\n\t{\n\t\treturn shape != null && (me.isSource(shape) || (hit != null && mxUtils.intersects(shape.bounds, hit) &&\n\t\t\tshape.node.style.display != 'none' && shape.node.style.visibility != 'hidden'));\n\t}\n\n\tif (this.customHandles != null && this.isCustomHandleEvent(me))\n\t{\n\t\t// Inverse loop order to match display order\n\t\tfor (var i = this.customHandles.length - 1; i >= 0; i--)\n\t\t{\n\t\t\tif (checkShape(this.customHandles[i].shape))\n\t\t\t{\n\t\t\t\t// LATER: Return reference to active shape\n\t\t\t\treturn mxEvent.CUSTOM_HANDLE - i;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (checkShape(this.rotationShape))\n\t{\n\t\treturn mxEvent.ROTATION_HANDLE;\n\t}\n\telse if (checkShape(this.labelShape))\n\t{\n\t\treturn mxEvent.LABEL_HANDLE;\n\t}\n\t\n\tif (this.sizers != null)\n\t{\n\t\tfor (var i = 0; i < this.sizers.length; i++)\n\t\t{\n\t\t\tif (checkShape(this.sizers[i]))\n\t\t\t{\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n};\n\n/**\n * Function: isCustomHandleEvent\n * \n * Returns true if the given event allows custom handles to be changed. This\n * implementation returns true.\n */\nmxVertexHandler.prototype.isCustomHandleEvent = function(me)\n{\n\treturn true;\n};\n\n/**\n * Function: mouseDown\n * \n * Handles the event if a handle has been clicked. By consuming the\n * event all subsequent events of the gesture are redirected to this\n * handler.\n */\nmxVertexHandler.prototype.mouseDown = function(sender, me)\n{\n\tvar tol = (!mxEvent.isMouseEvent(me.getEvent())) ? this.tolerance : 0;\n\t\n\tif (!me.isConsumed() && this.graph.isEnabled() && (tol > 0 || me.getState() == this.state))\n\t{\n\t\tvar handle = this.getHandleForEvent(me);\n\n\t\tif (handle != null)\n\t\t{\n\t\t\tthis.start(me.getGraphX(), me.getGraphY(), handle);\n\t\t\tme.consume();\n\t\t}\n\t}\n};\n\n/**\n * Function: isLivePreviewBorder\n * \n * Called if <livePreview> is enabled to check if a border should be painted.\n * This implementation returns true if the shape is transparent.\n */\nmxVertexHandler.prototype.isLivePreviewBorder = function()\n{\n\treturn this.state.shape != null && this.state.shape.fill == null && this.state.shape.stroke == null;\n};\n\n/**\n * Function: start\n * \n * Starts the handling of the mouse gesture.\n */\nmxVertexHandler.prototype.start = function(x, y, index)\n{\n\tthis.inTolerance = true;\n\tthis.childOffsetX = 0;\n\tthis.childOffsetY = 0;\n\tthis.index = index;\n\tthis.startX = x;\n\tthis.startY = y;\n\t\n\t// Saves reference to parent state\n\tvar model = this.state.view.graph.model;\n\tvar parent = model.getParent(this.state.cell);\n\t\n\tif (this.state.view.currentRoot != parent && (model.isVertex(parent) || model.isEdge(parent)))\n\t{\n\t\tthis.parentState = this.state.view.graph.view.getState(parent);\n\t}\n\t\n\t// Creates a preview that can be on top of any HTML label\n\tthis.selectionBorder.node.style.display = (index == mxEvent.ROTATION_HANDLE) ? 'inline' : 'none';\n\t\n\t// Creates the border that represents the new bounds\n\tif (!this.livePreview || this.isLivePreviewBorder())\n\t{\n\t\tthis.preview = this.createSelectionShape(this.bounds);\n\t\t\n\t\tif (!(mxClient.IS_SVG && Number(this.state.style[mxConstants.STYLE_ROTATION] || '0') != 0) &&\n\t\t\tthis.state.text != null && this.state.text.node.parentNode == this.graph.container)\n\t\t{\n\t\t\tthis.preview.dialect = mxConstants.DIALECT_STRICTHTML;\n\t\t\tthis.preview.init(this.graph.container);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.preview.dialect = (this.graph.dialect != mxConstants.DIALECT_SVG) ?\n\t\t\t\t\tmxConstants.DIALECT_VML : mxConstants.DIALECT_SVG;\n\t\t\tthis.preview.init(this.graph.view.getOverlayPane());\n\t\t}\n\t}\n\t\n\t// Prepares the handles for live preview\n\tif (this.livePreview)\n\t{\n\t\tthis.hideSizers();\n\t\t\n\t\tif (index == mxEvent.ROTATION_HANDLE)\n\t\t{\n\t\t\tthis.rotationShape.node.style.display = '';\n\t\t}\n\t\telse if (index == mxEvent.LABEL_HANDLE)\n\t\t{\n\t\t\tthis.labelShape.node.style.display = '';\n\t\t}\n\t\telse if (this.sizers != null && this.sizers[index] != null)\n\t\t{\n\t\t\tthis.sizers[index].node.style.display = '';\n\t\t}\n\t\telse if (index <= mxEvent.CUSTOM_HANDLE && this.customHandles != null)\n\t\t{\n\t\t\tthis.customHandles[mxEvent.CUSTOM_HANDLE - index].setVisible(true);\n\t\t}\n\t\t\n\t\t// Gets the array of connected edge handlers for redrawing\n\t\tvar edges = this.graph.getEdges(this.state.cell);\n\t\tthis.edgeHandlers = [];\n\t\t\n\t\tfor (var i = 0; i < edges.length; i++)\n\t\t{\n\t\t\tvar handler = this.graph.selectionCellsHandler.getHandler(edges[i]);\n\t\t\t\n\t\t\tif (handler != null)\n\t\t\t{\n\t\t\t\tthis.edgeHandlers.push(handler);\n\t\t\t}\n\t\t}\n\t}\n};\n\n/**\n * Function: hideHandles\n * \n * Shortcut to <hideSizers>.\n */\nmxVertexHandler.prototype.setHandlesVisible = function(visible)\n{\n\tif (this.sizers != null)\n\t{\n\t\tfor (var i = 0; i < this.sizers.length; i++)\n\t\t{\n\t\t\tthis.sizers[i].node.style.display = (visible) ? '' : 'none';\n\t\t}\n\t}\n\n\tif (this.customHandles != null)\n\t{\n\t\tfor (var i = 0; i < this.customHandles.length; i++)\n\t\t{\n\t\t\tthis.customHandles[i].setVisible(visible);\n\t\t}\n\t}\n};\n\n/**\n * Function: hideSizers\n * \n * Hides all sizers except.\n * \n * Starts the handling of the mouse gesture.\n */\nmxVertexHandler.prototype.hideSizers = function()\n{\n\tthis.setHandlesVisible(false);\n};\n\n/**\n * Function: checkTolerance\n * \n * Checks if the coordinates for the given event are within the\n * <mxGraph.tolerance>. If the event is a mouse event then the tolerance is\n * ignored.\n */\nmxVertexHandler.prototype.checkTolerance = function(me)\n{\n\tif (this.inTolerance && this.startX != null && this.startY != null)\n\t{\n\t\tif (mxEvent.isMouseEvent(me.getEvent()) ||\n\t\t\tMath.abs(me.getGraphX() - this.startX) > this.graph.tolerance ||\n\t\t\tMath.abs(me.getGraphY() - this.startY) > this.graph.tolerance)\n\t\t{\n\t\t\tthis.inTolerance = false;\n\t\t}\n\t}\n};\n\n/**\n * Function: updateHint\n * \n * Hook for subclassers do show details while the handler is active.\n */\nmxVertexHandler.prototype.updateHint = function(me) { };\n\n/**\n * Function: removeHint\n * \n * Hooks for subclassers to hide details when the handler gets inactive.\n */\nmxVertexHandler.prototype.removeHint = function() { };\n\n/**\n * Function: roundAngle\n * \n * Hook for rounding the angle. This uses Math.round.\n */\nmxVertexHandler.prototype.roundAngle = function(angle)\n{\n\treturn Math.round(angle * 10) / 10;\n};\n\n/**\n * Function: roundLength\n * \n * Hook for rounding the unscaled width or height. This uses Math.round.\n */\nmxVertexHandler.prototype.roundLength = function(length)\n{\n\treturn Math.round(length);\n};\n\n/**\n * Function: mouseMove\n * \n * Handles the event by updating the preview.\n */\nmxVertexHandler.prototype.mouseMove = function(sender, me)\n{\n\tif (!me.isConsumed() && this.index != null)\n\t{\n\t\t// Checks tolerance for ignoring single clicks\n\t\tthis.checkTolerance(me);\n\n\t\tif (!this.inTolerance)\n\t\t{\n\t\t\tif (this.index <= mxEvent.CUSTOM_HANDLE)\n\t\t\t{\n\t\t\t\tif (this.customHandles != null)\n\t\t\t\t{\n\t\t\t\t\tthis.customHandles[mxEvent.CUSTOM_HANDLE - this.index].processEvent(me);\n\t\t\t\t\tthis.customHandles[mxEvent.CUSTOM_HANDLE - this.index].active = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.index == mxEvent.LABEL_HANDLE)\n\t\t\t{\n\t\t\t\tthis.moveLabel(me);\n\t\t\t}\n\t\t\telse if (this.index == mxEvent.ROTATION_HANDLE)\n\t\t\t{\n\t\t\t\tthis.rotateVertex(me);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.resizeVertex(me);\n\t\t\t}\n\n\t\t\tthis.updateHint(me);\n\t\t}\n\t\t\n\t\tme.consume();\n\t}\n\t// Workaround for disabling the connect highlight when over handle\n\telse if (!this.graph.isMouseDown && this.getHandleForEvent(me) != null)\n\t{\n\t\tme.consume(false);\n\t}\n};\n\n/**\n * Function: rotateVertex\n * \n * Rotates the vertex.\n */\nmxVertexHandler.prototype.moveLabel = function(me)\n{\n\tvar point = new mxPoint(me.getGraphX(), me.getGraphY());\n\tvar tr = this.graph.view.translate;\n\tvar scale = this.graph.view.scale;\n\t\n\tif (this.graph.isGridEnabledEvent(me.getEvent()))\n\t{\n\t\tpoint.x = (this.graph.snap(point.x / scale - tr.x) + tr.x) * scale;\n\t\tpoint.y = (this.graph.snap(point.y / scale - tr.y) + tr.y) * scale;\n\t}\n\n\tvar index = (this.rotationShape != null) ? this.sizers.length - 2 : this.sizers.length - 1;\n\tthis.moveSizerTo(this.sizers[index], point.x, point.y);\n};\n\n/**\n * Function: rotateVertex\n * \n * Rotates the vertex.\n */\nmxVertexHandler.prototype.rotateVertex = function(me)\n{\n\tvar point = new mxPoint(me.getGraphX(), me.getGraphY());\n\tvar dx = this.state.x + this.state.width / 2 - point.x;\n\tvar dy = this.state.y + this.state.height / 2 - point.y;\n\tthis.currentAlpha = (dx != 0) ? Math.atan(dy / dx) * 180 / Math.PI + 90 : ((dy < 0) ? 180 : 0);\n\t\n\tif (dx > 0)\n\t{\n\t\tthis.currentAlpha -= 180;\n\t}\n\n\t// Rotation raster\n\tif (this.rotationRaster && this.graph.isGridEnabledEvent(me.getEvent()))\n\t{\n\t\tvar dx = point.x - this.state.getCenterX();\n\t\tvar dy = point.y - this.state.getCenterY();\n\t\tvar dist = Math.abs(Math.sqrt(dx * dx + dy * dy) - 20) * 3;\n\t\tvar raster = Math.max(1, 5 * Math.min(3, Math.max(0, Math.round(80 / Math.abs(dist)))));\n\t\t\n\t\tthis.currentAlpha = Math.round(this.currentAlpha / raster) * raster;\n\t}\n\telse\n\t{\n\t\tthis.currentAlpha = this.roundAngle(this.currentAlpha);\n\t}\n\n\tthis.selectionBorder.rotation = this.currentAlpha;\n\tthis.selectionBorder.redraw();\n\t\t\t\t\t\n\tif (this.livePreview)\n\t{\n\t\tthis.redrawHandles();\n\t}\n};\n\n/**\n * Function: rotateVertex\n * \n * Rotates the vertex.\n */\nmxVertexHandler.prototype.resizeVertex = function(me)\n{\n\tvar ct = new mxPoint(this.state.getCenterX(), this.state.getCenterY());\n\tvar alpha = mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\tvar point = new mxPoint(me.getGraphX(), me.getGraphY());\n\tvar tr = this.graph.view.translate;\n\tvar scale = this.graph.view.scale;\n\tvar cos = Math.cos(-alpha);\n\tvar sin = Math.sin(-alpha);\n\t\n\tvar dx = point.x - this.startX;\n\tvar dy = point.y - this.startY;\n\n\t// Rotates vector for mouse gesture\n\tvar tx = cos * dx - sin * dy;\n\tvar ty = sin * dx + cos * dy;\n\t\n\tdx = tx;\n\tdy = ty;\n\n\tvar geo = this.graph.getCellGeometry(this.state.cell);\n\tthis.unscaledBounds = this.union(geo, dx / scale, dy / scale, this.index,\n\t\tthis.graph.isGridEnabledEvent(me.getEvent()), 1,\n\t\tnew mxPoint(0, 0), this.isConstrainedEvent(me),\n\t\tthis.isCenteredEvent(this.state, me));\n\t\n\t// Keeps vertex within maximum graph or parent bounds\n\tif (!geo.relative)\n\t{\n\t\tvar max = this.graph.getMaximumGraphBounds();\n\t\t\n\t\t// Handles child cells\n\t\tif (max != null && this.parentState != null)\n\t\t{\n\t\t\tmax = mxRectangle.fromRectangle(max);\n\t\t\t\n\t\t\tmax.x -= (this.parentState.x - tr.x * scale) / scale;\n\t\t\tmax.y -= (this.parentState.y - tr.y * scale) / scale;\n\t\t}\n\t\t\n\t\tif (this.graph.isConstrainChild(this.state.cell))\n\t\t{\n\t\t\tvar tmp = this.graph.getCellContainmentArea(this.state.cell);\n\t\t\t\n\t\t\tif (tmp != null)\n\t\t\t{\n\t\t\t\tvar overlap = this.graph.getOverlap(this.state.cell);\n\t\t\t\t\n\t\t\t\tif (overlap > 0)\n\t\t\t\t{\n\t\t\t\t\ttmp = mxRectangle.fromRectangle(tmp);\n\t\t\t\t\t\n\t\t\t\t\ttmp.x -= tmp.width * overlap;\n\t\t\t\t\ttmp.y -= tmp.height * overlap;\n\t\t\t\t\ttmp.width += 2 * tmp.width * overlap;\n\t\t\t\t\ttmp.height += 2 * tmp.height * overlap;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (max == null)\n\t\t\t\t{\n\t\t\t\t\tmax = tmp;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmax = mxRectangle.fromRectangle(max);\n\t\t\t\t\tmax.intersect(tmp);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\n\t\tif (max != null)\n\t\t{\n\t\t\tif (this.unscaledBounds.x < max.x)\n\t\t\t{\n\t\t\t\tthis.unscaledBounds.width -= max.x - this.unscaledBounds.x;\n\t\t\t\tthis.unscaledBounds.x = max.x;\n\t\t\t}\n\t\t\t\n\t\t\tif (this.unscaledBounds.y < max.y)\n\t\t\t{\n\t\t\t\tthis.unscaledBounds.height -= max.y - this.unscaledBounds.y;\n\t\t\t\tthis.unscaledBounds.y = max.y;\n\t\t\t}\n\t\t\t\n\t\t\tif (this.unscaledBounds.x + this.unscaledBounds.width > max.x + max.width)\n\t\t\t{\n\t\t\t\tthis.unscaledBounds.width -= this.unscaledBounds.x +\n\t\t\t\t\tthis.unscaledBounds.width - max.x - max.width;\n\t\t\t}\n\t\t\t\n\t\t\tif (this.unscaledBounds.y + this.unscaledBounds.height > max.y + max.height)\n\t\t\t{\n\t\t\t\tthis.unscaledBounds.height -= this.unscaledBounds.y +\n\t\t\t\t\tthis.unscaledBounds.height - max.y - max.height;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tthis.bounds = new mxRectangle(((this.parentState != null) ? this.parentState.x : tr.x * scale) +\n\t\t(this.unscaledBounds.x) * scale, ((this.parentState != null) ? this.parentState.y : tr.y * scale) +\n\t\t(this.unscaledBounds.y) * scale, this.unscaledBounds.width * scale, this.unscaledBounds.height * scale);\n\n\tif (geo.relative && this.parentState != null)\n\t{\n\t\tthis.bounds.x += this.state.x - this.parentState.x;\n\t\tthis.bounds.y += this.state.y - this.parentState.y;\n\t}\n\n\tcos = Math.cos(alpha);\n\tsin = Math.sin(alpha);\n\t\n\tvar c2 = new mxPoint(this.bounds.getCenterX(), this.bounds.getCenterY());\n\n\tvar dx = c2.x - ct.x;\n\tvar dy = c2.y - ct.y;\n\t\n\tvar dx2 = cos * dx - sin * dy;\n\tvar dy2 = sin * dx + cos * dy;\n\t\n\tvar dx3 = dx2 - dx;\n\tvar dy3 = dy2 - dy;\n\t\n\tvar dx4 = this.bounds.x - this.state.x;\n\tvar dy4 = this.bounds.y - this.state.y;\n\t\n\tvar dx5 = cos * dx4 - sin * dy4;\n\tvar dy5 = sin * dx4 + cos * dy4;\n\t\n\tthis.bounds.x += dx3;\n\tthis.bounds.y += dy3;\n\t\n\t// Rounds unscaled bounds to int\n\tthis.unscaledBounds.x = this.roundLength(this.unscaledBounds.x + dx3 / scale);\n\tthis.unscaledBounds.y = this.roundLength(this.unscaledBounds.y + dy3 / scale);\n\tthis.unscaledBounds.width = this.roundLength(this.unscaledBounds.width);\n\tthis.unscaledBounds.height = this.roundLength(this.unscaledBounds.height);\n\t\n\t// Shifts the children according to parent offset\n\tif (!this.graph.isCellCollapsed(this.state.cell) && (dx3 != 0 || dy3 != 0))\n\t{\n\t\tthis.childOffsetX = this.state.x - this.bounds.x + dx5;\n\t\tthis.childOffsetY = this.state.y - this.bounds.y + dy5;\n\t}\n\telse\n\t{\n\t\tthis.childOffsetX = 0;\n\t\tthis.childOffsetY = 0;\n\t}\n\t\n\tif (this.livePreview)\n\t{\n\t\tthis.updateLivePreview(me);\n\t}\n\t\n\tif (this.preview != null)\n\t{\n\t\tthis.drawPreview();\n\t}\n};\n\n/**\n * Function: updateLivePreview\n * \n * Repaints the live preview.\n */\nmxVertexHandler.prototype.updateLivePreview = function(me)\n{\n\t// TODO: Apply child offset to children in live preview\n\tvar scale = this.graph.view.scale;\n\tvar tr = this.graph.view.translate;\n\t\n\t// Saves current state\n\tvar tempState = this.state.clone();\n\n\t// Temporarily changes size and origin\n\tthis.state.x = this.bounds.x;\n\tthis.state.y = this.bounds.y;\n\tthis.state.origin = new mxPoint(this.state.x / scale - tr.x, this.state.y / scale - tr.y);\n\tthis.state.width = this.bounds.width;\n\tthis.state.height = this.bounds.height;\n\t\n\t// Needed to force update of text bounds\n\tthis.state.unscaledWidth = null;\n\t\n\t// Redraws cell and handles\n\tvar off = this.state.absoluteOffset;\n\toff = new mxPoint(off.x, off.y);\n\n\t// Required to store and reset absolute offset for updating label position\n\tthis.state.absoluteOffset.x = 0;\n\tthis.state.absoluteOffset.y = 0;\n\tvar geo = this.graph.getCellGeometry(this.state.cell);\t\t\t\t\n\n\tif (geo != null)\n\t{\n\t\tvar offset = geo.offset || this.EMPTY_POINT;\n\n\t\tif (offset != null && !geo.relative)\n\t\t{\n\t\t\tthis.state.absoluteOffset.x = this.state.view.scale * offset.x;\n\t\t\tthis.state.absoluteOffset.y = this.state.view.scale * offset.y;\n\t\t}\n\t\t\n\t\tthis.state.view.updateVertexLabelOffset(this.state);\n\t}\n\t\n\t// Draws the live preview\n\tthis.state.view.graph.cellRenderer.redraw(this.state, true);\n\t\n\t// Redraws connected edges TODO: Include child edges\n\tthis.state.view.invalidate(this.state.cell);\n\tthis.state.invalid = false;\n\tthis.state.view.validate();\n\tthis.redrawHandles();\n\t\n\t// Restores current state\n\tthis.state.setState(tempState);\n};\n\n/**\n * Function: mouseUp\n * \n * Handles the event by applying the changes to the geometry.\n */\nmxVertexHandler.prototype.mouseUp = function(sender, me)\n{\n\tif (this.index != null && this.state != null)\n\t{\n\t\tvar point = new mxPoint(me.getGraphX(), me.getGraphY());\n\n\t\tthis.graph.getModel().beginUpdate();\n\t\ttry\n\t\t{\n\t\t\tif (this.index <= mxEvent.CUSTOM_HANDLE)\n\t\t\t{\n\t\t\t\tif (this.customHandles != null)\n\t\t\t\t{\n\t\t\t\t\tthis.customHandles[mxEvent.CUSTOM_HANDLE - this.index].active = false;\n\t\t\t\t\tthis.customHandles[mxEvent.CUSTOM_HANDLE - this.index].execute();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.index == mxEvent.ROTATION_HANDLE)\n\t\t\t{\n\t\t\t\tif (this.currentAlpha != null)\n\t\t\t\t{\n\t\t\t\t\tvar delta = this.currentAlpha - (this.state.style[mxConstants.STYLE_ROTATION] || 0);\n\t\t\t\t\t\n\t\t\t\t\tif (delta != 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.rotateCell(this.state.cell, delta);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.rotateClick();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar gridEnabled = this.graph.isGridEnabledEvent(me.getEvent());\n\t\t\t\tvar alpha = mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\t\t\t\tvar cos = Math.cos(-alpha);\n\t\t\t\tvar sin = Math.sin(-alpha);\n\t\t\t\t\n\t\t\t\tvar dx = point.x - this.startX;\n\t\t\t\tvar dy = point.y - this.startY;\n\t\t\t\t\n\t\t\t\t// Rotates vector for mouse gesture\n\t\t\t\tvar tx = cos * dx - sin * dy;\n\t\t\t\tvar ty = sin * dx + cos * dy;\n\t\t\t\t\n\t\t\t\tdx = tx;\n\t\t\t\tdy = ty;\n\t\t\t\t\n\t\t\t\tvar s = this.graph.view.scale;\n\t\t\t\tvar recurse = this.isRecursiveResize(this.state, me);\n\t\t\t\tthis.resizeCell(this.state.cell, this.roundLength(dx / s), this.roundLength(dy / s),\n\t\t\t\t\tthis.index, gridEnabled, this.isConstrainedEvent(me), recurse);\n\t\t\t}\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tthis.graph.getModel().endUpdate();\n\t\t}\n\n\t\tme.consume();\n\t\tthis.reset();\n\t}\n};\n\n/**\n * Function: rotateCell\n * \n * Rotates the given cell to the given rotation.\n */\nmxVertexHandler.prototype.isRecursiveResize = function(state, me)\n{\n\treturn this.graph.isRecursiveResize(this.state);\n};\n\n/**\n * Function: rotateClick\n * \n * Hook for subclassers to implement a single click on the rotation handle.\n * This code is executed as part of the model transaction. This implementation\n * is empty.\n */\nmxVertexHandler.prototype.rotateClick = function() { };\n\n/**\n * Function: rotateCell\n * \n * Rotates the given cell and its children by the given angle in degrees.\n * \n * Parameters:\n * \n * cell - <mxCell> to be rotated.\n * angle - Angle in degrees.\n */\nmxVertexHandler.prototype.rotateCell = function(cell, angle, parent)\n{\n\tif (angle != 0)\n\t{\n\t\tvar model = this.graph.getModel();\n\n\t\tif (model.isVertex(cell) || model.isEdge(cell))\n\t\t{\n\t\t\tif (!model.isEdge(cell))\n\t\t\t{\n\t\t\t\tvar state = this.graph.view.getState(cell);\n\t\t\t\tvar style = (state != null) ? state.style : this.graph.getCellStyle(cell);\n\t\t\n\t\t\t\tif (style != null)\n\t\t\t\t{\n\t\t\t\t\tvar total = (style[mxConstants.STYLE_ROTATION] || 0) + angle;\n\t\t\t\t\tthis.graph.setCellStyles(mxConstants.STYLE_ROTATION, total, [cell]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar geo = this.graph.getCellGeometry(cell);\n\t\t\t\n\t\t\tif (geo != null)\n\t\t\t{\n\t\t\t\tvar pgeo = this.graph.getCellGeometry(parent);\n\t\t\t\t\n\t\t\t\tif (pgeo != null && !model.isEdge(parent))\n\t\t\t\t{\n\t\t\t\t\tgeo = geo.clone();\n\t\t\t\t\tgeo.rotate(angle, new mxPoint(pgeo.width / 2, pgeo.height / 2));\n\t\t\t\t\tmodel.setGeometry(cell, geo);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif ((model.isVertex(cell) && !geo.relative) || model.isEdge(cell))\n\t\t\t\t{\n\t\t\t\t\t// Recursive rotation\n\t\t\t\t\tvar childCount = model.getChildCount(cell);\n\t\t\t\t\t\n\t\t\t\t\tfor (var i = 0; i < childCount; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.rotateCell(model.getChildAt(cell, i), angle, cell);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\n/**\n * Function: reset\n * \n * Resets the state of this handler.\n */\nmxVertexHandler.prototype.reset = function()\n{\n\tif (this.sizers != null && this.index != null && this.sizers[this.index] != null &&\n\t\tthis.sizers[this.index].node.style.display == 'none')\n\t{\n\t\tthis.sizers[this.index].node.style.display = '';\n\t}\n\n\tthis.currentAlpha = null;\n\tthis.inTolerance = null;\n\tthis.index = null;\n\n\t// TODO: Reset and redraw cell states for live preview\n\tif (this.preview != null)\n\t{\n\t\tthis.preview.destroy();\n\t\tthis.preview = null;\n\t}\n\n\tif (this.livePreview && this.sizers != null)\n\t{\n\t\tfor (var i = 0; i < this.sizers.length; i++)\n\t\t{\n\t\t\tif (this.sizers[i] != null)\n\t\t\t{\n\t\t\t\tthis.sizers[i].node.style.display = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tif (this.customHandles != null)\n\t{\n\t\tfor (var i = 0; i < this.customHandles.length; i++)\n\t\t{\n\t\t\tif (this.customHandles[i].active)\n\t\t\t{\n\t\t\t\tthis.customHandles[i].active = false;\n\t\t\t\tthis.customHandles[i].reset();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.customHandles[i].setVisible(true);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// Checks if handler has been destroyed\n\tif (this.selectionBorder != null)\n\t{\n\t\tthis.selectionBorder.node.style.display = 'inline';\n\t\tthis.selectionBounds = this.getSelectionBounds(this.state);\n\t\tthis.bounds = new mxRectangle(this.selectionBounds.x, this.selectionBounds.y,\n\t\t\tthis.selectionBounds.width, this.selectionBounds.height);\n\t\tthis.drawPreview();\n\t}\n\n\tthis.removeHint();\n\tthis.redrawHandles();\n\tthis.edgeHandlers = null;\n\tthis.unscaledBounds = null;\n};\n\n/**\n * Function: resizeCell\n * \n * Uses the given vector to change the bounds of the given cell\n * in the graph using <mxGraph.resizeCell>.\n */\nmxVertexHandler.prototype.resizeCell = function(cell, dx, dy, index, gridEnabled, constrained, recurse)\n{\n\tvar geo = this.graph.model.getGeometry(cell);\n\t\n\tif (geo != null)\n\t{\n\t\tif (index == mxEvent.LABEL_HANDLE)\n\t\t{\n\t\t\tvar scale = this.graph.view.scale;\n\t\t\tdx = Math.round((this.labelShape.bounds.getCenterX() - this.startX) / scale);\n\t\t\tdy = Math.round((this.labelShape.bounds.getCenterY() - this.startY) / scale);\n\t\t\t\n\t\t\tgeo = geo.clone();\n\t\t\t\n\t\t\tif (geo.offset == null)\n\t\t\t{\n\t\t\t\tgeo.offset = new mxPoint(dx, dy);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tgeo.offset.x += dx;\n\t\t\t\tgeo.offset.y += dy;\n\t\t\t}\n\t\t\t\n\t\t\tthis.graph.model.setGeometry(cell, geo);\n\t\t}\n\t\telse if (this.unscaledBounds != null)\n\t\t{\n\t\t\tvar scale = this.graph.view.scale;\n\n\t\t\tif (this.childOffsetX != 0 || this.childOffsetY != 0)\n\t\t\t{\n\t\t\t\tthis.moveChildren(cell, Math.round(this.childOffsetX / scale), Math.round(this.childOffsetY / scale));\n\t\t\t}\n\n\t\t\tthis.graph.resizeCell(cell, this.unscaledBounds, recurse);\n\t\t}\n\t}\n};\n\n/**\n * Function: moveChildren\n * \n * Moves the children of the given cell by the given vector.\n */\nmxVertexHandler.prototype.moveChildren = function(cell, dx, dy)\n{\n\tvar model = this.graph.getModel();\n\tvar childCount = model.getChildCount(cell);\n\t\n\tfor (var i = 0; i < childCount; i++)\n\t{\n\t\tvar child = model.getChildAt(cell, i);\n\t\tvar geo = this.graph.getCellGeometry(child);\n\t\t\n\t\tif (geo != null)\n\t\t{\n\t\t\tgeo = geo.clone();\n\t\t\tgeo.translate(dx, dy);\n\t\t\tmodel.setGeometry(child, geo);\n\t\t}\n\t}\n};\n/**\n * Function: union\n * \n * Returns the union of the given bounds and location for the specified\n * handle index.\n * \n * To override this to limit the size of vertex via a minWidth/-Height style,\n * the following code can be used.\n * \n * (code)\n * var vertexHandlerUnion = mxVertexHandler.prototype.union;\n * mxVertexHandler.prototype.union = function(bounds, dx, dy, index, gridEnabled, scale, tr, constrained)\n * {\n *   var result = vertexHandlerUnion.apply(this, arguments);\n *   \n *   result.width = Math.max(result.width, mxUtils.getNumber(this.state.style, 'minWidth', 0));\n *   result.height = Math.max(result.height, mxUtils.getNumber(this.state.style, 'minHeight', 0));\n *   \n *   return result;\n * };\n * (end)\n * \n * The minWidth/-Height style can then be used as follows:\n * \n * (code)\n * graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30, 'minWidth=100;minHeight=100;');\n * (end)\n * \n * To override this to update the height for a wrapped text if the width of a vertex is\n * changed, the following can be used.\n * \n * (code)\n * var mxVertexHandlerUnion = mxVertexHandler.prototype.union;\n * mxVertexHandler.prototype.union = function(bounds, dx, dy, index, gridEnabled, scale, tr, constrained)\n * {\n *   var result = mxVertexHandlerUnion.apply(this, arguments);\n *   var s = this.state;\n *   \n *   if (this.graph.isHtmlLabel(s.cell) && (index == 3 || index == 4) &&\n *       s.text != null && s.style[mxConstants.STYLE_WHITE_SPACE] == 'wrap')\n *   {\n *     var label = this.graph.getLabel(s.cell);\n *     var fontSize = mxUtils.getNumber(s.style, mxConstants.STYLE_FONTSIZE, mxConstants.DEFAULT_FONTSIZE);\n *     var ww = result.width / s.view.scale - s.text.spacingRight - s.text.spacingLeft\n *     \n *     result.height = mxUtils.getSizeForString(label, fontSize, s.style[mxConstants.STYLE_FONTFAMILY], ww).height;\n *   }\n *   \n *   return result;\n * };\n * (end)\n */\nmxVertexHandler.prototype.union = function(bounds, dx, dy, index, gridEnabled, scale, tr, constrained, centered)\n{\n\tif (this.singleSizer)\n\t{\n\t\tvar x = bounds.x + bounds.width + dx;\n\t\tvar y = bounds.y + bounds.height + dy;\n\t\t\n\t\tif (gridEnabled)\n\t\t{\n\t\t\tx = this.graph.snap(x / scale) * scale;\n\t\t\ty = this.graph.snap(y / scale) * scale;\n\t\t}\n\t\t\n\t\tvar rect = new mxRectangle(bounds.x, bounds.y, 0, 0);\n\t\trect.add(new mxRectangle(x, y, 0, 0));\n\t\t\n\t\treturn rect;\n\t}\n\telse\n\t{\n\t\tvar w0 = bounds.width;\n\t\tvar h0 = bounds.height;\n\t\tvar left = bounds.x - tr.x * scale;\n\t\tvar right = left + w0;\n\t\tvar top = bounds.y - tr.y * scale;\n\t\tvar bottom = top + h0;\n\t\t\n\t\tvar cx = left + w0 / 2;\n\t\tvar cy = top + h0 / 2;\n\t\t\n\t\tif (index > 4 /* Bottom Row */)\n\t\t{\n\t\t\tbottom = bottom + dy;\n\t\t\t\n\t\t\tif (gridEnabled)\n\t\t\t{\n\t\t\t\tbottom = this.graph.snap(bottom / scale) * scale;\n\t\t\t}\n\t\t}\n\t\telse if (index < 3 /* Top Row */)\n\t\t{\n\t\t\ttop = top + dy;\n\t\t\t\n\t\t\tif (gridEnabled)\n\t\t\t{\n\t\t\t\ttop = this.graph.snap(top / scale) * scale;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (index == 0 || index == 3 || index == 5 /* Left */)\n\t\t{\n\t\t\tleft += dx;\n\t\t\t\n\t\t\tif (gridEnabled)\n\t\t\t{\n\t\t\t\tleft = this.graph.snap(left / scale) * scale;\n\t\t\t}\n\t\t}\n\t\telse if (index == 2 || index == 4 || index == 7 /* Right */)\n\t\t{\n\t\t\tright += dx;\n\t\t\t\n\t\t\tif (gridEnabled)\n\t\t\t{\n\t\t\t\tright = this.graph.snap(right / scale) * scale;\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar width = right - left;\n\t\tvar height = bottom - top;\n\n\t\tif (constrained)\n\t\t{\n\t\t\tvar geo = this.graph.getCellGeometry(this.state.cell);\n\n\t\t\tif (geo != null)\n\t\t\t{\n\t\t\t\tvar aspect = geo.width / geo.height;\n\t\t\t\t\n\t\t\t\tif (index== 1 || index== 2 || index == 7 || index == 6)\n\t\t\t\t{\n\t\t\t\t\twidth = height * aspect;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\theight = width / aspect;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (index == 0)\n\t\t\t\t{\n\t\t\t\t\tleft = right - width;\n\t\t\t\t\ttop = bottom - height;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (centered)\n\t\t{\n\t\t\twidth += (width - w0);\n\t\t\theight += (height - h0);\n\t\t\t\n\t\t\tvar cdx = cx - (left + width / 2);\n\t\t\tvar cdy = cy - (top + height / 2);\n\n\t\t\tleft += cdx;\n\t\t\ttop += cdy;\n\t\t\tright += cdx;\n\t\t\tbottom += cdy;\n\t\t}\n\n\t\t// Flips over left side\n\t\tif (width < 0)\n\t\t{\n\t\t\tleft += width;\n\t\t\twidth = Math.abs(width);\n\t\t}\n\t\t\n\t\t// Flips over top side\n\t\tif (height < 0)\n\t\t{\n\t\t\ttop += height;\n\t\t\theight = Math.abs(height);\n\t\t}\n\n\t\tvar result = new mxRectangle(left + tr.x * scale, top + tr.y * scale, width, height);\n\t\t\n\t\tif (this.minBounds != null)\n\t\t{\n\t\t\tresult.width = Math.max(result.width, this.minBounds.x * scale + this.minBounds.width * scale +\n\t\t\t\tMath.max(0, this.x0 * scale - result.x));\n\t\t\tresult.height = Math.max(result.height, this.minBounds.y * scale + this.minBounds.height * scale +\n\t\t\t\tMath.max(0, this.y0 * scale - result.y));\n\t\t}\n\t\t\n\t\treturn result;\n\t}\n};\n\n/**\n * Function: redraw\n * \n * Redraws the handles and the preview.\n */\nmxVertexHandler.prototype.redraw = function()\n{\n\tthis.selectionBounds = this.getSelectionBounds(this.state);\n\tthis.bounds = new mxRectangle(this.selectionBounds.x, this.selectionBounds.y, this.selectionBounds.width, this.selectionBounds.height);\n\t\n\tthis.redrawHandles();\n\tthis.drawPreview();\n};\n\n/**\n * Returns the padding to be used for drawing handles for the current <bounds>.\n */\nmxVertexHandler.prototype.getHandlePadding = function()\n{\n\t// KNOWN: Tolerance depends on event type (eg. 0 for mouse events)\n\tvar result = new mxPoint(0, 0);\n\tvar tol = this.tolerance;\n\n\tif (this.sizers != null && this.sizers.length > 0 && this.sizers[0] != null &&\n\t\t(this.bounds.width < 2 * this.sizers[0].bounds.width + 2 * tol ||\n\t\tthis.bounds.height < 2 * this.sizers[0].bounds.height + 2 * tol))\n\t{\n\t\ttol /= 2;\n\t\t\n\t\tresult.x = this.sizers[0].bounds.width + tol;\n\t\tresult.y = this.sizers[0].bounds.height + tol;\n\t}\n\t\n\treturn result;\n};\n\n/**\n * Function: redrawHandles\n * \n * Redraws the handles. To hide certain handles the following code can be used.\n * \n * (code)\n * mxVertexHandler.prototype.redrawHandles = function()\n * {\n *   mxVertexHandlerRedrawHandles.apply(this, arguments);\n *   \n *   if (this.sizers != null && this.sizers.length > 7)\n *   {\n *     this.sizers[1].node.style.display = 'none';\n *     this.sizers[6].node.style.display = 'none';\n *   }\n * };\n * (end)\n */\nmxVertexHandler.prototype.redrawHandles = function()\n{\n\tvar tol = this.tolerance;\n\tthis.horizontalOffset = 0;\n\tthis.verticalOffset = 0;\n\tvar s = this.bounds;\n\n\tif (this.sizers != null && this.sizers.length > 0 && this.sizers[0] != null)\n\t{\n\t\tif (this.index == null && this.manageSizers && this.sizers.length >= 8)\n\t\t{\n\t\t\t// KNOWN: Tolerance depends on event type (eg. 0 for mouse events)\n\t\t\tvar padding = this.getHandlePadding();\n\t\t\tthis.horizontalOffset = padding.x;\n\t\t\tthis.verticalOffset = padding.y;\n\t\t\t\n\t\t\tif (this.horizontalOffset != 0 || this.verticalOffset != 0)\n\t\t\t{\n\t\t\t\ts = new mxRectangle(s.x, s.y, s.width, s.height);\n\n\t\t\t\ts.x -= this.horizontalOffset / 2;\n\t\t\t\ts.width += this.horizontalOffset;\n\t\t\t\ts.y -= this.verticalOffset / 2;\n\t\t\t\ts.height += this.verticalOffset;\n\t\t\t}\n\t\t\t\n\t\t\tif (this.sizers.length >= 8)\n\t\t\t{\n\t\t\t\tif ((s.width < 2 * this.sizers[0].bounds.width + 2 * tol) ||\n\t\t\t\t\t(s.height < 2 * this.sizers[0].bounds.height + 2 * tol))\n\t\t\t\t{\n\t\t\t\t\tthis.sizers[0].node.style.display = 'none';\n\t\t\t\t\tthis.sizers[2].node.style.display = 'none';\n\t\t\t\t\tthis.sizers[5].node.style.display = 'none';\n\t\t\t\t\tthis.sizers[7].node.style.display = 'none';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.sizers[0].node.style.display = '';\n\t\t\t\t\tthis.sizers[2].node.style.display = '';\n\t\t\t\t\tthis.sizers[5].node.style.display = '';\n\t\t\t\t\tthis.sizers[7].node.style.display = '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar r = s.x + s.width;\n\t\tvar b = s.y + s.height;\n\t\t\n\t\tif (this.singleSizer)\n\t\t{\n\t\t\tthis.moveSizerTo(this.sizers[0], r, b);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar cx = s.x + s.width / 2;\n\t\t\tvar cy = s.y + s.height / 2;\n\t\t\t\n\t\t\tif (this.sizers.length >= 8)\n\t\t\t{\n\t\t\t\tvar crs = ['nw-resize', 'n-resize', 'ne-resize', 'e-resize', 'se-resize', 's-resize', 'sw-resize', 'w-resize'];\n\t\t\t\t\n\t\t\t\tvar alpha = mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\t\t\t\tvar cos = Math.cos(alpha);\n\t\t\t\tvar sin = Math.sin(alpha);\n\t\t\t\t\n\t\t\t\tvar da = Math.round(alpha * 4 / Math.PI);\n\t\t\t\t\n\t\t\t\tvar ct = new mxPoint(s.getCenterX(), s.getCenterY());\n\t\t\t\tvar pt = mxUtils.getRotatedPoint(new mxPoint(s.x, s.y), cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[0], pt.x, pt.y);\n\t\t\t\tthis.sizers[0].setCursor(crs[mxUtils.mod(0 + da, crs.length)]);\n\t\t\t\t\n\t\t\t\tpt.x = cx;\n\t\t\t\tpt.y = s.y;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[1], pt.x, pt.y);\n\t\t\t\tthis.sizers[1].setCursor(crs[mxUtils.mod(1 + da, crs.length)]);\n\t\t\t\t\n\t\t\t\tpt.x = r;\n\t\t\t\tpt.y = s.y;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[2], pt.x, pt.y);\n\t\t\t\tthis.sizers[2].setCursor(crs[mxUtils.mod(2 + da, crs.length)]);\n\t\t\t\t\n\t\t\t\tpt.x = s.x;\n\t\t\t\tpt.y = cy;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[3], pt.x, pt.y);\n\t\t\t\tthis.sizers[3].setCursor(crs[mxUtils.mod(7 + da, crs.length)]);\n\n\t\t\t\tpt.x = r;\n\t\t\t\tpt.y = cy;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[4], pt.x, pt.y);\n\t\t\t\tthis.sizers[4].setCursor(crs[mxUtils.mod(3 + da, crs.length)]);\n\n\t\t\t\tpt.x = s.x;\n\t\t\t\tpt.y = b;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[5], pt.x, pt.y);\n\t\t\t\tthis.sizers[5].setCursor(crs[mxUtils.mod(6 + da, crs.length)]);\n\n\t\t\t\tpt.x = cx;\n\t\t\t\tpt.y = b;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[6], pt.x, pt.y);\n\t\t\t\tthis.sizers[6].setCursor(crs[mxUtils.mod(5 + da, crs.length)]);\n\n\t\t\t\tpt.x = r;\n\t\t\t\tpt.y = b;\n\t\t\t\tpt = mxUtils.getRotatedPoint(pt, cos, sin, ct);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[7], pt.x, pt.y);\n\t\t\t\tthis.sizers[7].setCursor(crs[mxUtils.mod(4 + da, crs.length)]);\n\t\t\t\t\n\t\t\t\tthis.moveSizerTo(this.sizers[8], cx + this.state.absoluteOffset.x, cy + this.state.absoluteOffset.y);\n\t\t\t}\n\t\t\telse if (this.state.width >= 2 && this.state.height >= 2)\n\t\t\t{\n\t\t\t\tthis.moveSizerTo(this.sizers[0], cx + this.state.absoluteOffset.x, cy + this.state.absoluteOffset.y);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveSizerTo(this.sizers[0], this.state.x, this.state.y);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (this.rotationShape != null)\n\t{\n\t\tvar alpha = mxUtils.toRadians((this.currentAlpha != null) ? this.currentAlpha : this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\t\tvar cos = Math.cos(alpha);\n\t\tvar sin = Math.sin(alpha);\n\t\t\n\t\tvar ct = new mxPoint(this.state.getCenterX(), this.state.getCenterY());\n\t\tvar pt = mxUtils.getRotatedPoint(this.getRotationHandlePosition(), cos, sin, ct);\n\n\t\tif (this.rotationShape.node != null)\n\t\t{\n\t\t\tthis.moveSizerTo(this.rotationShape, pt.x, pt.y);\n\n\t\t\t// Hides rotation handle during text editing\n\t\t\tthis.rotationShape.node.style.visibility = (this.state.view.graph.isEditing()) ? 'hidden' : '';\n\t\t}\n\t}\n\t\n\tif (this.selectionBorder != null)\n\t{\n\t\tthis.selectionBorder.rotation = Number(this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\t}\n\t\n\tif (this.edgeHandlers != null)\n\t{\t\t\n\t\tfor (var i = 0; i < this.edgeHandlers.length; i++)\n\t\t{\n\t\t\tthis.edgeHandlers[i].redraw();\n\t\t}\n\t}\n\n\tif (this.customHandles != null)\n\t{\n\t\tfor (var i = 0; i < this.customHandles.length; i++)\n\t\t{\n\t\t\tvar temp = this.customHandles[i].shape.node.style.display;\n\t\t\tthis.customHandles[i].redraw();\n\t\t\tthis.customHandles[i].shape.node.style.display = temp;\n\n\t\t\t// Hides custom handles during text editing\n\t\t\tthis.customHandles[i].shape.node.style.visibility = (this.graph.isEditing()) ? 'hidden' : '';\n\t\t}\n\t}\n\n\tthis.updateParentHighlight();\n};\n\n/**\n * Function: getRotationHandlePosition\n * \n * Returns an <mxPoint> that defines the rotation handle position.\n */\nmxVertexHandler.prototype.getRotationHandlePosition = function()\n{\n\treturn new mxPoint(this.bounds.x + this.bounds.width / 2, this.bounds.y + this.rotationHandleVSpacing)\n};\n\n/**\n * Function: updateParentHighlight\n * \n * Updates the highlight of the parent if <parentHighlightEnabled> is true.\n */\nmxVertexHandler.prototype.updateParentHighlight = function()\n{\n\t// If not destroyed\n\tif (this.selectionBorder != null)\n\t{\n\t\tif (this.parentHighlight != null)\n\t\t{\n\t\t\tvar parent = this.graph.model.getParent(this.state.cell);\n\t\n\t\t\tif (this.graph.model.isVertex(parent))\n\t\t\t{\n\t\t\t\tvar pstate = this.graph.view.getState(parent);\n\t\t\t\tvar b = this.parentHighlight.bounds;\n\t\t\t\t\n\t\t\t\tif (pstate != null && (b.x != pstate.x || b.y != pstate.y ||\n\t\t\t\t\tb.width != pstate.width || b.height != pstate.height))\n\t\t\t\t{\n\t\t\t\t\tthis.parentHighlight.bounds = pstate;\n\t\t\t\t\tthis.parentHighlight.redraw();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.parentHighlight.destroy();\n\t\t\t\tthis.parentHighlight = null;\n\t\t\t}\n\t\t}\n\t\telse if (this.parentHighlightEnabled)\n\t\t{\n\t\t\tvar parent = this.graph.model.getParent(this.state.cell);\n\t\t\t\n\t\t\tif (this.graph.model.isVertex(parent))\n\t\t\t{\n\t\t\t\tvar pstate = this.graph.view.getState(parent);\n\t\t\t\t\n\t\t\t\tif (pstate != null)\n\t\t\t\t{\n\t\t\t\t\tthis.parentHighlight = this.createParentHighlightShape(pstate);\n\t\t\t\t\t// VML dialect required here for event transparency in IE\n\t\t\t\t\tthis.parentHighlight.dialect = (this.graph.dialect != mxConstants.DIALECT_SVG) ? mxConstants.DIALECT_VML : mxConstants.DIALECT_SVG;\n\t\t\t\t\tthis.parentHighlight.pointerEvents = false;\n\t\t\t\t\tthis.parentHighlight.rotation = Number(pstate.style[mxConstants.STYLE_ROTATION] || '0');\n\t\t\t\t\tthis.parentHighlight.init(this.graph.getView().getOverlayPane());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\n/**\n * Function: drawPreview\n * \n * Redraws the preview.\n */\nmxVertexHandler.prototype.drawPreview = function()\n{\n\tif (this.preview != null)\n\t{\n\t\tthis.preview.bounds = this.bounds;\n\t\t\n\t\tif (this.preview.node.parentNode == this.graph.container)\n\t\t{\n\t\t\tthis.preview.bounds.width = Math.max(0, this.preview.bounds.width - 1);\n\t\t\tthis.preview.bounds.height = Math.max(0, this.preview.bounds.height - 1);\n\t\t}\n\t\n\t\tthis.preview.rotation = Number(this.state.style[mxConstants.STYLE_ROTATION] || '0');\n\t\tthis.preview.redraw();\n\t}\n\t\n\tthis.selectionBorder.bounds = this.bounds;\n\tthis.selectionBorder.redraw();\n\t\n\tif (this.parentHighlight != null)\n\t{\n\t\tthis.parentHighlight.redraw();\n\t}\n};\n\n/**\n * Function: destroy\n * \n * Destroys the handler and all its resources and DOM nodes.\n */\nmxVertexHandler.prototype.destroy = function()\n{\n\tif (this.escapeHandler != null)\n\t{\n\t\tthis.state.view.graph.removeListener(this.escapeHandler);\n\t\tthis.escapeHandler = null;\n\t}\n\t\n\tif (this.preview != null)\n\t{\n\t\tthis.preview.destroy();\n\t\tthis.preview = null;\n\t}\n\t\n\tif (this.parentHighlight != null)\n\t{\n\t\tthis.parentHighlight.destroy();\n\t\tthis.parentHighlight = null;\n\t}\n\t\n\tif (this.selectionBorder != null)\n\t{\n\t\tthis.selectionBorder.destroy();\n\t\tthis.selectionBorder = null;\n\t}\n\t\n\tthis.labelShape = null;\n\tthis.removeHint();\n\n\tif (this.sizers != null)\n\t{\n\t\tfor (var i = 0; i < this.sizers.length; i++)\n\t\t{\n\t\t\tthis.sizers[i].destroy();\n\t\t}\n\t\t\n\t\tthis.sizers = null;\n\t}\n\n\tif (this.customHandles != null)\n\t{\n\t\tfor (var i = 0; i < this.customHandles.length; i++)\n\t\t{\n\t\t\tthis.customHandles[i].destroy();\n\t\t}\n\t\t\n\t\tthis.customHandles = null;\n\t}\n};\n\n__mxOutput.mxVertexHandler = typeof mxVertexHandler !== 'undefined' ? mxVertexHandler : undefined;\n"]}