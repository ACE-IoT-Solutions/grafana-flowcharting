{"version":3,"sources":["../../../../../../src/mxgraph/javascript/dist/js/handler/mxPopupMenuHandler.js"],"names":["mxPopupMenuHandler","graph","factoryMethod","addMouseListener","gestureHandler","mxUtils","bind","sender","eo","inTolerance","addListener","mxEvent","GESTURE","init","prototype","mxPopupMenu","constructor","selectOnPopup","clearSelectionOnBackground","triggerX","triggerY","screenX","screenY","apply","addGestureListeners","div","evt","tooltipHandler","hide","isSelectOnPopup","me","mouseDown","isEnabled","isMultiTouchEvent","getEvent","hideMenu","getGraphX","getGraphY","getMainEvent","popupTrigger","isPopupTrigger","mouseMove","Math","abs","tolerance","mouseUp","cell","getCellForPopupEvent","isCellSelected","setSelectionCell","clearSelection","origin","getScrollOrigin","popup","getX","x","getY","y","consume","getCell","destroy","removeMouseListener","removeListener","__mxOutput","undefined"],"mappings":";;;;;AAAA;;;;AAIA;;;;;;;;;AASA,UAASA,kBAAT,CAA4BC,KAA5B,EAAmCC,aAAnC,EACA;AACC,MAAID,SAAS,IAAb,EACA;AACC,QAAKA,KAAL,GAAaA,KAAb;AACA,QAAKC,aAAL,GAAqBA,aAArB;AACA,QAAKD,KAAL,CAAWE,gBAAX,CAA4B,IAA5B;;AAEA;AACA,QAAKC,cAAL,GAAsBC,QAAQC,IAAR,CAAa,IAAb,EAAmB,UAASC,MAAT,EAAiBC,EAAjB,EACzC;AACC,SAAKC,WAAL,GAAmB,KAAnB;AACA,IAHqB,CAAtB;;AAKA,QAAKR,KAAL,CAAWS,WAAX,CAAuBC,QAAQC,OAA/B,EAAwC,KAAKR,cAA7C;;AAEA,QAAKS,IAAL;AACA;AACD,E;;;AAAA;;AAED;;;AAGAb,sBAAmBc,SAAnB,GAA+B,IAAIC,WAAJ,EAA/B;AACAf,sBAAmBc,SAAnB,CAA6BE,WAA7B,GAA2ChB,kBAA3C;;AAEA;;;;;AAKAA,sBAAmBc,SAAnB,CAA6Bb,KAA7B,GAAqC,IAArC;;AAEA;;;;;;AAMAD,sBAAmBc,SAAnB,CAA6BG,aAA7B,GAA6C,IAA7C;;AAEA;;;;;;AAMAjB,sBAAmBc,SAAnB,CAA6BI,0BAA7B,GAA0D,IAA1D;;AAEA;;;;;AAKAlB,sBAAmBc,SAAnB,CAA6BK,QAA7B,GAAwC,IAAxC;;AAEA;;;;;AAKAnB,sBAAmBc,SAAnB,CAA6BM,QAA7B,GAAwC,IAAxC;;AAEA;;;;;AAKApB,sBAAmBc,SAAnB,CAA6BO,OAA7B,GAAuC,IAAvC;;AAEA;;;;;AAKArB,sBAAmBc,SAAnB,CAA6BQ,OAA7B,GAAuC,IAAvC;;AAEA;;;;;AAKAtB,sBAAmBc,SAAnB,CAA6BD,IAA7B,GAAoC,YACpC;AACC;AACAE,gBAAYD,SAAZ,CAAsBD,IAAtB,CAA2BU,KAA3B,CAAiC,IAAjC;;AAEA;AACA;AACAZ,YAAQa,mBAAR,CAA4B,KAAKC,GAAjC,EAAsCpB,QAAQC,IAAR,CAAa,IAAb,EAAmB,UAASoB,GAAT,EACzD;AACC,UAAKzB,KAAL,CAAW0B,cAAX,CAA0BC,IAA1B;AACA,KAHqC,CAAtC;AAIA,IAXD;;AAaA;;;;;;AAMA5B,sBAAmBc,SAAnB,CAA6Be,eAA7B,GAA+C,UAASC,EAAT,EAC/C;AACC,WAAO,KAAKb,aAAZ;AACA,IAHD;;AAKA;;;;;;AAMAjB,sBAAmBc,SAAnB,CAA6BiB,SAA7B,GAAyC,UAASxB,MAAT,EAAiBuB,EAAjB,EACzC;AACC,QAAI,KAAKE,SAAL,MAAoB,CAACrB,QAAQsB,iBAAR,CAA0BH,GAAGI,QAAH,EAA1B,CAAzB,EACA;AACC;AACA,UAAKC,QAAL;AACA,UAAKhB,QAAL,GAAgBW,GAAGM,SAAH,EAAhB;AACA,UAAKhB,QAAL,GAAgBU,GAAGO,SAAH,EAAhB;AACA,UAAKhB,OAAL,GAAeV,QAAQ2B,YAAR,CAAqBR,GAAGI,QAAH,EAArB,EAAoCb,OAAnD;AACA,UAAKC,OAAL,GAAeX,QAAQ2B,YAAR,CAAqBR,GAAGI,QAAH,EAArB,EAAoCZ,OAAnD;AACA,UAAKiB,YAAL,GAAoB,KAAKC,cAAL,CAAoBV,EAApB,CAApB;AACA,UAAKrB,WAAL,GAAmB,IAAnB;AACA;AACD,IAbD;;AAeA;;;;;AAKAT,sBAAmBc,SAAnB,CAA6B2B,SAA7B,GAAyC,UAASlC,MAAT,EAAiBuB,EAAjB,EACzC;AACC;AACA,QAAI,KAAKrB,WAAL,IAAoB,KAAKY,OAAL,IAAgB,IAApC,IAA4C,KAAKC,OAAL,IAAgB,IAAhE,EACA;AACC,SAAIoB,KAAKC,GAAL,CAAShC,QAAQ2B,YAAR,CAAqBR,GAAGI,QAAH,EAArB,EAAoCb,OAApC,GAA8C,KAAKA,OAA5D,IAAuE,KAAKpB,KAAL,CAAW2C,SAAlF,IACHF,KAAKC,GAAL,CAAShC,QAAQ2B,YAAR,CAAqBR,GAAGI,QAAH,EAArB,EAAoCZ,OAApC,GAA8C,KAAKA,OAA5D,IAAuE,KAAKrB,KAAL,CAAW2C,SADnF,EAEA;AACC,WAAKnC,WAAL,GAAmB,KAAnB;AACA;AACD;AACD,IAXD;;AAaA;;;;;;AAMAT,sBAAmBc,SAAnB,CAA6B+B,OAA7B,GAAuC,UAAStC,MAAT,EAAiBuB,EAAjB,EACvC;AACC,QAAI,KAAKS,YAAL,IAAqB,KAAK9B,WAA1B,IAAyC,KAAKU,QAAL,IAAiB,IAA1D,IAAkE,KAAKC,QAAL,IAAiB,IAAvF,EACA;AACC,SAAI0B,OAAO,KAAKC,oBAAL,CAA0BjB,EAA1B,CAAX;;AAEA;AACA,SAAI,KAAK7B,KAAL,CAAW+B,SAAX,MAA0B,KAAKH,eAAL,CAAqBC,EAArB,CAA1B,IACHgB,QAAQ,IADL,IACa,CAAC,KAAK7C,KAAL,CAAW+C,cAAX,CAA0BF,IAA1B,CADlB,EAEA;AACC,WAAK7C,KAAL,CAAWgD,gBAAX,CAA4BH,IAA5B;AACA,MAJD,MAKK,IAAI,KAAK5B,0BAAL,IAAmC4B,QAAQ,IAA/C,EACL;AACC,WAAK7C,KAAL,CAAWiD,cAAX;AACA;;AAED;AACA,UAAKjD,KAAL,CAAW0B,cAAX,CAA0BC,IAA1B;;AAEA;AACA;AACA,SAAIuB,SAAS9C,QAAQ+C,eAAR,EAAb;AACA,UAAKC,KAAL,CAAWvB,GAAGwB,IAAH,KAAYH,OAAOI,CAAnB,GAAuB,CAAlC,EAAqCzB,GAAG0B,IAAH,KAAYL,OAAOM,CAAnB,GAAuB,CAA5D,EAA+DX,IAA/D,EAAqEhB,GAAGI,QAAH,EAArE;AACAJ,QAAG4B,OAAH;AACA;;AAED,SAAKnB,YAAL,GAAoB,KAApB;AACA,SAAK9B,WAAL,GAAmB,KAAnB;AACA,IA7BD;;AA+BA;;;;;AAKAT,sBAAmBc,SAAnB,CAA6BiC,oBAA7B,GAAoD,UAASjB,EAAT,EACpD;AACC,WAAOA,GAAG6B,OAAH,EAAP;AACA,IAHD;;AAKA;;;;;AAKA3D,sBAAmBc,SAAnB,CAA6B8C,OAA7B,GAAuC,YACvC;AACC,SAAK3D,KAAL,CAAW4D,mBAAX,CAA+B,IAA/B;AACA,SAAK5D,KAAL,CAAW6D,cAAX,CAA0B,KAAK1D,cAA/B;;AAEA;AACAW,gBAAYD,SAAZ,CAAsB8C,OAAtB,CAA8BrC,KAA9B,CAAoC,IAApC;AACA,IAPD;;AASAwC,cAAW/D,kBAAX,GAAgC,OAAOA,kBAAP,KAA8B,WAA9B,GAA4CA,kBAA5C,GAAiEgE,SAAjG","file":"mxPopupMenuHandler.js","sourcesContent":["/**\n * Copyright (c) 2006-2015, JGraph Ltd\n * Copyright (c) 2006-2015, Gaudenz Alder\n */\n/**\n * Class: mxPopupMenuHandler\n * \n * Event handler that creates popupmenus.\n * \n * Constructor: mxPopupMenuHandler\n * \n * Constructs an event handler that creates a <mxPopupMenu>.\n */\nfunction mxPopupMenuHandler(graph, factoryMethod)\n{\n\tif (graph != null)\n\t{\n\t\tthis.graph = graph;\n\t\tthis.factoryMethod = factoryMethod;\n\t\tthis.graph.addMouseListener(this);\n\t\t\n\t\t// Does not show menu if any touch gestures take place after the trigger\n\t\tthis.gestureHandler = mxUtils.bind(this, function(sender, eo)\n\t\t{\n\t\t\tthis.inTolerance = false;\n\t\t});\n\t\t\n\t\tthis.graph.addListener(mxEvent.GESTURE, this.gestureHandler);\n\t\t\n\t\tthis.init();\n\t}\n};\n\n/**\n * Extends mxPopupMenu.\n */\nmxPopupMenuHandler.prototype = new mxPopupMenu();\nmxPopupMenuHandler.prototype.constructor = mxPopupMenuHandler;\n\n/**\n * Variable: graph\n * \n * Reference to the enclosing <mxGraph>.\n */\nmxPopupMenuHandler.prototype.graph = null;\n\n/**\n * Variable: selectOnPopup\n * \n * Specifies if cells should be selected if a popupmenu is displayed for\n * them. Default is true.\n */\nmxPopupMenuHandler.prototype.selectOnPopup = true;\n\n/**\n * Variable: clearSelectionOnBackground\n * \n * Specifies if cells should be deselected if a popupmenu is displayed for\n * the diagram background. Default is true.\n */\nmxPopupMenuHandler.prototype.clearSelectionOnBackground = true;\n\n/**\n * Variable: triggerX\n * \n * X-coordinate of the mouse down event.\n */\nmxPopupMenuHandler.prototype.triggerX = null;\n\n/**\n * Variable: triggerY\n * \n * Y-coordinate of the mouse down event.\n */\nmxPopupMenuHandler.prototype.triggerY = null;\n\n/**\n * Variable: screenX\n * \n * Screen X-coordinate of the mouse down event.\n */\nmxPopupMenuHandler.prototype.screenX = null;\n\n/**\n * Variable: screenY\n * \n * Screen Y-coordinate of the mouse down event.\n */\nmxPopupMenuHandler.prototype.screenY = null;\n\n/**\n * Function: init\n * \n * Initializes the shapes required for this vertex handler.\n */\nmxPopupMenuHandler.prototype.init = function()\n{\n\t// Supercall\n\tmxPopupMenu.prototype.init.apply(this);\n\n\t// Hides the tooltip if the mouse is over\n\t// the context menu\n\tmxEvent.addGestureListeners(this.div, mxUtils.bind(this, function(evt)\n\t{\n\t\tthis.graph.tooltipHandler.hide();\n\t}));\n};\n\n/**\n * Function: isSelectOnPopup\n * \n * Hook for returning if a cell should be selected for a given <mxMouseEvent>.\n * This implementation returns <selectOnPopup>.\n */\nmxPopupMenuHandler.prototype.isSelectOnPopup = function(me)\n{\n\treturn this.selectOnPopup;\n};\n\n/**\n * Function: mouseDown\n * \n * Handles the event by initiating the panning. By consuming the event all\n * subsequent events of the gesture are redirected to this handler.\n */\nmxPopupMenuHandler.prototype.mouseDown = function(sender, me)\n{\n\tif (this.isEnabled() && !mxEvent.isMultiTouchEvent(me.getEvent()))\n\t{\n\t\t// Hides the popupmenu if is is being displayed\n\t\tthis.hideMenu();\n\t\tthis.triggerX = me.getGraphX();\n\t\tthis.triggerY = me.getGraphY();\n\t\tthis.screenX = mxEvent.getMainEvent(me.getEvent()).screenX;\n\t\tthis.screenY = mxEvent.getMainEvent(me.getEvent()).screenY;\n\t\tthis.popupTrigger = this.isPopupTrigger(me);\n\t\tthis.inTolerance = true;\n\t}\n};\n\n/**\n * Function: mouseMove\n * \n * Handles the event by updating the panning on the graph.\n */\nmxPopupMenuHandler.prototype.mouseMove = function(sender, me)\n{\n\t// Popup trigger may change on mouseUp so ignore it\n\tif (this.inTolerance && this.screenX != null && this.screenY != null)\n\t{\n\t\tif (Math.abs(mxEvent.getMainEvent(me.getEvent()).screenX - this.screenX) > this.graph.tolerance ||\n\t\t\tMath.abs(mxEvent.getMainEvent(me.getEvent()).screenY - this.screenY) > this.graph.tolerance)\n\t\t{\n\t\t\tthis.inTolerance = false;\n\t\t}\n\t}\n};\n\n/**\n * Function: mouseUp\n * \n * Handles the event by setting the translation on the view or showing the\n * popupmenu.\n */\nmxPopupMenuHandler.prototype.mouseUp = function(sender, me)\n{\n\tif (this.popupTrigger && this.inTolerance && this.triggerX != null && this.triggerY != null)\n\t{\n\t\tvar cell = this.getCellForPopupEvent(me);\n\n\t\t// Selects the cell for which the context menu is being displayed\n\t\tif (this.graph.isEnabled() && this.isSelectOnPopup(me) &&\n\t\t\tcell != null && !this.graph.isCellSelected(cell))\n\t\t{\n\t\t\tthis.graph.setSelectionCell(cell);\n\t\t}\n\t\telse if (this.clearSelectionOnBackground && cell == null)\n\t\t{\n\t\t\tthis.graph.clearSelection();\n\t\t}\n\t\t\n\t\t// Hides the tooltip if there is one\n\t\tthis.graph.tooltipHandler.hide();\n\n\t\t// Menu is shifted by 1 pixel so that the mouse up event\n\t\t// is routed via the underlying shape instead of the DIV\n\t\tvar origin = mxUtils.getScrollOrigin();\n\t\tthis.popup(me.getX() + origin.x + 1, me.getY() + origin.y + 1, cell, me.getEvent());\n\t\tme.consume();\n\t}\n\t\n\tthis.popupTrigger = false;\n\tthis.inTolerance = false;\n};\n\n/**\n * Function: getCellForPopupEvent\n * \n * Hook to return the cell for the mouse up popup trigger handling.\n */\nmxPopupMenuHandler.prototype.getCellForPopupEvent = function(me)\n{\n\treturn me.getCell();\n};\n\n/**\n * Function: destroy\n * \n * Destroys the handler and all its resources and DOM nodes.\n */\nmxPopupMenuHandler.prototype.destroy = function()\n{\n\tthis.graph.removeMouseListener(this);\n\tthis.graph.removeListener(this.gestureHandler);\n\t\n\t// Supercall\n\tmxPopupMenu.prototype.destroy.apply(this);\n};\n\n__mxOutput.mxPopupMenuHandler = typeof mxPopupMenuHandler !== 'undefined' ? mxPopupMenuHandler : undefined;\n"]}