{"version":3,"sources":["../src/flowchart_options.js"],"names":["FlowchartOptionsCtrl","$scope","editor","panelCtrl","ctrl","panel","mx","sourceTypes","text","value","render","changedSource","urlEditor","myWindow","window","open","opened","addEventListener","event","origin","data","source","postMessage","flowchart","xml","undefined","length","$apply","close","percentText","regexPattern","RegExp","result","test","vkbeautify","error","console","xmlmin","flowchartOptionsTab","$q","uiSegmentSrv","restrict","scope","templateUrl","plugin","id","controller"],"mappings":"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","sourcesContent":["import _ from \"lodash\";\nimport { plugin } from \"./plugin\";\nimport vkbeautify from \"./libs/vkbeautify/index\";\n\nexport class FlowchartOptionsCtrl {\n  /** @ngInject */\n  constructor($scope) {\n    $scope.editor = this;\n    this.$scope = $scope;\n    this.panelCtrl = $scope.ctrl;\n    this.panel = this.panelCtrl.panel;\n    this.mx = this.panelCtrl.mx;\n    $scope.mx = this.panelCtrl.mx;\n    this.sourceTypes = [\n      { text: \"Url\", value: \"url\" },\n      { text: \"XML Content\", value: \"xml\" }\n      // { text: 'CSV', value: 'csv' },\n    ];\n\n  }\n\n  render() {\n    this.panelCtrl.render();\n  }\n\n  onSourceChange() {\n    this.panelCtrl.changedSource = true;\n    this.render();\n  }\n\n  openDrawEditor() {\n    let urlEditor=\"https://draw.io?embed=1\";\n    // let urlEditor=\"https://jgraph.github.io/mxgraph/javascript/examples/grapheditor/www/index.html?embed=1\";\n\n    // source : \n    // https://desk.draw.io/support/solutions/articles/16000042542-how-to-embed-html-\n    // https://support.draw.io/display/DOB/2016/05/09/Simple+draw.io+embedding+walk-through\n    let myWindow = window.open(\n      urlEditor,\n      \"MxGraph Editor\",\n      \"width=1280, height=720\"\n    );\n    let opened = false;\n    window.addEventListener(\"message\", event => {\n\n      if (event.origin !== \"https://www.draw.io\") return;\n      // when editor is open\n      if (event.data == \"ready\" ) {\n        // send xml\n        event.source.postMessage(\n          this.panel.flowchart.source.xml.value,\n          event.origin\n        );\n        opened = true;\n      } else {\n        if (event.data != undefined && event.data.length > 0) {\n          this.panel.flowchart.source.xml.value = event.data;\n          this.panelCtrl.changedSource = true;\n          this.$scope.$apply();\n          this.render()\n        }\n        if (event.data != undefined || event.data.length == 0) {\n          myWindow.close();\n        }\n      }\n    });\n  }\n\n  validatePercent(percentText) {\n    if (percentText == null || percentText.length == 0) {\n      return true;\n    }\n    let regexPattern = new RegExp(/^\\d+(\\.\\d+)?%{0,1}/);\n    let result = regexPattern.test(percentText);\n    if (!result) {\n      return false;\n    }\n    return true;\n  }\n\n  prettify() {\n    try {\n      let text = this.panel.flowchart.source.xml.value;\n      this.panel.flowchart.source.xml.value = vkbeautify.xml(text);\n    } catch (error) {\n      console.error(\"Error in prettify : \",error)\n    }\n  }\n\n  minify() {\n    try {\n      let text = this.panel.flowchart.source.xml.value;\n      this.panel.flowchart.source.xml.value = vkbeautify.xmlmin(text,false);\n    } catch (error) {\n      console.error(\"Error in minify : \",error)\n    }\n  }\n\n}\n\n/** @ngInject */\nexport function flowchartOptionsTab($q, uiSegmentSrv) {\n  \"use strict\";\n  return {\n    restrict: \"E\",\n    scope: true,\n    templateUrl:\n      \"public/plugins/\" + plugin.id + \"/partials/flowchart_options.html\",\n    controller: FlowchartOptionsCtrl\n  };\n}\n"],"file":"flowchart_options.js"}