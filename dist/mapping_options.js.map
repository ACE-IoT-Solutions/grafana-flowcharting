{"version":3,"sources":["../src/mapping_options.js"],"names":["MappingOptionsCtrl","$scope","editor","GF_PLUGIN","window","panelCtrl","ctrl","panel","rulesHandler","flowchartHandler","unitFormats","kbn","getUnitFormats","style","text","value","colorOn","linkOn","textOn","textReplace","propTypes","textPattern","metricTypes","dateFormats","aggregationTypes","mappingTypes","getMetricNames","series","_","map","t","alias","getCellNamesForShape","u","log","flowchart","getFlowchart","cells","getNamesByProp","getCellNamesForText","getCellNamesForLink","render","column","subItem","unit","onRulesChange","ruleChanged","ruleIndex","colorIndex","newColor","rule","getRule","data","colors","prop","xgraph","getXGraph","selectMxCells","unselectMxCells","mappingOptionsTab","$q","uiSegmentSrv","restrict","scope","templateUrl","getPartialPath","controller"],"mappings":"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","sourcesContent":["// eslint-disable-next-line import/no-unresolved\nimport kbn from 'app/core/utils/kbn';\nimport { plugin } from './plugin';\n\nexport class MappingOptionsCtrl {\n  /** @ngInject */\n  constructor($scope) {\n    $scope.editor = this;\n    $scope.GF_PLUGIN = window.GF_PLUGIN;\n    this.$scope = $scope;\n    this.panelCtrl = $scope.ctrl;\n    this.panel = this.panelCtrl.panel;\n    $scope.rulesHandler = this.panelCtrl.rulesHandler;\n    $scope.flowchartHandler = this.panelCtrl.flowchartHandler;\n    this.flowchartHandler = $scope.ctrl.flowchartHandler;\n    this.rulesHandler = this.panelCtrl.rulesHandler;\n    this.unitFormats = kbn.getUnitFormats();\n    this.style = [\n      { text: 'Disabled', value: null },\n      { text: 'Stroke', value: 'strokeColor' },\n      { text: 'Fill', value: 'fillColor' },\n      { text: 'Text', value: 'fontColor' },\n    ];\n    this.colorOn = [{ text: 'Warning / Critical', value: 'wc' }, { text: 'Always', value: 'a' }];\n    this.linkOn = [{ text: 'Warning / Critical', value: 'wc' }, { text: 'Always', value: 'a' }];\n    this.textOn = [\n      { text: 'Never', value: 'n' },\n      { text: 'When Metric Displayed', value: 'wmd' },\n      { text: 'Warning / Critical', value: 'wc' },\n      { text: 'Critical Only', value: 'co' },\n    ];\n    this.textReplace = [\n      { text: 'All content', value: 'content' },\n      { text: 'Substring', value: 'pattern' },\n    ];\n    this.propTypes = [\n      { text: 'Id', value: 'id' },\n      // { text: \"Value\", value: \"value\" }\n    ];\n    this.textPattern = '/.*/';\n    this.metricTypes = [\n      { text: 'Number', value: 'number' },\n      { text: 'String', value: 'string' },\n      { text: 'Date', value: 'date' },\n    ];\n    this.dateFormats = [\n      { text: 'YYYY-MM-DD HH:mm:ss', value: 'YYYY-MM-DD HH:mm:ss' },\n      { text: 'YYYY-MM-DD HH:mm:ss.SSS', value: 'YYYY-MM-DD HH:mm:ss.SSS' },\n      { text: 'MM/DD/YY h:mm:ss a', value: 'MM/DD/YY h:mm:ss a' },\n      { text: 'MMMM D, YYYY LT', value: 'MMMM D, YYYY LT' },\n      { text: 'YYYY-MM-DD', value: 'YYYY-MM-DD' },\n    ];\n    this.aggregationTypes = [\n      { text: 'First', value: 'first' },\n      { text: 'Last', value: 'current' },\n      { text: 'Min', value: 'min' },\n      { text: 'Max', value: 'max' },\n      { text: 'Sum', value: 'total' },\n      { text: 'Avg', value: 'avg' },\n      { text: 'Count', value: 'count' },\n      { text: 'Delta', value: 'delta' },\n      { text: 'Range', value: 'range' },\n      { text: 'Diff', value: 'diff' },\n    ];\n    this.mappingTypes = [{ text: 'Value to text', value: 1 }, { text: 'Range to text', value: 2 }];\n\n    this.getMetricNames = () => {\n      if (!this.panelCtrl.series) {\n        return [];\n      }\n      return _.map(this.panelCtrl.series, t => t.alias);\n    };\n\n    this.getCellNamesForShape = () => {\n      u.log(1, 'mapping_options.getCellNamesForShape()');\n      const flowchart = this.flowchartHandler.getFlowchart(0);\n      const cells = flowchart.getNamesByProp('id');\n      return _.map(cells, t => t);\n    };\n\n    this.getCellNamesForText = () => {\n      u.log(1, 'mapping_options.getCellNamesForText()');\n      const flowchart = this.flowchartHandler.getFlowchart(0);\n      const cells = flowchart.getNamesByProp('id');\n      return _.map(cells, t => t);\n    };\n\n    this.getCellNamesForLink = () => {\n      u.log(1, 'mapping_options.getCellNamesForLink()');\n      const flowchart = this.flowchartHandler.getFlowchart(0);\n      const cells = flowchart.getNamesByProp('id');\n      return _.map(cells, t => t);\n    };\n  }\n\n  render() {\n    this.panelCtrl.render();\n  }\n\n  setUnitFormat(column, subItem) {\n    column.unit = subItem.value;\n    this.onRulesChange();\n  }\n\n  onRulesChange() {\n    u.log(1, \"MappingOptionsCtrl.onRulesChange()\");\n    this.flowchartHandler.ruleChanged();\n    this.render();\n  }\n\n  onColorChange(ruleIndex, colorIndex) {\n    return (newColor) => {\n      const rule = this.rulesHandler.getRule(ruleIndex);\n      rule.data.colors[colorIndex] = newColor;\n      this.onRulesChange();\n    };\n  }\n\n  selectCell(prop, value) {\n    const flowchart = this.flowchartHandler.getFlowchart(0);\n    const xgraph = flowchart.getXGraph();\n    xgraph.selectMxCells(prop, value);\n  }\n\n  unselectCell() {\n    const flowchart = this.flowchartHandler.getFlowchart(0);\n    const xgraph = flowchart.getXGraph();\n    xgraph.unselectMxCells();\n  }\n}\n\n/** @ngInject */\nexport function mappingOptionsTab($q, uiSegmentSrv) {\n  'use strict';\n  return {\n    restrict: 'E',\n    scope: true,\n    templateUrl: `${GF_PLUGIN.getPartialPath()}/mapping_options.html`,\n    controller: MappingOptionsCtrl,\n  };\n}\n"],"file":"mapping_options.js"}