{"version":3,"sources":["../src/flowchartControl.js"],"names":["arnaud","MetricsPanelCtrl","TimeSeries","kbn","flowchartEditor","displayEditor","shapeEditor","valueEditor","_","panelDefaults","content","shapes","values","graph","legend","show","min","max","avg","current","total","gradient","enabled","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendType","breakPoint","aliasColors","format","valueName","strokeWidth","fontSize","combine","threshold","label","FlowchartCtrl","$scope","$injector","$sce","$http","defaults","panel","graphId","id","containerDivId","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","container","mxClient","isBrowserSupported","mxUtils","error","mxEvent","disableContextMenu","mxGraph","mxRubberband","parent","getDefaultParent","getModel","beginUpdate","v1","insertVertex","v2","e1","insertEdge","endUpdate","test","getFlowchartContainer","$","document","getElementById","addEditorTab","initializeMxgraph","templateUrl"],"mappings":"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","file":"flowchartControl.js","sourcesContent":["//import './externals/globals.js';\r\n//import './externals/mxInt';\r\nimport {arnaud} from './libs/mxgraph-js/dist/mxgraph-js';\r\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport {\r\n  flowchartEditor,\r\n  displayEditor,\r\n  shapeEditor,\r\n  valueEditor\r\n} from './properties';\r\nimport _ from 'lodash';\r\nimport './series_overrides_flowchart_ctrl';\r\n\r\n\r\nconst panelDefaults = {\r\n  content : '<mxGraphModel dx=\"2066\" dy=\"1171\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"1\" pageScale=\"1\" pageWidth=\"827\" pageHeight=\"1169\">\\n'+\r\n  '  <root>\\n'+\r\n  '    <mxCell id=\"0\"/>\\n'+\r\n  '    <mxCell id=\"1\" parent=\"0\"/>\\n'+\r\n  '    <mxCell id=\"5\" style=\"rounded=0;html=1;entryX=0.5;entryY=0;jettySize=auto;orthogonalLoop=1;edgeStyle=orthogonalEdgeStyle;curved=1;\" edge=\"1\" parent=\"1\" source=\"2\" target=\"3\">\\n'+\r\n  '      <mxGeometry relative=\"1\" as=\"geometry\"/>\\n'+\r\n  '    </mxCell>\\n'+\r\n  '    <mxCell id=\"6\" style=\"edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;html=1;jettySize=auto;orthogonalLoop=1;\" edge=\"1\" parent=\"1\" source=\"2\" target=\"4\">\\n'+\r\n  '      <mxGeometry relative=\"1\" as=\"geometry\"/>\\n'+\r\n  '    </mxCell>\\n'+\r\n  '    <object label=\"Hello\" composite=\"Hello\" id=\"2\">\\n'+\r\n  '      <mxCell style=\"rounded=1;whiteSpace=wrap;html=1;gradientColor=#ffffff;fillColor=#00FF00;\" parent=\"1\" vertex=\"1\">\\n'+\r\n  '        <mxGeometry x=\"340\" y=\"180\" width=\"120\" height=\"60\" as=\"geometry\"/>\\n'+\r\n  '      </mxCell>\\n'+\r\n  '    </object>\\n'+\r\n  '    <object label=\"mxGraph\" composite=\"World\" id=\"3\">\\n'+\r\n  '      <mxCell style=\"ellipse;whiteSpace=wrap;html=1;aspect=fixed;gradientColor=#ffffff;fillColor=#E580FF;\" parent=\"1\" vertex=\"1\">\\n'+\r\n  '        <mxGeometry x=\"274\" y=\"320\" width=\"80\" height=\"80\" as=\"geometry\"/>\\n'+\r\n  '      </mxCell>\\n'+\r\n  '    </object>\\n'+\r\n  '    <mxCell id=\"4\" value=\"Grafana\" style=\"shape=mxgraph.flowchart.display;whiteSpace=wrap;html=1;fillColor=#FF7654;strokeColor=#000000;strokeWidth=2;gradientColor=#ffffff;\" vertex=\"1\" parent=\"1\">\\n'+\r\n  '      <mxGeometry x=\"440\" y=\"330\" width=\"98\" height=\"60\" as=\"geometry\"/>\\n'+\r\n  '    </mxCell>\\n'+\r\n  '    <mxCell id=\"7\" value=\"Author : Arnaud GENTY&lt;br&gt;&lt;div style=&quot;text-align: left&quot;&gt;Manthor :&amp;nbsp;&lt;span&gt;Jeremy&amp;nbsp;&lt;/span&gt;&lt;span&gt;jdbranham&lt;/span&gt;&lt;/div&gt;\" style=\"text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" vertex=\"1\" parent=\"1\">\\n'+\r\n  '      <mxGeometry x=\"260\" y=\"407\" width=\"280\" height=\"40\" as=\"geometry\"/>\\n'+\r\n  '    </mxCell>\\n'+\r\n  '  </root>\\n'+\r\n  '</mxGraphModel>\\n',\r\n  shapes: [],\r\n  values: [],\r\n  graph : null,\r\n  legend: {\r\n    show: true,\r\n    min: true,\r\n    max: true,\r\n    avg: true,\r\n    current: true,\r\n    total: true,\r\n    gradient: {\r\n      enabled: true,\r\n      show: true\r\n    }\r\n  },\r\n  links: [],\r\n  datasource: null,\r\n  maxDataPoints: 3,\r\n  interval: null,\r\n  targets: [{}],\r\n  cacheTimeout: null,\r\n  nullPointMode: 'connected',\r\n  legendType: 'Under graph',\r\n  breakPoint: '50%',\r\n  aliasColors: {},\r\n  format: 'short',\r\n  valueName: 'current',\r\n  strokeWidth: 1,\r\n  fontSize: '80%',\r\n  combine: {\r\n    threshold: 0.0,\r\n    label: 'Others'\r\n  }\r\n};\r\n\r\n\r\nexport class FlowchartCtrl extends MetricsPanelCtrl {\r\n\r\n  constructor($scope, $injector, $sce, $http) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, panelDefaults);\r\n    this.$http = $http;\r\n    this.panel.graphId = 'flowchart_' + this.panel.id;\r\n    this.containerDivId = 'container_' + this.panel.graphId;\r\n    this.$sce = $sce;\r\n\r\n\r\n    // events\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('refresh', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n    this.onRender();\r\n\r\n  }\r\n\r\n  test(container)\r\n  {\r\n    // Checks if the browser is supported\r\n    if (!arnaud.mxClient.isBrowserSupported())\r\n    {\r\n      // Displays an error message if the browser is not supported.\r\n      arnaud.mxUtils.error('Browser is not supported!', 200, false);\r\n    }\r\n    else\r\n    {\r\n      // Disables the built-in context menu\r\n      arnaud.mxEvent.disableContextMenu(container);\r\n\r\n      // Creates the graph inside the given container\r\n      var graph = new arnaud.mxGraph(container);\r\n\r\n      // Enables rubberband selection\r\n      new arnaud.mxRubberband(graph);\r\n\r\n      // Gets the default parent for inserting new cells. This\r\n      // is normally the first child of the root (ie. layer 0).\r\n      var parent = graph.getDefaultParent();\r\n\r\n      // Adds cells to the model in a single step\r\n      graph.getModel().beginUpdate();\r\n      try\r\n      {\r\n        var v1 = graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30);\r\n        var v2 = graph.insertVertex(parent, null, 'World!', 200, 150, 80, 30);\r\n        var e1 = graph.insertEdge(parent, null, '', v1, v2);\r\n      }\r\n      finally\r\n      {\r\n        // Updates the display\r\n        graph.getModel().endUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  initializeMxgraph() {\r\n      //mxInt.test(this.initializeMxgraph());\r\n      this.test(this.getFlowchartContainer());\r\n  }\r\n\r\n  getFlowchartContainer() {\r\n    return $(document.getElementById(this.containerDivId));\r\n  }\r\n\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Flowchart', flowchartEditor, 2);\r\n    this.addEditorTab('Display', displayEditor, 3);\r\n    this.addEditorTab('Metric Shapes', shapeEditor, 4);\r\n    this.addEditorTab('Metric Values', valueEditor, 5);\r\n  }\r\n\r\n  onRender() {\r\n    this.initializeMxgraph();\r\n  }\r\n\r\n  onDataReceived() {\r\n    //TODO : complete\r\n  }\r\n\r\n  onDataError() {\r\n    // TODO:\r\n  }\r\n\r\n\r\n}\r\n\r\nFlowchartCtrl.templateUrl = 'module.html';\r\n"]}