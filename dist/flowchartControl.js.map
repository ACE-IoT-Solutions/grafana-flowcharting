{"version":3,"sources":["../src/flowchartControl.js"],"names":["mx","MetricsPanelCtrl","TimeSeries","kbn","flowchartEditor","displayEditor","shapeEditor","valueEditor","_","panelDefaults","content","shapes","values","graph","legend","show","min","max","avg","current","total","gradient","enabled","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendType","breakPoint","aliasColors","format","valueName","strokeWidth","fontSize","combine","threshold","label","FlowchartCtrl","$scope","$injector","$sce","$http","defaults","panel","graphId","id","containerDivId","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","mxClient","isBrowserSupported","mxUtils","error","mxGraph","container","getModel","beginUpdate","dec","mxCodec","root","ownerDocument","decode","endUpdate","node","document","createElement","type","async","charset","code","mxBasePath","text","head","appendChild","$","getElementById","addEditorTab","initializeMxgraph","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAYA,Q;;AACJC,sB,kBAAAA,gB;;AACDC,gB;;AACAC,S;;AAILC,qB,eAAAA,e;AACAC,mB,eAAAA,a;AACAC,iB,eAAAA,W;AACAC,iB,eAAAA,W;;AAGKC,O;;;;;;;;;;;;;;;;;;;;;AAGDC,mB,GAAgB;AACpBC,iBAAU,iLACV,YADU,GAEV,wBAFU,GAGV,mCAHU,GAIV,sLAJU,GAKV,kDALU,GAMV,iBANU,GAOV,kKAPU,GAQV,kDARU,GASV,iBATU,GAUV,uDAVU,GAWV,0HAXU,GAYV,+EAZU,GAaV,mBAbU,GAcV,iBAdU,GAeV,yDAfU,GAgBV,qIAhBU,GAiBV,8EAjBU,GAkBV,mBAlBU,GAmBV,iBAnBU,GAoBV,uMApBU,GAqBV,4EArBU,GAsBV,iBAtBU,GAuBV,4VAvBU,GAwBV,6EAxBU,GAyBV,iBAzBU,GA0BV,aA1BU,GA2BV,mBA5BoB;AA6BpBC,gBAAQ,EA7BY;AA8BpBC,gBAAQ,EA9BY;AA+BpBC,eAAQ,IA/BY;AAgCpBC,gBAAQ;AACNC,gBAAM,IADA;AAENC,eAAK,IAFC;AAGNC,eAAK,IAHC;AAINC,eAAK,IAJC;AAKNC,mBAAS,IALH;AAMNC,iBAAO,IAND;AAONC,oBAAU;AACRC,qBAAS,IADD;AAERP,kBAAM;AAFE;AAPJ,SAhCY;AA4CpBQ,eAAO,EA5Ca;AA6CpBC,oBAAY,IA7CQ;AA8CpBC,uBAAe,CA9CK;AA+CpBC,kBAAU,IA/CU;AAgDpBC,iBAAS,CAAC,EAAD,CAhDW;AAiDpBC,sBAAc,IAjDM;AAkDpBC,uBAAe,WAlDK;AAmDpBC,oBAAY,aAnDQ;AAoDpBC,oBAAY,KApDQ;AAqDpBC,qBAAa,EArDO;AAsDpBC,gBAAQ,OAtDY;AAuDpBC,mBAAW,SAvDS;AAwDpBC,qBAAa,CAxDO;AAyDpBC,kBAAU,KAzDU;AA0DpBC,iBAAS;AACPC,qBAAW,GADJ;AAEPC,iBAAO;AAFA;AA1DW,O;;+BAiETC,a;;;AAEX,+BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,IAA/B,EAAqCC,KAArC,EAA4C;AAAA;;AAAA,oIACpCH,MADoC,EAC5BC,SAD4B;;AAE1ClC,YAAEqC,QAAF,CAAW,MAAKC,KAAhB,EAAuBrC,aAAvB;AACA,gBAAKmC,KAAL,GAAaA,KAAb;AACA,gBAAKE,KAAL,CAAWC,OAAX,GAAqB,eAAe,MAAKD,KAAL,CAAWE,EAA/C;AACA,gBAAKC,cAAL,GAAsB,eAAe,MAAKH,KAAL,CAAWC,OAAhD;AACA,gBAAKJ,IAAL,GAAYA,IAAZ;;AAGA;AACA,gBAAKO,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKC,QAAL,CAAcC,IAAd,OAAzB;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKC,QAAL,CAAcC,IAAd,OAA1B;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKG,cAAL,CAAoBD,IAApB,OAArC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKK,cAAL,CAAoBH,IAApB,OAAjC;;AAEA,gBAAKD,QAAL;;AAjB0C;AAmB3C;;;;8CAEmB;AAClB;AACA;AACA;;AAEA,gBAAI,CAACpD,GAAGyD,QAAH,CAAYC,kBAAZ,EAAL,EACA;AACE;AACA1D,iBAAG2D,OAAH,CAAWC,KAAX,CAAiB,2BAAjB,EAA8C,GAA9C,EAAmD,KAAnD;AACD,aAJD,MAMA;AACE;AACA,kBAAK,KAAK/C,KAAL,IAAc,IAAnB,EAAyB;AACvB;AACAA,wBAAQ,IAAIb,GAAG6D,OAAP,CAAeC,SAAf,CAAR;AACD;AACDjD,oBAAMkD,QAAN,GAAiBC,WAAjB;AACA,kBAAG;AACD,oBAAIC,MAAM,IAAIjE,GAAGkE,OAAP,CAAeC,KAAKC,aAApB,CAAV;AACAH,oBAAII,MAAJ,CAAWF,IAAX,EAAiBtD,MAAMkD,QAAN,EAAjB;AACD,eAHD,SAIO;AACL;AACAlD,sBAAMkD,QAAN,GAAiBO,SAAjB;AACD;AACF;AACF;;;qCAES;AACR,gBAAIC,OAAOC,SAASC,aAAT,CAAuB,QAAvB,CAAX;AACAF,iBAAKG,IAAL,GAAY,iBAAZ;AACAH,iBAAKI,KAAL,GAAa,IAAb;AACAJ,iBAAKK,OAAL,GAAe,OAAf;AACA,gBAAIC,OAAO,iBAAgBC,UAAhB,GAA4B,IAAvC;AACAP,iBAAKQ,IAAL,GAAYF,IAAZ;AACAL,qBAASQ,IAAT,CAAcC,WAAd,CAA0BV,IAA1B;AACD;;;kDAEuB;AACtB,mBAAOW,EAAEV,SAASW,cAAT,CAAwB,KAAKlC,cAA7B,CAAF,CAAP;AACD;;;2CAGgB;AACf,iBAAKmC,YAAL,CAAkB,WAAlB,EAA+BhF,eAA/B,EAAgD,CAAhD;AACA,iBAAKgF,YAAL,CAAkB,SAAlB,EAA6B/E,aAA7B,EAA4C,CAA5C;AACA,iBAAK+E,YAAL,CAAkB,eAAlB,EAAmC9E,WAAnC,EAAgD,CAAhD;AACA,iBAAK8E,YAAL,CAAkB,eAAlB,EAAmC7E,WAAnC,EAAgD,CAAhD;AACD;;;qCAEU;AACT,iBAAK8E,iBAAL;AACD;;;2CAEgB;AACf;AACD;;;wCAEa;AACZ;AACD;;;;QApFgCpF,gB;;;;AAyFnCuC,oBAAc8C,WAAd,GAA4B,aAA5B","file":"flowchartControl.js","sourcesContent":["import * as mx from './libs/mxgraph-js/dist/mxgraph-js';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n// old version, used node_modules/mxgraph\n//import * as mxClient from './libs/mxgraph/javascript/dist/js/mxClient';\nimport {\n  flowchartEditor,\n  displayEditor,\n  shapeEditor,\n  valueEditor\n  //mxBasePath\n} from './properties';\nimport _ from 'lodash';\nimport './series_overrides_flowchart_ctrl';\n\nconst panelDefaults = {\n  content : '<mxGraphModel dx=\"2066\" dy=\"1171\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"1\" pageScale=\"1\" pageWidth=\"827\" pageHeight=\"1169\">\\n'+\n  '  <root>\\n'+\n  '    <mxCell id=\"0\"/>\\n'+\n  '    <mxCell id=\"1\" parent=\"0\"/>\\n'+\n  '    <mxCell id=\"5\" style=\"rounded=0;html=1;entryX=0.5;entryY=0;jettySize=auto;orthogonalLoop=1;edgeStyle=orthogonalEdgeStyle;curved=1;\" edge=\"1\" parent=\"1\" source=\"2\" target=\"3\">\\n'+\n  '      <mxGeometry relative=\"1\" as=\"geometry\"/>\\n'+\n  '    </mxCell>\\n'+\n  '    <mxCell id=\"6\" style=\"edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;html=1;jettySize=auto;orthogonalLoop=1;\" edge=\"1\" parent=\"1\" source=\"2\" target=\"4\">\\n'+\n  '      <mxGeometry relative=\"1\" as=\"geometry\"/>\\n'+\n  '    </mxCell>\\n'+\n  '    <object label=\"Hello\" composite=\"Hello\" id=\"2\">\\n'+\n  '      <mxCell style=\"rounded=1;whiteSpace=wrap;html=1;gradientColor=#ffffff;fillColor=#00FF00;\" parent=\"1\" vertex=\"1\">\\n'+\n  '        <mxGeometry x=\"340\" y=\"180\" width=\"120\" height=\"60\" as=\"geometry\"/>\\n'+\n  '      </mxCell>\\n'+\n  '    </object>\\n'+\n  '    <object label=\"mxGraph\" composite=\"World\" id=\"3\">\\n'+\n  '      <mxCell style=\"ellipse;whiteSpace=wrap;html=1;aspect=fixed;gradientColor=#ffffff;fillColor=#E580FF;\" parent=\"1\" vertex=\"1\">\\n'+\n  '        <mxGeometry x=\"274\" y=\"320\" width=\"80\" height=\"80\" as=\"geometry\"/>\\n'+\n  '      </mxCell>\\n'+\n  '    </object>\\n'+\n  '    <mxCell id=\"4\" value=\"Grafana\" style=\"shape=mxgraph.flowchart.display;whiteSpace=wrap;html=1;fillColor=#FF7654;strokeColor=#000000;strokeWidth=2;gradientColor=#ffffff;\" vertex=\"1\" parent=\"1\">\\n'+\n  '      <mxGeometry x=\"440\" y=\"330\" width=\"98\" height=\"60\" as=\"geometry\"/>\\n'+\n  '    </mxCell>\\n'+\n  '    <mxCell id=\"7\" value=\"Author : Arnaud GENTY&lt;br&gt;&lt;div style=&quot;text-align: left&quot;&gt;Manthor :&amp;nbsp;&lt;span&gt;Jeremy&amp;nbsp;&lt;/span&gt;&lt;span&gt;jdbranham&lt;/span&gt;&lt;/div&gt;\" style=\"text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" vertex=\"1\" parent=\"1\">\\n'+\n  '      <mxGeometry x=\"260\" y=\"407\" width=\"280\" height=\"40\" as=\"geometry\"/>\\n'+\n  '    </mxCell>\\n'+\n  '  </root>\\n'+\n  '</mxGraphModel>\\n',\n  shapes: [],\n  values: [],\n  graph : null,\n  legend: {\n    show: true,\n    min: true,\n    max: true,\n    avg: true,\n    current: true,\n    total: true,\n    gradient: {\n      enabled: true,\n      show: true\n    }\n  },\n  links: [],\n  datasource: null,\n  maxDataPoints: 3,\n  interval: null,\n  targets: [{}],\n  cacheTimeout: null,\n  nullPointMode: 'connected',\n  legendType: 'Under graph',\n  breakPoint: '50%',\n  aliasColors: {},\n  format: 'short',\n  valueName: 'current',\n  strokeWidth: 1,\n  fontSize: '80%',\n  combine: {\n    threshold: 0.0,\n    label: 'Others'\n  }\n};\n\n\nexport class FlowchartCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $sce, $http) {\n    super($scope, $injector);\n    _.defaults(this.panel, panelDefaults);\n    this.$http = $http;\n    this.panel.graphId = 'flowchart_' + this.panel.id;\n    this.containerDivId = 'container_' + this.panel.graphId;\n    this.$sce = $sce;\n\n\n    // events\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('refresh', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    this.onRender();\n\n  }\n\n  initializeMxgraph() {\n    //initialize mxClient\n    //Checks if browser is supported\n    //this.initLibs();\n\n    if (!mx.mxClient.isBrowserSupported())\n    {\n      // Displays an error message if the browser is not supported.\n      mx.mxUtils.error('Browser is not supported!', 200, false);\n    }\n    else\n    {\n      //Creates the graph inside the given container\n      if ( this.graph == null) {\n        // Creates the graph inside the given container\n        graph = new mx.mxGraph(container);\n      }\n      graph.getModel().beginUpdate();\n      try{\n        var dec = new mx.mxCodec(root.ownerDocument);\n        dec.decode(root, graph.getModel());\n      }\n      finally{\n        // Updates the display\n        graph.getModel().endUpdate();\n      }\n    }\n  }\n\n  initLibs(){\n    var node = document.createElement(\"script\");\n    node.type = 'text/javascript';\n    node.async = true;\n    node.charset = 'utf-8';\n    var code = 'mxBasePath=\"'+ mxBasePath +'\";';\n    node.text = code;\n    document.head.appendChild(node);\n  }\n\n  getFlowchartContainer() {\n    return $(document.getElementById(this.containerDivId));\n  }\n\n\n  onInitEditMode() {\n    this.addEditorTab('Flowchart', flowchartEditor, 2);\n    this.addEditorTab('Display', displayEditor, 3);\n    this.addEditorTab('Metric Shapes', shapeEditor, 4);\n    this.addEditorTab('Metric Values', valueEditor, 5);\n  }\n\n  onRender() {\n    this.initializeMxgraph();\n  }\n\n  onDataReceived() {\n    //TODO : complete\n  }\n\n  onDataError() {\n    // TODO:\n  }\n\n\n}\n\nFlowchartCtrl.templateUrl = 'module.html';\n"]}