{"version":3,"sources":["../src/flowchartControl.js"],"names":["MetricsPanelCtrl","mxClient","mxUtils","mxCodec","diagramEditor","displayEditor","shapeEditor","valueEditor","_","mxBasePath","FlowchartCtrl","$scope","$injector","$rootScope","hiddenSeries","panelDefaults","xmlContent","shapes","graph","legend","show","min","max","avg","current","total","gradient","enabled","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendType","breakPoint","aliasColors","format","valueName","strokeWidth","fontSize","combine","threshold","label","panel","graphId","id","$http","containerDivId","$sce","unitFormats","kbn","getUnitFormats","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","isBrowserSupported","error","mxGraph","Container","getModel","beginUpdate","dec","root","ownerDocument","decode","endUpdate","$","document","getElementById","addEditorTab","flowchartEditor","initializeMxgraph","templateUrl"],"mappings":"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","file":"flowchartControl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\n\n// mxGraph libs\nimport mxClient from './libs/mxgraph/js/mxClient';\nimport mxUtils from './libs/mxgraph/js/mxUtils';\nimport mxCodec from './libs/mxgraph/js/mxCodec';\n\nimport {\n  diagramEditor,\n  displayEditor,\n  shapeEditor,\n  valueEditor\n} from './properties';\n\nimport _ from 'lodash';\nimport './series_overrides_flowchart_ctrl';\n\nconst mxBasePath = './libs/mxgraph/src';\n\nexport class FlowchartCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.hiddenSeries = {};\n\n    var panelDefaults = {\n      xmlContent: '<mxGraphModel dx=\"2066\" dy=\"1171\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"1\" pageScale=\"1\" pageWidth=\"827\" pageHeight=\"1169\">\\n'+\n      '  <root>\\n'+\n      '    <mxCell id=\"0\"/>\\n'+\n      '    <mxCell id=\"1\" parent=\"0\"/>\\n'+\n      '    <mxCell id=\"5\" style=\"rounded=0;html=1;entryX=0.5;entryY=0;jettySize=auto;orthogonalLoop=1;edgeStyle=orthogonalEdgeStyle;curved=1;\" edge=\"1\" parent=\"1\" source=\"2\" target=\"3\">\\n'+\n      '      <mxGeometry relative=\"1\" as=\"geometry\"/>\\n'+\n      '    </mxCell>\\n'+\n      '    <mxCell id=\"6\" style=\"edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;html=1;jettySize=auto;orthogonalLoop=1;\" edge=\"1\" parent=\"1\" source=\"2\" target=\"4\">\\n'+\n      '      <mxGeometry relative=\"1\" as=\"geometry\"/>\\n'+\n      '    </mxCell>\\n'+\n      '    <object label=\"Hello\" composite=\"Hello\" id=\"2\">\\n'+\n      '      <mxCell style=\"rounded=1;whiteSpace=wrap;html=1;gradientColor=#ffffff;fillColor=#00FF00;\" parent=\"1\" vertex=\"1\">\\n'+\n      '        <mxGeometry x=\"340\" y=\"180\" width=\"120\" height=\"60\" as=\"geometry\"/>\\n'+\n      '      </mxCell>\\n'+\n      '    </object>\\n'+\n      '    <object label=\"mxGraph\" composite=\"World\" id=\"3\">\\n'+\n      '      <mxCell style=\"ellipse;whiteSpace=wrap;html=1;aspect=fixed;gradientColor=#ffffff;fillColor=#E580FF;\" parent=\"1\" vertex=\"1\">\\n'+\n      '        <mxGeometry x=\"274\" y=\"320\" width=\"80\" height=\"80\" as=\"geometry\"/>\\n'+\n      '      </mxCell>\\n'+\n      '    </object>\\n'+\n      '    <mxCell id=\"4\" value=\"Grafana\" style=\"shape=mxgraph.flowchart.display;whiteSpace=wrap;html=1;fillColor=#FF7654;strokeColor=#000000;strokeWidth=2;gradientColor=#ffffff;\" vertex=\"1\" parent=\"1\">\\n'+\n      '      <mxGeometry x=\"440\" y=\"330\" width=\"98\" height=\"60\" as=\"geometry\"/>\\n'+\n      '    </mxCell>\\n'+\n      '    <mxCell id=\"7\" value=\"Author : Arnaud GENTY&lt;br&gt;&lt;div style=&quot;text-align: left&quot;&gt;Manthor :&amp;nbsp;&lt;span&gt;Jeremy&amp;nbsp;&lt;/span&gt;&lt;span&gt;jdbranham&lt;/span&gt;&lt;/div&gt;\" style=\"text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" vertex=\"1\" parent=\"1\">\\n'+\n      '      <mxGeometry x=\"260\" y=\"407\" width=\"280\" height=\"40\" as=\"geometry\"/>\\n'+\n      '    </mxCell>\\n'+\n      '  </root>\\n'+\n      '</mxGraphModel>\\n',\n      shapes: [],\n      graph : null,\n      legend: {\n        show: true,\n        min: true,\n        max: true,\n        avg: true,\n        current: true,\n        total: true,\n        gradient: {\n          enabled: true,\n          show: true\n        }\n      },\n      links: [],\n      datasource: null,\n      maxDataPoints: 3,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      nullPointMode: 'connected',\n      legendType: 'Under graph',\n      breakPoint: '50%',\n      aliasColors: {},\n      format: 'short',\n      valueName: 'current',\n      strokeWidth: 1,\n      fontSize: '80%',\n      combine: {\n        threshold: 0.0,\n        label: 'Others'\n      }\n    };\n\n    this.panel = panelDefaults;\n    this.panel.legend = panelDefaults.legend;\n    this.panel.graphId = 'flowchart_' + this.panel.id;\n    this.$http = $http;\n    this.panel.graphId = 'flowchart_' + this.panel.id;\n    this.containerDivId = 'container_' + this.panel.graphId;\n    this.$sce = $sce;\n    this.unitFormats = kbn.getUnitFormats();\n\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('refresh', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    this.onRender();\n\n  }\n\n  initializeMxgraph() {\n    // initialize mxClient\n    // Checks if browser is supported\n    if (!mxClient.isBrowserSupported())\n    {\n      // Displays an error message if the browser is\n      // not supported.\n      mxUtils.error('Browser is not supported!', 200, false);\n    }\n    else\n    {\n      // Creates the graph inside the given container\n      if ( this.graph != null) {\n        graph = new mxGraph(this.Container());\n      }\n      graph.getModel().beginUpdate();\n      try{\n        var dec = new mxCodec(root.ownerDocument);\n        dec.decode(root, graph.getModel());\n      }\n      finally{\n        // Updates the display\n        graph.getModel().endUpdate();\n      }\n    }\n\n  }\n  getContainer() {\n    return $(document.getElementById(this.containerDivId));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Flowchart', flowchartEditor, 2);\n    this.addEditorTab('Display', displayEditor, 3);\n    this.addEditorTab('Metric Composites', shapeEditor, 4);\n    this.addEditorTab('Metric Composites', valueEditor, 4);\n  }\n\n  onRender() {\n    initializeMxgraph();\n  }\n\n  onDataReceived() {\n    //TODO\n  }\n\n\n  onDataError() {\n\n  }\n\n\n}\n\nFlowchartCtrl.templateUrl = 'module.html';\n"]}