{"version":3,"sources":["../src/flowchartHandler.js"],"names":["FlowchartHandler","$scope","elem","ctrl","data","u","log","$elem","find","flowcharts","changedGraphFlag","changedDataFlag","changedRulesFlag","defaultXml","xgraph","undefined","stateHandler","$container","onMapping","active","object","id","length","import","events","on","render","obj","i","forEach","map","container","createContainer","fc","Flowchart","name","xml","push","index","Array","isArray","$","uniqueID","html","flowchart","width","height","refresh","sourcesChanged","rulesChanged","datasChanged","prop","getOrignalCells","objToMap","getId","scrollIntoView","focus","urlEditor","myWindow","window","open","addEventListener","event","origin","source","postMessage","setXml","panelCtrl","changedSource","$apply","close"],"mappings":"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","sourcesContent":["/* eslint-disable prefer-destructuring */\nimport Flowchart from './flowchart_class';\n\nexport default class FlowchartHandler {\n  /** @ngInject */\n  constructor($scope, elem, ctrl, data) {\n    u.log(1, 'FlowchartHandler.constructor()');\n    this.$scope = $scope || null;\n    this.$elem = elem.find('.flowchart-panel__chart');\n    this.ctrl = ctrl;\n    this.flowcharts = [];\n    this.data = data;\n    this.changedGraphFlag = true;\n    this.changedDataFlag = true;\n    this.changedRulesFlag = true;\n    this.defaultXml = '<mxGraphModel dx=\"1073\" dy=\"521\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"0\" pageScale=\"1\" pageWidth=\"827\" pageHeight=\"1169\" math=\"0\" shadow=\"0\"><root><mxCell id=\"0\"/><mxCell id=\"1\" parent=\"0\"/><mxCell id=\"arrow-1\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;jettySize=auto;orthogonalLoop=1;strokeWidth=4;shadow=1;\" parent=\"1\" source=\"shape-grafana\" target=\"shape-love\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"/></mxCell><object label=\"Grafana\" href=\"www.google.fr\" id=\"shape-grafana\"><mxCell style=\"rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;shadow=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"10\" y=\"10\" width=\"120\" height=\"60\" as=\"geometry\"/></mxCell></object><mxCell id=\"arrow-2\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;jettySize=auto;orthogonalLoop=1;strokeWidth=4;shadow=1;\" parent=\"1\" source=\"shape-love\" target=\"shape-mxgraph\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"/></mxCell><mxCell id=\"shape-love\" value=\"loves\" style=\"triangle;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;shadow=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"210\" width=\"60\" height=\"80\" as=\"geometry\"/></mxCell><mxCell id=\"shape-mxgraph\" value=\"mxGraph\" style=\"ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"340\" width=\"120\" height=\"80\" as=\"geometry\"/></mxCell><mxCell id=\"text-grafana\" value=\"MyText : TextVal\" style=\"text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"9\" y=\"50\" width=\"120\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"text-arrow1\" value=\"Text 2\" style=\"text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"150\" y=\"20\" width=\"40\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"text-arrow2\" value=\"Text 3\" style=\"text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"280\" y=\"20\" width=\"40\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"text-mxgraph\" value=\"Text 4\" style=\"text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"380\" y=\"50\" width=\"40\" height=\"20\" as=\"geometry\"/></mxCell></root></mxGraphModel>';\n    this.xgraph = undefined;\n    this.stateHandler = undefined;\n    this.$container = undefined;\n\n    this.onMapping = {\n      active: false, // boolean if pointer mapping is active\n      object: undefined, // ojb to return id of mapping\n      id: undefined, // id of dom\n    };\n\n    if (this.data !== undefined && this.data != null && this.data.length > 0) {\n      this.import(this.data);\n    }\n\n    // Events Render\n    ctrl.events.on('render', () => {\n      this.render();\n    });\n  }\n\n  import(obj) {\n    u.log(1, 'FlowchartHandler.import()');\n    u.log(0, 'FlowchartHandler.import() obj', obj);\n    let i = 0;\n    obj.forEach((map) => {\n      const container = this.createContainer();\n      const fc = new Flowchart(map.name, obj.xml, container, map);\n      this.flowcharts.push(fc);\n      this.data[i] = map;\n      i += 1;\n    });\n  }\n\n  getFlowchart(index) {\n    return this.flowcharts[index];\n  }\n\n  getFlowcharts() {\n    return this.flowcharts;\n  }\n\n  countFlowcharts() {\n    if (this.flowcharts !== undefined && Array.isArray(this.flowcharts)) return this.flowcharts.length;\n    return 0;\n  }\n\n  createContainer() {\n    const $container = $(`<div id=\"flowchart_${u.uniqueID}\" style=\"margin:auto;position:relative,width:100%;height:100%\"></div>`);\n    this.$elem.html($container);\n    return $container[0];\n  }\n\n  addFlowchart(name) {\n    u.log(1, 'FlowchartHandler.addFlowchart()');\n    const container = this.createContainer();\n    const data = {};\n    const flowchart = new Flowchart(name, this.defaultXml, container, data);\n    this.data.push(data);\n    this.flowcharts.push(flowchart);\n  }\n\n  getStatesHandler() {\n    return this.stateHandler;\n  }\n\n  render() {\n    u.log(1, 'flowchartHandler.render()');\n    const width = this.$elem.width();\n    const height = this.ctrl.height;\n    this.refresh(width, height);\n  }\n\n  sourcesChanged() {\n    this.sourcesChanged = true;\n  }\n\n  rulesChanged() {\n    this.rulesChanged = true;\n  }\n\n  datasChanged() {\n    this.datasChanged = true;\n  }\n\n  refresh(width, height) {\n    this.flowcharts.forEach((flowchart) => {\n      flowchart.refresh(width, height);\n    });\n  }\n\n  getNamesByProp(prop) {\n    return this.xgraph.getOrignalCells(prop);\n  }\n\n  setMap(objToMap) {\n    this.onMapping.active = true;\n    this.onMapping.object = objToMap;\n    this.onMapping.id = objToMap.getId();\n    this.onMapping.container = this.$container[0];\n    this.$container[0].scrollIntoView();\n    this.$container[0].focus();\n  }\n\n  unsetMap() {\n    this.onMapping.active = false;\n    this.onMapping.object = undefined;\n    this.onMapping.id = '';\n  }\n\n  isMapping(objToMap) {\n    if (objToMap === undefined || objToMap == null) return this.onMapping.active;\n    if (this.onMapping.active === true && objToMap === this.onMapping.object) return true;\n    return false;\n  }\n\n  openDrawEditor(index) {\n    const urlEditor = \"https://draw.io?embed=1\";\n    const myWindow = window.open(\n      urlEditor,\n      \"MxGraph Editor\",\n      \"width=1280, height=720\",\n    );\n    window.addEventListener(\"message\", (event) => {\n      if (event.origin !== \"https://www.draw.io\") return;\n      // when editor is open\n      if (event.data === \"ready\") {\n        // send xml\n        event.source.postMessage(\n          this.flowcharts[index].data.xml,\n          event.origin,\n        );\n      } else {\n        if (event.data !== undefined && event.data.length > 0) {\n          this.flowcharts[index].setXml(event.data);\n          this.panelCtrl.changedSource = true;\n          this.$scope.$apply();\n          this.render();\n        }\n        if (event.data !== undefined || event.data.length === 0) {\n          myWindow.close();\n        }\n      }\n    });\n  }\n}\n"],"file":"flowchartHandler.js"}