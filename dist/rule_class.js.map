{"version":3,"sources":["../src/rule_class.js"],"names":["Rule","pattern","data","shapeMaps","textMaps","linkMaps","valueMaps","rangeMaps","import","JSON","stringify","obj","unit","type","alias","aggregation","decimals","colors","style","colorOn","linkOn","textOn","textReplace","textPattern","dateFormat","thresholds","invert","shapeProp","shapeData","undefined","length","i","forEach","map","sm","ShapeMap","push","textProp","textData","tm","TextMap","linkProp","linkData","lm","LinkMap","mappingType","valueData","vm","ValueMap","value","text","rangeData","rm","RangeMap","from","to","sanitize","ref","copy","getThresholdLevel","serie","u","matchString","m","index","splice","found","element","match","log","hide","show","_","first","thresholdLevel","matchSerie","get","stats","datapoints","formattedValue","getValueForSerie","getFormattedValue","isFinite","decimalPlaces","Math","min","formatValue","isArray","join","getFormattedText","toString","date","format","FormattedValue","regexVal","stringToJsRegex","replace","$sanitize","escape","num","max","id","uniqueID","hidden","rule","toColorize","Number","isString","kbn","valueFormats"],"mappings":";;;;;;;AAEA;;AACA;;;;;;;;;;IAEqBA,I;;;AACnB;AACA,gBAAYC,OAAZ,EAAqBC,IAArB,EAA2B;AAAA;;AACzB,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKA,IAAL,CAAUD,OAAV,GAAoBA,OAApB;AACA,SAAKE,SAAL,GAAiB,EAAjB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,MAAL,CAAYN,IAAZ;AACD;;;;8BAES;AACR,aAAO,KAAKA,IAAZ;AACD;;;8BAEQ;AACP,aAAOO,IAAI,CAACC,SAAL,CAAe,IAAf,CAAP;AACD;;;4BAEMC,G,EAAK;AAAA;;AACV,WAAKT,IAAL,CAAUU,IAAV,GAAiBD,GAAG,CAACC,IAAJ,IAAY,OAA7B;AACA,WAAKV,IAAL,CAAUW,IAAV,GAAiBF,GAAG,CAACE,IAAJ,IAAY,QAA7B;AACA,WAAKX,IAAL,CAAUY,KAAV,GAAkBH,GAAG,CAACG,KAAJ,IAAa,SAA/B;AACA,WAAKZ,IAAL,CAAUa,WAAV,GAAwBJ,GAAG,CAACI,WAAJ,IAAmB,SAA3C;AACA,WAAKb,IAAL,CAAUc,QAAV,GAAqBL,GAAG,CAACK,QAAJ,IAAgB,CAArC;AACA,WAAKd,IAAL,CAAUe,MAAV,GAAmBN,GAAG,CAACM,MAAJ,IAAc,CAC/B,wBAD+B,EAE/B,0BAF+B,EAG/B,yBAH+B,CAAjC;AAKA,WAAKf,IAAL,CAAUgB,KAAV,GAAkBP,GAAG,CAACO,KAAJ,IAAa,WAA/B;AACA,WAAKhB,IAAL,CAAUiB,OAAV,GAAoBR,GAAG,CAACQ,OAAJ,IAAe,GAAnC;AACA,WAAKjB,IAAL,CAAUkB,MAAV,GAAmBT,GAAG,CAACQ,OAAJ,IAAe,GAAlC;AACA,WAAKjB,IAAL,CAAUmB,MAAV,GAAmBV,GAAG,CAACU,MAAJ,IAAc,KAAjC;AACA,WAAKnB,IAAL,CAAUoB,WAAV,GAAwBX,GAAG,CAACW,WAAJ,IAAmB,SAA3C;AACA,WAAKpB,IAAL,CAAUqB,WAAV,GAAwBZ,GAAG,CAACY,WAAJ,IAAmB,MAA3C;AACA,WAAKrB,IAAL,CAAUD,OAAV,GAAoBU,GAAG,CAACV,OAAJ,IAAe,KAAKC,IAAL,CAAUD,OAA7C;AACA,WAAKC,IAAL,CAAUsB,UAAV,GAAuBb,GAAG,CAACa,UAAJ,IAAkB,qBAAzC;AACA,WAAKtB,IAAL,CAAUuB,UAAV,GAAuBd,GAAG,CAACc,UAAJ,IAAkB,EAAzC;AACA,WAAKvB,IAAL,CAAUwB,MAAV,GAAmBf,GAAG,CAACe,MAAJ,IAAc,KAAjC;AACA,WAAKxB,IAAL,CAAUyB,SAAV,GAAsBhB,GAAG,CAACgB,SAAJ,IAAiB,IAAvC;AACA,WAAKzB,IAAL,CAAU0B,SAAV,GAAsBjB,GAAG,CAACiB,SAAJ,IAAiB,EAAvC;;AACA,UAAIjB,GAAG,CAACiB,SAAJ,KAAkBC,SAAlB,IAA+BlB,GAAG,CAACiB,SAAJ,KAAkB,IAAjD,IAAyDjB,GAAG,CAACiB,SAAJ,CAAcE,MAAd,GAAuB,CAApF,EAAuF;AACrF,YAAIC,CAAC,GAAG,CAAR;AACApB,QAAAA,GAAG,CAACiB,SAAJ,CAAcI,OAAd,CAAsB,UAACC,GAAD,EAAS;AAC7B,cAAMC,EAAE,GAAG,IAAIC,QAAJ,CAAaF,GAAG,CAAChC,OAAjB,EAA0BgC,GAA1B,CAAX;;AACA,UAAA,KAAI,CAAC9B,SAAL,CAAeiC,IAAf,CAAoBF,EAApB;;AACA,UAAA,KAAI,CAAChC,IAAL,CAAU0B,SAAV,CAAoBG,CAApB,IAAyBE,GAAzB;AACAF,UAAAA,CAAC,IAAI,CAAL;AACD,SALD;AAMD;;AACD,WAAK7B,IAAL,CAAUmC,QAAV,GAAqB1B,GAAG,CAAC0B,QAAJ,IAAgB,IAArC;AACA,WAAKnC,IAAL,CAAUoC,QAAV,GAAqB3B,GAAG,CAAC2B,QAAJ,IAAgB,EAArC;;AACA,UAAI3B,GAAG,CAAC2B,QAAJ,KAAiBT,SAAjB,IAA8BlB,GAAG,CAAC2B,QAAJ,IAAgB,IAA9C,IAAsD3B,GAAG,CAAC2B,QAAJ,CAAaR,MAAb,GAAsB,CAAhF,EAAmF;AACjF,YAAIC,EAAC,GAAG,CAAR;AACApB,QAAAA,GAAG,CAAC2B,QAAJ,CAAaN,OAAb,CAAqB,UAACC,GAAD,EAAS;AAC5B,cAAMM,EAAE,GAAG,IAAIC,OAAJ,CAAYP,GAAG,CAAChC,OAAhB,EAAyBgC,GAAzB,CAAX;;AACA,UAAA,KAAI,CAAC7B,QAAL,CAAcgC,IAAd,CAAmBG,EAAnB;;AACA,UAAA,KAAI,CAACrC,IAAL,CAAUoC,QAAV,CAAmBP,EAAnB,IAAwBE,GAAxB;AACAF,UAAAA,EAAC,IAAI,CAAL;AACD,SALD;AAMD;;AACD,WAAK7B,IAAL,CAAUuC,QAAV,GAAqB9B,GAAG,CAAC8B,QAAJ,IAAgB,IAArC;AACA,WAAKvC,IAAL,CAAUwC,QAAV,GAAqB/B,GAAG,CAAC+B,QAAJ,IAAgB,EAArC;;AACA,UAAI/B,GAAG,CAAC+B,QAAJ,KAAiBb,SAAjB,IAA8BlB,GAAG,CAAC+B,QAAJ,IAAgB,IAA9C,IAAsD/B,GAAG,CAAC+B,QAAJ,CAAaZ,MAAb,GAAsB,CAAhF,EAAmF;AACjF,YAAIC,GAAC,GAAG,CAAR;AACApB,QAAAA,GAAG,CAAC+B,QAAJ,CAAaV,OAAb,CAAqB,UAACC,GAAD,EAAS;AAC5B,cAAMU,EAAE,GAAG,IAAIC,OAAJ,CAAYX,GAAG,CAAChC,OAAhB,EAAyBgC,GAAzB,CAAX;;AACA,UAAA,KAAI,CAAC5B,QAAL,CAAc+B,IAAd,CAAmBO,EAAnB;;AACA,UAAA,KAAI,CAACzC,IAAL,CAAUwC,QAAV,CAAmBX,GAAnB,IAAwBE,GAAxB;AACAF,UAAAA,GAAC,IAAI,CAAL;AACD,SALD;AAMD;;AACD,WAAK7B,IAAL,CAAU2C,WAAV,GAAwBlC,GAAG,CAACkC,WAAJ,IAAmB,CAA3C;AACA,WAAK3C,IAAL,CAAU4C,SAAV,GAAsBnC,GAAG,CAACmC,SAAJ,IAAiB,EAAvC;;AACA,UAAInC,GAAG,CAACmC,SAAJ,KAAkBjB,SAAlB,IAA+BlB,GAAG,CAACmC,SAAJ,IAAiB,IAAhD,IAAwDnC,GAAG,CAACmC,SAAJ,CAAchB,MAAd,GAAuB,CAAnF,EAAsF;AACpF,YAAIC,GAAC,GAAG,CAAR;AACApB,QAAAA,GAAG,CAACmC,SAAJ,CAAcd,OAAd,CAAsB,UAACC,GAAD,EAAS;AAC7B,cAAMc,EAAE,GAAG,IAAIC,QAAJ,CAAaf,GAAG,CAACgB,KAAjB,EAAwBhB,GAAG,CAACiB,IAA5B,EAAkCjB,GAAlC,CAAX;;AACA,UAAA,KAAI,CAAC3B,SAAL,CAAe8B,IAAf,CAAoBW,EAApB;;AACA,UAAA,KAAI,CAAC7C,IAAL,CAAU4C,SAAV,CAAoBf,GAApB,IAAyBE,GAAzB;AACAF,UAAAA,GAAC,IAAI,CAAL;AACD,SALD;AAMD;;AACD,WAAK7B,IAAL,CAAUiD,SAAV,GAAsBxC,GAAG,CAACwC,SAAJ,IAAiB,EAAvC;;AACA,UAAIxC,GAAG,CAACwC,SAAJ,KAAkBtB,SAAlB,IAA+BlB,GAAG,CAACwC,SAAJ,IAAiB,IAAhD,IAAwDxC,GAAG,CAACwC,SAAJ,CAAcrB,MAAd,GAAuB,CAAnF,EAAsF;AACpF,YAAIC,GAAC,GAAG,CAAR;AACApB,QAAAA,GAAG,CAACwC,SAAJ,CAAcnB,OAAd,CAAsB,UAACC,GAAD,EAAS;AAC7B,cAAMmB,EAAE,GAAG,IAAIC,QAAJ,CAAapB,GAAG,CAACqB,IAAjB,EAAuBrB,GAAG,CAACsB,EAA3B,EAA+BtB,GAAG,CAACiB,IAAnC,EAAyCjB,GAAzC,CAAX;;AACA,UAAA,KAAI,CAAC1B,SAAL,CAAe6B,IAAf,CAAoBgB,EAApB;;AACA,UAAA,KAAI,CAAClD,IAAL,CAAUiD,SAAV,CAAoBpB,GAApB,IAAyBE,GAAzB;AACAF,UAAAA,GAAC,IAAI,CAAL;AACD,SALD;AAMD;;AAED,WAAK7B,IAAL,CAAUsD,QAAV,GAAqB7C,GAAG,CAAC6C,QAAJ,IAAgB,KAArC;AACD;;;uCAEkB;AACjB,UAAMC,GAAG,GAAG,KAAKvD,IAAL,CAAUe,MAAtB;AACA,UAAMyC,IAAI,GAAGD,GAAG,CAAC,CAAD,CAAhB;AACAA,MAAAA,GAAG,CAAC,CAAD,CAAH,GAASA,GAAG,CAAC,CAAD,CAAZ;AACAA,MAAAA,GAAG,CAAC,CAAD,CAAH,GAASC,IAAT;AACA,UAAI,KAAKxD,IAAL,CAAUwB,MAAd,EAAsB,KAAKxB,IAAL,CAAUwB,MAAV,GAAmB,KAAnB,CAAtB,KACK,KAAKxB,IAAL,CAAUwB,MAAV,GAAmB,IAAnB;AACN,K,CAED;AACA;AACA;;;;+BACWuB,K,EAAO;AAChB,UAAI,KAAK/C,IAAL,CAAUiB,OAAV,KAAsB,GAA1B,EAA+B,OAAO,IAAP;AAC/B,UAAI,KAAKjB,IAAL,CAAUiB,OAAV,KAAsB,IAAtB,IAA8B,KAAKwC,iBAAL,CAAuBV,KAAvB,KAAiC,CAAnE,EAAsE,OAAO,IAAP;AACtE,aAAO,KAAP;AACD,K,CAED;AACA;AACA;;;;+BACWW,K,EAAO;AAChB,UAAI,KAAK1D,IAAL,CAAUD,OAAV,KAAsB,IAAtB,IAA8B,KAAKC,IAAL,CAAUD,OAAV,KAAsB4B,SAAxD,EAAmE,OAAO,KAAP;AACnE,aAAOgC,CAAC,CAACC,WAAF,CAAcF,KAAK,CAAC9C,KAApB,EAA2B,KAAKZ,IAAL,CAAUD,OAArC,CAAP;AACD,K,CAED;AACA;AACA;;;;gCACYA,O,EAAS;AACnB,UAAMC,IAAI,GAAG,EAAb;AACA,UAAM6D,CAAC,GAAG,IAAI5B,QAAJ,CAAalC,OAAb,EAAsBC,IAAtB,CAAV;AACA6D,MAAAA,CAAC,CAACvD,MAAF,CAASN,IAAT;AACA,WAAKC,SAAL,CAAeiC,IAAf,CAAoB2B,CAApB;AACA,WAAK7D,IAAL,CAAU0B,SAAV,CAAoBQ,IAApB,CAAyBlC,IAAzB;AACD;;;mCAEc8D,K,EAAO;AACpB,WAAK9D,IAAL,CAAU0B,SAAV,CAAoBqC,MAApB,CAA2BD,KAA3B,EAAkC,CAAlC;AACA,WAAK7D,SAAL,CAAe8D,MAAf,CAAsBD,KAAtB,EAA6B,CAA7B;AACD;;;gCAEWA,K,EAAO;AACjB,aAAO,KAAK7D,SAAL,CAAe6D,KAAf,CAAP;AACD;;;mCAEc;AACb,aAAO,KAAK7D,SAAZ;AACD;;;+BAEUF,O,EAAS;AAClB,UAAIiE,KAAK,GAAG,KAAZ;AACA,WAAK/D,SAAL,CAAe6B,OAAf,CAAuB,UAACmC,OAAD,EAAa;AAClC,YAAIA,OAAO,CAACC,KAAR,CAAcnE,OAAd,CAAJ,EAA4BiE,KAAK,GAAG,IAAR;AAC7B,OAFD;AAGA,aAAOA,KAAP;AACD,K,CAED;AACA;AACA;;;;+BACWjE,O,EAAS;AAClB,UAAMC,IAAI,GAAG,EAAb;AACA,UAAM6D,CAAC,GAAG,IAAIvB,OAAJ,CAAYvC,OAAZ,EAAqBC,IAArB,CAAV;AACA6D,MAAAA,CAAC,CAACvD,MAAF,CAASN,IAAT;AACA,WAAKE,QAAL,CAAcgC,IAAd,CAAmB2B,CAAnB;AACA,WAAK7D,IAAL,CAAUoC,QAAV,CAAmBF,IAAnB,CAAwBlC,IAAxB;AACD;;;kCAEa8D,K,EAAO;AACnB,WAAK9D,IAAL,CAAUoC,QAAV,CAAmB2B,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACA,WAAK5D,QAAL,CAAc6D,MAAd,CAAqBD,KAArB,EAA4B,CAA5B;AACD;;;+BAEUA,K,EAAO;AAChB,aAAO,KAAK5D,QAAL,CAAc4D,KAAd,CAAP;AACD;;;kCAEa;AACZ,aAAO,KAAK5D,QAAZ;AACD;;;8BAESH,O,EAAS;AACjB,UAAIiE,KAAK,GAAG,KAAZ;AACA,WAAK9D,QAAL,CAAc4B,OAAd,CAAsB,UAACmC,OAAD,EAAa;AACjC,YAAIA,OAAO,CAACC,KAAR,CAAcnE,OAAd,CAAJ,EAA4BiE,KAAK,GAAG,IAAR;AAC7B,OAFD;AAGA,aAAOA,KAAP;AACD,K,CAED;AACA;AACA;;;;+BACWjE,O,EAAS;AAClB4D,MAAAA,CAAC,CAACQ,GAAF,CAAM,CAAN,EAAS,mBAAT;AACA,UAAMnE,IAAI,GAAG,EAAb;AACA,UAAM6D,CAAC,GAAG,IAAInB,OAAJ,CAAY3C,OAAZ,EAAqBC,IAArB,CAAV;AACA6D,MAAAA,CAAC,CAACvD,MAAF,CAASN,IAAT;AACA,WAAKG,QAAL,CAAc+B,IAAd,CAAmB2B,CAAnB;AACA,WAAK7D,IAAL,CAAUwC,QAAV,CAAmBN,IAAnB,CAAwBlC,IAAxB;AACD;;;kCAEa8D,K,EAAO;AACnB,WAAK9D,IAAL,CAAUwC,QAAV,CAAmBuB,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACA,WAAK3D,QAAL,CAAc4D,MAAd,CAAqBD,KAArB,EAA4B,CAA5B;AACD;;;+BAEUA,K,EAAO;AAChB,aAAO,KAAK3D,QAAL,CAAc2D,KAAd,CAAP;AACD;;;kCAEa;AACZ,aAAO,KAAK3D,QAAZ;AACD;;;8BAESJ,O,EAAS;AACjB,UAAIiE,KAAK,GAAG,KAAZ;AACA,WAAK7D,QAAL,CAAc2B,OAAd,CAAsB,UAACmC,OAAD,EAAa;AACjC,YAAIA,OAAO,CAACC,KAAR,CAAcnE,OAAd,CAAJ,EAA4BiE,KAAK,GAAG,IAAR;AAC7B,OAFD;AAGA,aAAOA,KAAP;AACD,K,CAED;AACA;AACA;;;;gCACYjB,K,EAAOC,I,EAAM;AACvB,UAAMhD,IAAI,GAAG,EAAb;AACA,UAAM6D,CAAC,GAAG,IAAIf,QAAJ,CAAaC,KAAb,EAAoBC,IAApB,EAA0BhD,IAA1B,CAAV;AACA6D,MAAAA,CAAC,CAACvD,MAAF,CAASN,IAAT;AACA,WAAKI,SAAL,CAAe8B,IAAf,CAAoB2B,CAApB;AACA,WAAK7D,IAAL,CAAU4C,SAAV,CAAoBV,IAApB,CAAyBlC,IAAzB;AACD;;;mCAEc8D,K,EAAO;AACpB,WAAK9D,IAAL,CAAU4C,SAAV,CAAoBmB,MAApB,CAA2BD,KAA3B,EAAkC,CAAlC;AACA,WAAK1D,SAAL,CAAe2D,MAAf,CAAsBD,KAAtB,EAA6B,CAA7B;AACD;;;gCAEWA,K,EAAO;AACjB,aAAO,KAAK1D,SAAL,CAAe0D,KAAf,CAAP;AACD;;;mCAEc;AACb,aAAO,KAAK1D,SAAZ;AACD,K,CAED;AACA;AACA;;;;gCACYgD,I,EAAMC,E,EAAIL,I,EAAM;AAC1B,UAAMhD,IAAI,GAAG,EAAb;AACA,UAAM6D,CAAC,GAAG,IAAIV,QAAJ,CAAaC,IAAb,EAAmBC,EAAnB,EAAuBL,IAAvB,EAA6BhD,IAA7B,CAAV;AACA,WAAKK,SAAL,CAAe6B,IAAf,CAAoB2B,CAApB;AACA,WAAK7D,IAAL,CAAUiD,SAAV,CAAoBf,IAApB,CAAyBlC,IAAzB;AACD;;;mCAEc8D,K,EAAO;AACpB,WAAK9D,IAAL,CAAUiD,SAAV,CAAoBc,MAApB,CAA2BD,KAA3B,EAAkC,CAAlC;AACA,WAAKzD,SAAL,CAAe0D,MAAf,CAAsBD,KAAtB,EAA6B,CAA7B;AACD;;;gCAEWA,K,EAAO;AACjB,aAAO,KAAKzD,SAAL,CAAeyD,KAAf,CAAP;AACD;;;mCAEc;AACb,aAAO,KAAKzD,SAAZ;AACD;;;iCAEYyD,K,EAAO;AAClB,WAAKzD,SAAL,CAAeyD,KAAf,EAAsBM,IAAtB;AACD;;;iCAEYN,K,EAAO;AAClB,WAAKzD,SAAL,CAAeyD,KAAf,EAAsBO,IAAtB;AACD,K,CAED;AACA;AACA;;;;qCACiBtB,K,EAAO;AACtB,UAAI,CAAC,KAAK/C,IAAL,CAAUuB,UAAX,IAAyB,KAAKvB,IAAL,CAAUuB,UAAV,CAAqBK,MAArB,KAAgC,CAA7D,EAAgE;AAC9D,eAAO,IAAP;AACD;;AAED,WAAK,IAAIC,CAAC,GAAG,KAAK7B,IAAL,CAAUuB,UAAV,CAAqBK,MAAlC,EAA0CC,CAAC,GAAG,CAA9C,EAAiDA,CAAC,IAAI,CAAtD,EAAyD;AACvD,YAAIkB,KAAK,IAAI,KAAK/C,IAAL,CAAUuB,UAAV,CAAqBM,CAAC,GAAG,CAAzB,CAAb,EAA0C;AACxC,iBAAO,KAAK7B,IAAL,CAAUe,MAAV,CAAiBc,CAAjB,CAAP;AACD;AACF;;AACD,aAAOyC,CAAC,CAACC,KAAF,CAAQ,KAAKvE,IAAL,CAAUe,MAAlB,CAAP;AACD;;;sCAEiBgC,K,EAAO;AACvB,UAAIyB,cAAc,GAAG,CAArB;AACA,UAAMjD,UAAU,GAAG,KAAKvB,IAAL,CAAUuB,UAA7B;AAEA,UAAIA,UAAU,KAAKI,SAAf,IAA4BJ,UAAU,CAACK,MAAX,KAAsB,CAAtD,EAAyD,OAAO,CAAC,CAAR;AACzD,UAAIL,UAAU,CAACK,MAAX,KAAsB,CAA1B,EAA6B,OAAO,CAAC,CAAR,CALN,CAOvB;;AACA,UAAI,CAAC,KAAK5B,IAAL,CAAUwB,MAAf,EAAuB;AACrBgD,QAAAA,cAAc,GAAG,CAAjB;AACA,YAAIzB,KAAK,IAAIxB,UAAU,CAAC,CAAD,CAAvB,EAA4BiD,cAAc,GAAG,CAAjB;AAC5B,YAAIzB,KAAK,IAAIxB,UAAU,CAAC,CAAD,CAAvB,EAA4BiD,cAAc,GAAG,CAAjB;AAC7B,OAJD,MAIO;AACLA,QAAAA,cAAc,GAAG,CAAjB;AACA,YAAIzB,KAAK,IAAIxB,UAAU,CAAC,CAAD,CAAvB,EAA4BiD,cAAc,GAAG,CAAjB;AAC5B,YAAIzB,KAAK,IAAIxB,UAAU,CAAC,CAAD,CAAvB,EAA4BiD,cAAc,GAAG,CAAjB;AAC7B;;AACD,aAAOA,cAAP;AACD;;;qCAEgBd,K,EAAO;AACtB,UAAI,KAAKe,UAAL,CAAgBf,KAAhB,CAAJ,EAA4B;AAC1B,YAAIX,KAAK,GAAGuB,CAAC,CAACI,GAAF,CAAMhB,KAAK,CAACiB,KAAZ,EAAmB,KAAK3E,IAAL,CAAUa,WAA7B,CAAZ;;AACA,YAAIkC,KAAK,KAAKpB,SAAV,IAAuBoB,KAAK,KAAK,IAArC,EAA2C;AACzCA,UAAAA,KAAK,GAAGW,KAAK,CAACkB,UAAN,CAAiBlB,KAAK,CAACkB,UAAN,CAAiBhD,MAAjB,GAA0B,CAA3C,EAA8C,CAA9C,CAAR;AACD;;AACD,eAAOmB,KAAP;AACD;;AACD,aAAO,GAAP;AACD;;;8CAEyBW,K,EAAO;AAC/B,UAAMmB,cAAc,GAAG,KAAKC,gBAAL,CAAsBpB,KAAtB,CAAvB;AACA,aAAO,KAAKqB,iBAAL,CAAuBF,cAAvB,CAAP;AACD;;;sCAEiB9B,K,EAAO;AACvB;AACA,UAAI,KAAK/C,IAAL,CAAUW,IAAV,KAAmB,QAAvB,EAAiC;AAC/B,YAAI,CAAC2D,CAAC,CAACU,QAAF,CAAWjC,KAAX,CAAL,EAAwB,OAAO,gBAAP;;AACxB,YAAIA,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAArC,EAAwC;AACtC,iBAAO,GAAP;AACD;;AACD,YAAIjC,QAAQ,GAAG,KAAKmE,aAAL,CAAmBlC,KAAnB,CAAf;AACAjC,QAAAA,QAAQ,GACN,OAAO,KAAKd,IAAL,CAAUc,QAAjB,KAA8B,QAA9B,GAAyCoE,IAAI,CAACC,GAAL,CAAS,KAAKnF,IAAL,CAAUc,QAAnB,EAA6BA,QAA7B,CAAzC,GAAkFA,QADpF;AAEA,eAAOsE,WAAW,CAACrC,KAAD,EAAQ,KAAK/C,IAAL,CAAUU,IAAlB,EAAwB,KAAKV,IAAL,CAAUc,QAAlC,CAAlB;AACD;;AAED,UAAI,KAAKd,IAAL,CAAUW,IAAV,KAAmB,QAAvB,EAAiC;AAC/B,YAAI2D,CAAC,CAACe,OAAF,CAAUtC,KAAV,CAAJ,EAAsB;AACpBA,UAAAA,KAAK,GAAGA,KAAK,CAACuC,IAAN,CAAW,IAAX,CAAR;AACD;;AACD,YAAM3C,WAAW,GAAG,KAAK3C,IAAL,CAAU2C,WAAV,IAAyB,CAA7C;;AACA,YAAIA,WAAW,KAAK,CAAhB,IAAqB,KAAKvC,SAA9B,EAAyC;AACvC,eAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzB,SAAL,CAAewB,MAAnC,EAA2CC,CAAC,IAAI,CAAhD,EAAmD;AACjD,gBAAME,GAAG,GAAG,KAAK3B,SAAL,CAAeyB,CAAf,CAAZ;AACA,gBAAIE,GAAG,CAACmC,KAAJ,CAAUnB,KAAV,CAAJ,EAAsB,OAAOhB,GAAG,CAACwD,gBAAJ,CAAqBxC,KAArB,CAAP;AACvB;;AACD,iBAAOA,KAAK,CAACyC,QAAN,EAAP;AACD;;AAED,YAAI7C,WAAW,KAAK,CAAhB,IAAqB,KAAKtC,SAA9B,EAAyC;AACvC,eAAK,IAAIwB,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG,KAAKxB,SAAL,CAAeuB,MAAnC,EAA2CC,GAAC,IAAI,CAAhD,EAAmD;AACjD,gBAAME,IAAG,GAAG,KAAK1B,SAAL,CAAewB,GAAf,CAAZ;AACA,gBAAIE,IAAG,CAACmC,KAAJ,CAAUnB,KAAV,CAAJ,EAAsB,OAAOhB,IAAG,CAACwD,gBAAJ,CAAqBxC,KAArB,CAAP;AACvB;;AACD,iBAAOA,KAAK,CAACyC,QAAN,EAAP;AACD;;AAED,YAAIzC,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAArC,EAAwC;AACtC,iBAAO,GAAP;AACD;AACF;;AAED,UAAI,KAAK/C,IAAL,CAAUW,IAAV,KAAmB,MAAvB,EAA+B;AAC7B,YAAIoC,KAAK,KAAKpB,SAAV,IAAuBoB,KAAK,KAAK,IAArC,EAA2C;AACzC,iBAAO,GAAP;AACD;;AAED,YAAIuB,CAAC,CAACe,OAAF,CAAUtC,KAAV,CAAJ,EAAsB;AACpBA,UAAAA,KAAK,GAAGA,KAAK,CAAC,CAAD,CAAb;AACD;;AACD,YAAM0C,IAAI,GAAG,qBAAO1C,KAAP,CAAb,CAR6B,CAS7B;AACA;AACA;;AACA,eAAO0C,IAAI,CAACC,MAAL,CAAY,KAAK1F,IAAL,CAAUsB,UAAtB,CAAP;AACD;;AAED,aAAOyB,KAAP;AACD;;;mCAEcC,I,EAAM2C,c,EAAgB;AACnC,UAAI,KAAK3F,IAAL,CAAUoB,WAAV,KAA0B,SAA9B,EAAyC,OAAOuE,cAAP;AACzC,UAAMC,QAAQ,GAAGjC,CAAC,CAACkC,eAAF,CAAkB,KAAK7F,IAAL,CAAUqB,WAA5B,CAAjB;AACA,UAAI2B,IAAI,CAACwC,QAAL,GAAgBtB,KAAhB,CAAsB0B,QAAtB,CAAJ,EAAqC,OAAO5C,IAAI,CAACwC,QAAL,GAAgBM,OAAhB,CAAwBF,QAAxB,EAAkCD,cAAlC,CAAP;AACrC,aAAO3C,IAAP;AACD;;;0CAEqBD,K,EAAO;AAC3B,UAAIA,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAAjC,IAAsCA,KAAK,KAAKpB,SAApD,EAA+D;AAC7D,eAAO,EAAP;AACD;;AAED,UAAI2C,CAAC,CAACe,OAAF,CAAUtC,KAAV,CAAJ,EAAsB;AACpBA,QAAAA,KAAK,GAAGA,KAAK,CAACuC,IAAN,CAAW,IAAX,CAAR;AACD;;AAED,UAAI,KAAKhC,QAAT,EAAmB;AACjB,eAAO,KAAKyC,SAAL,CAAehD,KAAf,CAAP;AACD;;AACD,aAAOuB,CAAC,CAAC0B,MAAF,CAASjD,KAAT,CAAP;AACD;;;kCAEakD,G,EAAK;AACjB,UAAI/B,KAAK,GAAG,CAAC,KAAK+B,GAAN,EAAW/B,KAAX,CAAiB,kCAAjB,CAAZ;;AACA,UAAI,CAACA,KAAL,EAAY;AACV,eAAO,CAAP;AACD;;AACD,aAAOgB,IAAI,CAACgB,GAAL,CACL,CADK,EAEL;AACA,OAAChC,KAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAL,CAAStC,MAApB,GAA6B,CAA9B,MACE;AACCsC,MAAAA,KAAK,CAAC,CAAD,CAAL,GAAW,CAACA,KAAK,CAAC,CAAD,CAAjB,GAAuB,CAF1B,CAHK,CAAP;AAOD;;;;KAIH;AACA;AACA;;;;;IACMjC,Q;;;AACJ,oBAAYlC,OAAZ,EAAqBC,IAArB,EAA2B;AAAA;;AACzB,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKmG,EAAL,GAAUxC,CAAC,CAACyC,QAAF,EAAV;AACA,SAAKpG,IAAL,CAAUD,OAAV,GAAoB4B,SAApB;AACA,SAAK3B,IAAL,CAAUD,OAAV,GAAoBA,OAApB;AACA,SAAKO,MAAL,CAAYN,IAAZ;AACD;;;;4BAEMS,G,EAAK;AACV,WAAKT,IAAL,CAAUD,OAAV,GAAoBU,GAAG,CAACV,OAAJ,IAAe,EAAnC;AACA,WAAKC,IAAL,CAAUqG,MAAV,GAAmB5F,GAAG,CAAC4F,MAAJ,IAAc,KAAjC;AACD;;;0BAEKrD,I,EAAM;AACV,UAAIA,IAAI,KAAKrB,SAAT,IAAsBqB,IAAI,KAAK,IAA/B,IAAuCA,IAAI,CAACpB,MAAL,KAAgB,CAA3D,EAA8D,OAAO,KAAP;AAC9D,aAAO+B,CAAC,CAACC,WAAF,CAAcZ,IAAd,EAAoB,KAAKhD,IAAL,CAAUD,OAA9B,CAAP;AACD;;;4BAEO;AACN,aAAO,KAAKoG,EAAZ;AACD;;;2BAEM;AACL,WAAKnG,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACD;;;2BAEM;AACL,WAAKrG,IAAL,CAAUqG,MAAV,GAAmB,IAAnB;AACD;;;+BAEU;AACT,aAAO,KAAKrG,IAAL,CAAUqG,MAAjB;AACD;;;8BAEQ;AACP,aAAO;AACLtG,QAAAA,OAAO,EAAE,KAAKC,IAAL,CAAUD,OADd;AAELsG,QAAAA,MAAM,EAAE,KAAKrG,IAAL,CAAUqG;AAFb,OAAP;AAID;;;+BAEUtD,K,EAAO;AAChB,UAAI,KAAK/C,IAAL,CAAUqG,MAAd,EAAsB,OAAO,KAAP;AACtB,aAAO,KAAKC,IAAL,CAAUC,UAAV,CAAqBxD,KAArB,CAAP;AACD;;;gCAEW;AACV,UAAI,KAAK/C,IAAL,CAAUqG,MAAd,EAAsB,OAAO,KAAP;AACtB,aAAO,IAAP;AACD;;;;KAGH;AACA;AACA;;;IACM/D,O;;;AACJ,mBAAYvC,OAAZ,EAAqBC,IAArB,EAA2B;AAAA;;AACzB,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKmG,EAAL,GAAUxC,CAAC,CAACyC,QAAF,EAAV;AACA,SAAKpG,IAAL,CAAUD,OAAV,GAAoBA,OAApB;AACA,SAAKO,MAAL,CAAYN,IAAZ;AACD;;;;4BAEMS,G,EAAK;AACV,WAAKT,IAAL,CAAUD,OAAV,GAAoBU,GAAG,CAACV,OAAJ,IAAe,KAAKC,IAAL,CAAUD,OAA7C;AACA,WAAKC,IAAL,CAAUqG,MAAV,GAAmB5F,GAAG,CAAC4F,MAAJ,IAAc,KAAjC;AACD;;;0BAEKrD,I,EAAM;AACV,UAAIA,IAAI,KAAKrB,SAAT,IAAsBqB,IAAI,KAAK,IAA/B,IAAuCA,IAAI,CAACpB,MAAL,KAAgB,CAA3D,EAA8D,OAAO,KAAP;AAC9D,aAAO+B,CAAC,CAACC,WAAF,CAAcZ,IAAd,EAAoB,KAAKhD,IAAL,CAAUD,OAA9B,CAAP;AACD;;;4BAEO;AACN,aAAO,KAAKoG,EAAZ;AACD;;;2BAEM;AACL,WAAKnG,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACD;;;2BAEM;AACL,WAAKrG,IAAL,CAAUqG,MAAV,GAAmB,IAAnB;AACD;;;+BAEU;AACT,aAAO,KAAKrG,IAAL,CAAUqG,MAAjB;AACD;;;8BAEQ;AACP,aAAO;AACLtG,QAAAA,OAAO,EAAE,KAAKC,IAAL,CAAUD,OADd;AAELsG,QAAAA,MAAM,EAAE,KAAKrG,IAAL,CAAUqG;AAFb,OAAP;AAID;;;;KAGH;AACA;AACA;;;IACM3D,O;;;AACJ,mBAAY3C,OAAZ,EAAqBC,IAArB,EAA2B;AAAA;;AACzB,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKmG,EAAL,GAAUxC,CAAC,CAACyC,QAAF,EAAV;AACA,SAAKpG,IAAL,CAAUD,OAAV,GAAoBA,OAApB;AACA,SAAKO,MAAL,CAAYN,IAAZ;AACD;;;;4BAEMS,G,EAAK;AACV,WAAKT,IAAL,CAAUD,OAAV,GAAoBU,GAAG,CAACV,OAAJ,IAAe,KAAKC,IAAL,CAAUD,OAAzB,IAAoC,EAAxD;AACA,WAAKC,IAAL,CAAUqG,MAAV,GAAmB5F,GAAG,CAAC4F,MAAJ,IAAc,KAAjC;AACD;;;0BAEKrD,I,EAAM;AACV,UAAIA,IAAI,KAAKrB,SAAT,IAAsBqB,IAAI,KAAK,IAA/B,IAAuCA,IAAI,CAACpB,MAAL,KAAgB,CAA3D,EAA8D,OAAO,KAAP;AAC9D,aAAO+B,CAAC,CAACC,WAAF,CAAcZ,IAAd,EAAoB,KAAKhD,IAAL,CAAUD,OAA9B,CAAP;AACD;;;4BAEO;AACN,aAAO,KAAKoG,EAAZ;AACD;;;2BAEM;AACL,WAAKnG,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACD;;;2BAEM;AACL,WAAKrG,IAAL,CAAUqG,MAAV,GAAmB,IAAnB;AACD;;;+BAEU;AACT,aAAO,KAAKrG,IAAL,CAAUqG,MAAjB;AACD;;;8BAEQ;AACP,aAAO;AACLtG,QAAAA,OAAO,EAAE,KAAKC,IAAL,CAAUD,OADd;AAELsG,QAAAA,MAAM,EAAE,KAAKrG,IAAL,CAAUqG;AAFb,OAAP;AAID;;;;KAGH;AACA;AACA;;;IACMlD,Q;;;AACJ,oBAAYC,IAAZ,EAAkBC,EAAlB,EAAsBL,IAAtB,EAA4BhD,IAA5B,EAAkC;AAAA;;AAChC,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKmG,EAAL,GAAUxC,CAAC,CAACyC,QAAF,EAAV;AACA,SAAKpG,IAAL,CAAUoD,IAAV,GAAiBA,IAAjB;AACA,SAAKpD,IAAL,CAAUqD,EAAV,GAAeA,EAAf;AACA,SAAKrD,IAAL,CAAUgD,IAAV,GAAiBA,IAAjB;AACA,SAAKhD,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACA,SAAK/F,MAAL,CAAYN,IAAZ;AACD;;;;4BAEMS,G,EAAK;AACV,WAAKT,IAAL,CAAUoD,IAAV,GAAiB3C,GAAG,CAAC2C,IAAJ,IAAY,KAAKpD,IAAL,CAAUoD,IAAtB,IAA8B,EAA/C;AACA,WAAKpD,IAAL,CAAUqD,EAAV,GAAe5C,GAAG,CAAC4C,EAAJ,IAAU,KAAKrD,IAAL,CAAUqD,EAApB,IAA0B,EAAzC;AACA,WAAKrD,IAAL,CAAUgD,IAAV,GAAiBvC,GAAG,CAACuC,IAAJ,IAAY,KAAKhD,IAAL,CAAUgD,IAAtB,IAA8B,EAA/C;AACA,WAAKhD,IAAL,CAAUqG,MAAV,GAAmB5F,GAAG,CAAC4F,MAAJ,IAAc,KAAKrG,IAAL,CAAUqG,MAAxB,IAAkC,KAArD;AACD;;;0BAEKtD,K,EAAO;AACX,UAAI,KAAK/C,IAAL,CAAUoD,IAAV,KAAmB,MAAnB,IAA6B,KAAKpD,IAAL,CAAUqD,EAAV,KAAiB,MAAlD,EAA0D;AACxD,eAAO,IAAP;AACD;;AACD,UAAIN,KAAK,KAAK,IAAd,EAAoB;AAClB,YAAI,KAAK/C,IAAL,CAAUoD,IAAV,KAAmB,MAAnB,IAA6B,KAAKpD,IAAL,CAAUqD,EAAV,KAAiB,MAAlD,EAA0D;AACxD,iBAAO,IAAP;AACD;AACF;;AACD,UAAImD,MAAM,CAAC,KAAKxG,IAAL,CAAUoD,IAAX,CAAN,IAA0BoD,MAAM,CAACzD,KAAD,CAAhC,IAA2CyD,MAAM,CAAC,KAAKxG,IAAL,CAAUqD,EAAX,CAAN,IAAwBmD,MAAM,CAACzD,KAAD,CAA7E,EAAsF;AACpF,eAAO,IAAP;AACD;;AACD,aAAO,KAAP;AACD;;;4BAEO;AACN,aAAO,KAAKoD,EAAZ;AACD;;;qCAEgBpD,K,EAAO;AACtB,UAAIA,KAAK,KAAK,IAAd,EAAoB;AAClB,YAAI,KAAK/C,IAAL,CAAUoD,IAAV,KAAmB,MAAnB,IAA6B,KAAKpD,IAAL,CAAUqD,EAAV,KAAiB,MAAlD,EAA0D;AACxD,iBAAO,KAAKrD,IAAL,CAAUgD,IAAjB;AACD;AACF;;AACD,UAAI,KAAKkB,KAAL,CAAWnB,KAAX,CAAJ,EAAuB;AACrB,eAAO,KAAK/C,IAAL,CAAUgD,IAAjB;AACD;;AACD,aAAOD,KAAP;AACD;;;2BAEM;AACL,WAAK/C,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACD;;;2BAEM;AACL,WAAKrG,IAAL,CAAUqG,MAAV,GAAmB,IAAnB;AACD;;;+BAEU;AACT,aAAO,KAAKrG,IAAL,CAAUqG,MAAjB;AACD;;;8BAEQ;AACP,aAAO;AACLjD,QAAAA,IAAI,EAAE,KAAKpD,IAAL,CAAUoD,IADX;AAELC,QAAAA,EAAE,EAAE,KAAKrD,IAAL,CAAUqD,EAFT;AAGLL,QAAAA,IAAI,EAAE,KAAKhD,IAAL,CAAUgD,IAHX;AAILqD,QAAAA,MAAM,EAAE,KAAKrG,IAAL,CAAUqG;AAJb,OAAP;AAMD;;;;KAGH;AACA;AACA;;;IACMvD,Q;;;AACJ,oBAAYC,KAAZ,EAAmBC,IAAnB,EAAyBhD,IAAzB,EAA+B;AAAA;;AAC7B,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKmG,EAAL,GAAUxC,CAAC,CAACyC,QAAF,EAAV;AACA,SAAKpG,IAAL,CAAU+C,KAAV,GAAkBA,KAAlB;AACA,SAAK/C,IAAL,CAAUgD,IAAV,GAAiBA,IAAjB;AACA,SAAKhD,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACA,SAAK/F,MAAL,CAAYN,IAAZ;AACD;;;;4BAEMS,G,EAAK;AACV,WAAKT,IAAL,CAAU+C,KAAV,GAAkBtC,GAAG,CAACsC,KAAJ,IAAa,KAAK/C,IAAL,CAAU+C,KAAvB,IAAgC,EAAlD;AACA,WAAK/C,IAAL,CAAUgD,IAAV,GAAiBvC,GAAG,CAACuC,IAAJ,IAAY,KAAKhD,IAAL,CAAUgD,IAAtB,IAA8B,EAA/C;AACA,WAAKhD,IAAL,CAAUqG,MAAV,GAAmB5F,GAAG,CAAC4F,MAAJ,IAAc,KAAKrG,IAAL,CAAUqG,MAAxB,IAAkC,KAArD;AACD;;;0BAEKtD,K,EAAO;AACX,UAAIA,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAKpB,SAAhC,EAA2C;AACzC,YAAI,KAAK3B,IAAL,CAAU+C,KAAV,KAAoB,MAAxB,EAAgC;AAC9B,iBAAO,IAAP;AACD;;AACD,eAAO,KAAP;AACD;;AAED,UAAI,CAACuB,CAAC,CAACmC,QAAF,CAAW1D,KAAX,CAAD,IAAsByD,MAAM,CAAC,KAAKxG,IAAL,CAAU+C,KAAX,CAAN,KAA4ByD,MAAM,CAACzD,KAAD,CAA5D,EAAqE;AACnE,eAAO,IAAP;AACD;;AAED,aAAOY,CAAC,CAACC,WAAF,CAAcb,KAAK,CAACyC,QAAN,EAAd,EAAgC,KAAKxF,IAAL,CAAU+C,KAA1C,CAAP;AACD;;;4BAEO;AACN,aAAO,KAAKoD,EAAZ;AACD;;;qCAEgBpD,K,EAAO;AACtB,UAAIA,KAAK,KAAK,IAAd,EAAoB;AAClB,YAAI,KAAK/C,IAAL,CAAU+C,KAAV,KAAoB,MAAxB,EAAgC;AAC9B,iBAAO,KAAK/C,IAAL,CAAUgD,IAAjB;AACD;AACF;;AACD,UAAI,KAAKkB,KAAL,CAAWnB,KAAX,CAAJ,EAAuB;AACrB,eAAO,KAAK/C,IAAL,CAAUgD,IAAjB;AACD;;AACD,aAAOD,KAAP;AACD;;;2BAEM;AACL,WAAK/C,IAAL,CAAUqG,MAAV,GAAmB,KAAnB;AACD;;;2BAEM;AACL,WAAKrG,IAAL,CAAUqG,MAAV,GAAmB,IAAnB;AACD;;;+BAEU;AACT,aAAO,KAAKrG,IAAL,CAAUqG,MAAjB;AACD;;;8BAEQ;AACP,aAAO;AACLtD,QAAAA,KAAK,EAAE,KAAK/C,IAAL,CAAU+C,KADZ;AAELC,QAAAA,IAAI,EAAE,KAAKhD,IAAL,CAAUgD,IAFX;AAGLqD,QAAAA,MAAM,EAAE,KAAKrG,IAAL,CAAUqG;AAHb,OAAP;AAKD;;;;;;AAGH,SAASjB,WAAT,CAAqBrC,KAArB,EAA4BrC,IAA5B,EAAkCI,QAAlC,EAA4C;AAC1C,SAAO4F,aAAIC,YAAJ,CAAiBjG,IAAjB,EAAuBqC,KAAvB,EAA8BjC,QAA9B,EAAwC,IAAxC,EAA8C0E,QAA9C,EAAP;AACD","sourcesContent":["/* eslint-disable no-use-before-define */\r\n// eslint-disable-next-line import/no-unresolved\r\nimport kbn from 'app/core/utils/kbn';\r\nimport moment from 'moment';\r\n\r\nexport default class Rule {\r\n  /** @ngInject */\r\n  constructor(pattern, data) {\r\n    this.data = data;\r\n    this.data.pattern = pattern;\r\n    this.shapeMaps = [];\r\n    this.textMaps = [];\r\n    this.linkMaps = [];\r\n    this.valueMaps = [];\r\n    this.rangeMaps = [];\r\n    this.import(data);\r\n  }\r\n\r\n  getData() {\r\n    return this.data;\r\n  }\r\n\r\n  export() {\r\n    return JSON.stringify(this);\r\n  }\r\n\r\n  import(obj) {\r\n    this.data.unit = obj.unit || 'short';\r\n    this.data.type = obj.type || 'number';\r\n    this.data.alias = obj.alias || 'No name';\r\n    this.data.aggregation = obj.aggregation || 'current';\r\n    this.data.decimals = obj.decimals || 2;\r\n    this.data.colors = obj.colors || [\r\n      'rgba(245, 54, 54, 0.9)',\r\n      'rgba(237, 129, 40, 0.89)',\r\n      'rgba(50, 172, 45, 0.97)',\r\n    ];\r\n    this.data.style = obj.style || 'fillColor';\r\n    this.data.colorOn = obj.colorOn || 'a';\r\n    this.data.linkOn = obj.colorOn || 'a';\r\n    this.data.textOn = obj.textOn || 'wmd';\r\n    this.data.textReplace = obj.textReplace || 'content';\r\n    this.data.textPattern = obj.textPattern || '/.*/';\r\n    this.data.pattern = obj.pattern || this.data.pattern;\r\n    this.data.dateFormat = obj.dateFormat || 'YYYY-MM-DD HH:mm:ss';\r\n    this.data.thresholds = obj.thresholds || [];\r\n    this.data.invert = obj.invert || false;\r\n    this.data.shapeProp = obj.shapeProp || 'id';\r\n    this.data.shapeData = obj.shapeData || [];\r\n    if (obj.shapeData !== undefined && obj.shapeData !== null && obj.shapeData.length > 0) {\r\n      let i = 0;\r\n      obj.shapeData.forEach((map) => {\r\n        const sm = new ShapeMap(map.pattern, map);\r\n        this.shapeMaps.push(sm);\r\n        this.data.shapeData[i] = map;\r\n        i += 1;\r\n      });\r\n    }\r\n    this.data.textProp = obj.textProp || 'id';\r\n    this.data.textData = obj.textData || [];\r\n    if (obj.textData !== undefined && obj.textData != null && obj.textData.length > 0) {\r\n      let i = 0;\r\n      obj.textData.forEach((map) => {\r\n        const tm = new TextMap(map.pattern, map);\r\n        this.textMaps.push(tm);\r\n        this.data.textData[i] = map;\r\n        i += 1;\r\n      });\r\n    }\r\n    this.data.linkProp = obj.linkProp || 'id';\r\n    this.data.linkData = obj.linkData || [];\r\n    if (obj.linkData !== undefined && obj.linkData != null && obj.linkData.length > 0) {\r\n      let i = 0;\r\n      obj.linkData.forEach((map) => {\r\n        const lm = new LinkMap(map.pattern, map);\r\n        this.linkMaps.push(lm);\r\n        this.data.linkData[i] = map;\r\n        i += 1;\r\n      });\r\n    }\r\n    this.data.mappingType = obj.mappingType || 1;\r\n    this.data.valueData = obj.valueData || [];\r\n    if (obj.valueData !== undefined && obj.valueData != null && obj.valueData.length > 0) {\r\n      let i = 0;\r\n      obj.valueData.forEach((map) => {\r\n        const vm = new ValueMap(map.value, map.text, map);\r\n        this.valueMaps.push(vm);\r\n        this.data.valueData[i] = map;\r\n        i += 1;\r\n      });\r\n    }\r\n    this.data.rangeData = obj.rangeData || [];\r\n    if (obj.rangeData !== undefined && obj.rangeData != null && obj.rangeData.length > 0) {\r\n      let i = 0;\r\n      obj.rangeData.forEach((map) => {\r\n        const rm = new RangeMap(map.from, map.to, map.text, map);\r\n        this.rangeMaps.push(rm);\r\n        this.data.rangeData[i] = map;\r\n        i += 1;\r\n      });\r\n    }\r\n\r\n    this.data.sanitize = obj.sanitize || false;\r\n  }\r\n\r\n  invertColorOrder() {\r\n    const ref = this.data.colors;\r\n    const copy = ref[0];\r\n    ref[0] = ref[2];\r\n    ref[2] = copy;\r\n    if (this.data.invert) this.data.invert = false;\r\n    else this.data.invert = true;\r\n  }\r\n\r\n  //\r\n  // Conditions\r\n  //\r\n  toColorize(value) {\r\n    if (this.data.colorOn === 'a') return true;\r\n    if (this.data.colorOn === 'wc' && this.getThresholdLevel(value) >= 1) return true;\r\n    return false;\r\n  }\r\n\r\n  //\r\n  // Series\r\n  //\r\n  matchSerie(serie) {\r\n    if (this.data.pattern === null || this.data.pattern === undefined) return false;\r\n    return u.matchString(serie.alias, this.data.pattern);\r\n  }\r\n\r\n  //\r\n  // SHAPE MAPS\r\n  //\r\n  addShapeMap(pattern) {\r\n    const data = {};\r\n    const m = new ShapeMap(pattern, data);\r\n    m.import(data);\r\n    this.shapeMaps.push(m);\r\n    this.data.shapeData.push(data);\r\n  }\r\n\r\n  removeShapeMap(index) {\r\n    this.data.shapeData.splice(index, 1);\r\n    this.shapeMaps.splice(index, 1);\r\n  }\r\n\r\n  getShapeMap(index) {\r\n    return this.shapeMaps[index];\r\n  }\r\n\r\n  getShapeMaps() {\r\n    return this.shapeMaps;\r\n  }\r\n\r\n  matchShape(pattern) {\r\n    let found = false;\r\n    this.shapeMaps.forEach((element) => {\r\n      if (element.match(pattern)) found = true;\r\n    });\r\n    return found;\r\n  }\r\n\r\n  //\r\n  // TEXT MAPS\r\n  //\r\n  addTextMap(pattern) {\r\n    const data = {};\r\n    const m = new TextMap(pattern, data);\r\n    m.import(data);\r\n    this.textMaps.push(m);\r\n    this.data.textData.push(data);\r\n  }\r\n\r\n  removeTextMap(index) {\r\n    this.data.textData.splice(index, 1);\r\n    this.textMaps.splice(index, 1);\r\n  }\r\n\r\n  getTextMap(index) {\r\n    return this.textMaps[index];\r\n  }\r\n\r\n  getTextMaps() {\r\n    return this.textMaps;\r\n  }\r\n\r\n  matchText(pattern) {\r\n    let found = false;\r\n    this.textMaps.forEach((element) => {\r\n      if (element.match(pattern)) found = true;\r\n    });\r\n    return found;\r\n  }\r\n\r\n  //\r\n  // LINK MAPS\r\n  //\r\n  addLinkMap(pattern) {\r\n    u.log(1, \"Rule.addLinkMap()\");\r\n    const data = {};\r\n    const m = new LinkMap(pattern, data);\r\n    m.import(data);\r\n    this.linkMaps.push(m);\r\n    this.data.linkData.push(data);\r\n  }\r\n\r\n  removeLinkMap(index) {\r\n    this.data.linkData.splice(index, 1);\r\n    this.linkMaps.splice(index, 1);\r\n  }\r\n\r\n  getLinkMap(index) {\r\n    return this.linkMaps[index];\r\n  }\r\n\r\n  getLinkMaps() {\r\n    return this.linkMaps;\r\n  }\r\n\r\n  matchLink(pattern) {\r\n    let found = false;\r\n    this.linkMaps.forEach((element) => {\r\n      if (element.match(pattern)) found = true;\r\n    });\r\n    return found;\r\n  }\r\n\r\n  //\r\n  // STRING VALUE MAPS\r\n  //\r\n  addValueMap(value, text) {\r\n    const data = {};\r\n    const m = new ValueMap(value, text, data);\r\n    m.import(data);\r\n    this.valueMaps.push(m);\r\n    this.data.valueData.push(data);\r\n  }\r\n\r\n  removeValueMap(index) {\r\n    this.data.valueData.splice(index, 1);\r\n    this.valueMaps.splice(index, 1);\r\n  }\r\n\r\n  getValueMap(index) {\r\n    return this.valueMaps[index];\r\n  }\r\n\r\n  getValueMaps() {\r\n    return this.valueMaps;\r\n  }\r\n\r\n  //\r\n  // STRING RANGE VALUE MAPS\r\n  //\r\n  addRangeMap(from, to, text) {\r\n    const data = {};\r\n    const m = new RangeMap(from, to, text, data);\r\n    this.rangeMaps.push(m);\r\n    this.data.rangeData.push(data);\r\n  }\r\n\r\n  removeRangeMap(index) {\r\n    this.data.rangeData.splice(index, 1);\r\n    this.rangeMaps.splice(index, 1);\r\n  }\r\n\r\n  getRangeMap(index) {\r\n    return this.rangeMaps[index];\r\n  }\r\n\r\n  getRangeMaps() {\r\n    return this.rangeMaps;\r\n  }\r\n\r\n  hideRangeMap(index) {\r\n    this.rangeMaps[index].hide();\r\n  }\r\n\r\n  showRangeMap(index) {\r\n    this.rangeMaps[index].show();\r\n  }\r\n\r\n  //\r\n  // Format value\r\n  //\r\n  getColorForValue(value) {\r\n    if (!this.data.thresholds || this.data.thresholds.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    for (let i = this.data.thresholds.length; i > 0; i -= 1) {\r\n      if (value >= this.data.thresholds[i - 1]) {\r\n        return this.data.colors[i];\r\n      }\r\n    }\r\n    return _.first(this.data.colors);\r\n  }\r\n\r\n  getThresholdLevel(value) {\r\n    let thresholdLevel = 0;\r\n    const thresholds = this.data.thresholds;\r\n\r\n    if (thresholds === undefined || thresholds.length === 0) return -1;\r\n    if (thresholds.length !== 2) return -1;\r\n\r\n    // non invert\r\n    if (!this.data.invert) {\r\n      thresholdLevel = 2;\r\n      if (value >= thresholds[0]) thresholdLevel = 1;\r\n      if (value >= thresholds[1]) thresholdLevel = 0;\r\n    } else {\r\n      thresholdLevel = 0;\r\n      if (value >= thresholds[0]) thresholdLevel = 1;\r\n      if (value >= thresholds[1]) thresholdLevel = 2;\r\n    }\r\n    return thresholdLevel;\r\n  }\r\n\r\n  getValueForSerie(serie) {\r\n    if (this.matchSerie(serie)) {\r\n      let value = _.get(serie.stats, this.data.aggregation);\r\n      if (value === undefined || value === null) {\r\n        value = serie.datapoints[serie.datapoints.length - 1][0];\r\n      }\r\n      return value;\r\n    }\r\n    return '-';\r\n  }\r\n\r\n  getFormattedValueForSerie(serie) {\r\n    const formattedValue = this.getValueForSerie(serie);\r\n    return this.getFormattedValue(formattedValue);\r\n  }\r\n\r\n  getFormattedValue(value) {\r\n    // Number\r\n    if (this.data.type === 'number') {\r\n      if (!_.isFinite(value)) return 'Invalid Number';\r\n      if (value === null || value === void 0) {\r\n        return '-';\r\n      }\r\n      let decimals = this.decimalPlaces(value);\r\n      decimals =\r\n        typeof this.data.decimals === 'number' ? Math.min(this.data.decimals, decimals) : decimals;\r\n      return formatValue(value, this.data.unit, this.data.decimals);\r\n    }\r\n\r\n    if (this.data.type === 'string') {\r\n      if (_.isArray(value)) {\r\n        value = value.join(', ');\r\n      }\r\n      const mappingType = this.data.mappingType || 0;\r\n      if (mappingType === 1 && this.valueMaps) {\r\n        for (let i = 0; i < this.valueMaps.length; i += 1) {\r\n          const map = this.valueMaps[i];\r\n          if (map.match(value)) return map.getFormattedText(value);\r\n        }\r\n        return value.toString();\r\n      }\r\n\r\n      if (mappingType === 2 && this.rangeMaps) {\r\n        for (let i = 0; i < this.rangeMaps.length; i += 1) {\r\n          const map = this.rangeMaps[i];\r\n          if (map.match(value)) return map.getFormattedText(value);\r\n        }\r\n        return value.toString();\r\n      }\r\n\r\n      if (value === null || value === void 0) {\r\n        return '-';\r\n      }\r\n    }\r\n\r\n    if (this.data.type === 'date') {\r\n      if (value === undefined || value === null) {\r\n        return '-';\r\n      }\r\n\r\n      if (_.isArray(value)) {\r\n        value = value[0];\r\n      }\r\n      const date = moment(value);\r\n      // if (this.dashboard.isTimezoneUtc()) {\r\n      //     date = date.utc();\r\n      // }\r\n      return date.format(this.data.dateFormat);\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  getReplaceText(text, FormattedValue) {\r\n    if (this.data.textReplace === 'content') return FormattedValue;\r\n    const regexVal = u.stringToJsRegex(this.data.textPattern);\r\n    if (text.toString().match(regexVal)) return text.toString().replace(regexVal, FormattedValue);\r\n    return text;\r\n  }\r\n\r\n  defaultValueFormatter(value) {\r\n    if (value === null || value === void 0 || value === undefined) {\r\n      return '';\r\n    }\r\n\r\n    if (_.isArray(value)) {\r\n      value = value.join(', ');\r\n    }\r\n\r\n    if (this.sanitize) {\r\n      return this.$sanitize(value);\r\n    }\r\n    return _.escape(value);\r\n  }\r\n\r\n  decimalPlaces(num) {\r\n    let match = ('' + num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\r\n    if (!match) {\r\n      return 0;\r\n    }\r\n    return Math.max(\r\n      0,\r\n      // Number of digits right of decimal point.\r\n      (match[1] ? match[1].length : 0) -\r\n        // Adjust for scientific notation.\r\n        (match[2] ? +match[2] : 0)\r\n    );\r\n  }\r\n\r\n}\r\n\r\n//\r\n// ShapeMap Class\r\n//\r\nclass ShapeMap {\r\n  constructor(pattern, data) {\r\n    this.data = data;\r\n    this.id = u.uniqueID();\r\n    this.data.pattern = undefined;\r\n    this.data.pattern = pattern;\r\n    this.import(data);\r\n  }\r\n\r\n  import(obj) {\r\n    this.data.pattern = obj.pattern || '';\r\n    this.data.hidden = obj.hidden || false;\r\n  }\r\n\r\n  match(text) {\r\n    if (text === undefined || text === null || text.length === 0) return false;\r\n    return u.matchString(text, this.data.pattern);\r\n  }\r\n\r\n  getId() {\r\n    return this.id;\r\n  }\r\n\r\n  show() {\r\n    this.data.hidden = false;\r\n  }\r\n\r\n  hide() {\r\n    this.data.hidden = true;\r\n  }\r\n\r\n  isHidden() {\r\n    return this.data.hidden;\r\n  }\r\n\r\n  export() {\r\n    return {\r\n      pattern: this.data.pattern,\r\n      hidden: this.data.hidden,\r\n    };\r\n  }\r\n\r\n  toColorize(value) {\r\n    if (this.data.hidden) return false;\r\n    return this.rule.toColorize(value);\r\n  }\r\n\r\n  toVisible() {\r\n    if (this.data.hidden) return false;\r\n    return true;\r\n  }\r\n}\r\n\r\n//\r\n// TextMap Class\r\n//\r\nclass TextMap {\r\n  constructor(pattern, data) {\r\n    this.data = data;\r\n    this.id = u.uniqueID();\r\n    this.data.pattern = pattern;\r\n    this.import(data);\r\n  }\r\n\r\n  import(obj) {\r\n    this.data.pattern = obj.pattern || this.data.pattern;\r\n    this.data.hidden = obj.hidden || false;\r\n  }\r\n\r\n  match(text) {\r\n    if (text === undefined || text === null || text.length === 0) return false;\r\n    return u.matchString(text, this.data.pattern);\r\n  }\r\n\r\n  getId() {\r\n    return this.id;\r\n  }\r\n\r\n  show() {\r\n    this.data.hidden = false;\r\n  }\r\n\r\n  hide() {\r\n    this.data.hidden = true;\r\n  }\r\n\r\n  isHidden() {\r\n    return this.data.hidden;\r\n  }\r\n\r\n  export() {\r\n    return {\r\n      pattern: this.data.pattern,\r\n      hidden: this.data.hidden,\r\n    };\r\n  }\r\n}\r\n\r\n//\r\n// LinkMap Class\r\n//\r\nclass LinkMap {\r\n  constructor(pattern, data) {\r\n    this.data = data;\r\n    this.id = u.uniqueID();\r\n    this.data.pattern = pattern;\r\n    this.import(data);\r\n  }\r\n\r\n  import(obj) {\r\n    this.data.pattern = obj.pattern || this.data.pattern || '';\r\n    this.data.hidden = obj.hidden || false;\r\n  }\r\n\r\n  match(text) {\r\n    if (text === undefined || text === null || text.length === 0) return false;\r\n    return u.matchString(text, this.data.pattern);\r\n  }\r\n\r\n  getId() {\r\n    return this.id;\r\n  }\r\n\r\n  show() {\r\n    this.data.hidden = false;\r\n  }\r\n\r\n  hide() {\r\n    this.data.hidden = true;\r\n  }\r\n\r\n  isHidden() {\r\n    return this.data.hidden;\r\n  }\r\n\r\n  export() {\r\n    return {\r\n      pattern: this.data.pattern,\r\n      hidden: this.data.hidden,\r\n    };\r\n  }\r\n}\r\n\r\n//\r\n// RangeMap Class\r\n//\r\nclass RangeMap {\r\n  constructor(from, to, text, data) {\r\n    this.data = data;\r\n    this.id = u.uniqueID();\r\n    this.data.from = from;\r\n    this.data.to = to;\r\n    this.data.text = text;\r\n    this.data.hidden = false;\r\n    this.import(data);\r\n  }\r\n\r\n  import(obj) {\r\n    this.data.from = obj.from || this.data.from || '';\r\n    this.data.to = obj.to || this.data.to || '';\r\n    this.data.text = obj.text || this.data.text || '';\r\n    this.data.hidden = obj.hidden || this.data.hidden || false;\r\n  }\r\n\r\n  match(value) {\r\n    if (this.data.from === 'null' && this.data.to === 'null') {\r\n      return true;\r\n    }\r\n    if (value === null) {\r\n      if (this.data.from === 'null' && this.data.to === 'null') {\r\n        return true;\r\n      }\r\n    }\r\n    if (Number(this.data.from) <= Number(value) && Number(this.data.to) >= Number(value)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getId() {\r\n    return this.id;\r\n  }\r\n\r\n  getFormattedText(value) {\r\n    if (value === null) {\r\n      if (this.data.from === 'null' && this.data.to === 'null') {\r\n        return this.data.text;\r\n      }\r\n    }\r\n    if (this.match(value)) {\r\n      return this.data.text;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  show() {\r\n    this.data.hidden = false;\r\n  }\r\n\r\n  hide() {\r\n    this.data.hidden = true;\r\n  }\r\n\r\n  isHidden() {\r\n    return this.data.hidden;\r\n  }\r\n\r\n  export() {\r\n    return {\r\n      from: this.data.from,\r\n      to: this.data.to,\r\n      text: this.data.text,\r\n      hidden: this.data.hidden,\r\n    };\r\n  }\r\n}\r\n\r\n//\r\n// ValueMap Class\r\n//\r\nclass ValueMap {\r\n  constructor(value, text, data) {\r\n    this.data = data;\r\n    this.id = u.uniqueID();\r\n    this.data.value = value;\r\n    this.data.text = text;\r\n    this.data.hidden = false;\r\n    this.import(data);\r\n  }\r\n\r\n  import(obj) {\r\n    this.data.value = obj.value || this.data.value || '';\r\n    this.data.text = obj.text || this.data.text || '';\r\n    this.data.hidden = obj.hidden || this.data.hidden || false;\r\n  }\r\n\r\n  match(value) {\r\n    if (value === null || value === undefined) {\r\n      if (this.data.value === 'null') {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    if (!_.isString(value) && Number(this.data.value) === Number(value)) {\r\n      return true;\r\n    }\r\n\r\n    return u.matchString(value.toString(), this.data.value);\r\n  }\r\n\r\n  getId() {\r\n    return this.id;\r\n  }\r\n\r\n  getFormattedText(value) {\r\n    if (value === null) {\r\n      if (this.data.value === 'null') {\r\n        return this.data.text;\r\n      }\r\n    }\r\n    if (this.match(value)) {\r\n      return this.data.text;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  show() {\r\n    this.data.hidden = false;\r\n  }\r\n\r\n  hide() {\r\n    this.data.hidden = true;\r\n  }\r\n\r\n  isHidden() {\r\n    return this.data.hidden;\r\n  }\r\n\r\n  export() {\r\n    return {\r\n      value: this.data.value,\r\n      text: this.data.text,\r\n      hidden: this.data.hidden,\r\n    };\r\n  }\r\n}\r\n\r\nfunction formatValue(value, unit, decimals) {\r\n  return kbn.valueFormats[unit](value, decimals, null).toString();\r\n}\r\n"],"file":"rule_class.js"}