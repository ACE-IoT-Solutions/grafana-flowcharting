{"version":3,"sources":["../src/rule_class.js"],"names":["Rule","pattern","data","shapeMaps","textMaps","linkMaps","valueMaps","rangeMaps","import","JSON","stringify","obj","unit","type","alias","aggregation","decimals","colors","style","colorOn","textOn","textReplace","textPattern","dateFormat","thresholds","invert","shapeProp","shapeData","undefined","length","i","forEach","map","sm","ShapeMap","push","textProp","textData","tm","TextMap","linkProp","linkData","lm","LinkMap","mappingType","valueData","vm","ValueMap","value","text","rangeData","rm","RangeMap","from","to","sanitize","version","ref","copy","index","color","newColor","getThresholdLevel","serie","u","matchString","m","splice","found","element","match","hide","show","_","first","thresholdLevel","matchSerie","get","stats","datapoints","formattedValue","getValueForSerie","getFormattedValue","isFinite","decimalPlaces","Math","min","formatValue","isArray","join","getFormattedText","toString","date","moment","format","FormattedValue","regexVal","stringToJsRegex","replace","rule","$sanitize","escape","num","max","id","uniqueID","hidden","toColorize","Number","isString","kbn","valueFormats"],"mappings":"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","sourcesContent":["import kbn from 'app/core/utils/kbn';\n\nexport default class Rule {\n  /** @ngInject */\n  constructor(pattern, data) {\n    this.data = data;\n    this.data.pattern = pattern;\n    this.shapeMaps = [];\n    this.textMaps = [];\n    this.linkMaps = [];\n    this.valueMaps = [];\n    this.rangeMaps = [];\n    this.import(data);\n  }\n\n  getData() {\n    return this.data;\n  }\n\n  export() {\n    return JSON.stringify(this);\n  }\n\n  import(obj) {\n    this.data.unit = obj.unit || 'short';\n    this.data.type = obj.type || 'number';\n    this.data.alias = obj.alias || '';\n    this.data.aggregation = obj.aggregation || 'current';\n    this.data.decimals = obj.decimals || 2;\n    this.data.colors = obj.colors || [\n      'rgba(245, 54, 54, 0.9)',\n      'rgba(237, 129, 40, 0.89)',\n      'rgba(50, 172, 45, 0.97)'\n    ];\n    this.data.style = obj.style || 'fillColor';\n    this.data.colorOn = obj.colorOn || 'a';\n    this.data.textOn = obj.textOn || 'wmd';\n    this.data.textReplace = obj.textReplace || 'content';\n    this.data.textPattern = obj.textPattern || '/.*/';\n    this.data.pattern = obj.pattern || this.data.pattern;\n    this.data.dateFormat = obj.dateFormat || 'YYYY-MM-DD HH:mm:ss';\n    this.data.thresholds = obj.thresholds || [];\n    this.data.invert = obj.invert || false;\n    this.data.shapeProp = obj.shapeProp || 'id';\n    this.data.shapeData = obj.shapeData || [];\n    if (obj.shapeData != undefined && obj.shapeData != null && obj.shapeData.length > 0) {\n      let i = 0;\n      obj.shapeData.forEach(map => {\n        let sm = new ShapeMap(map.pattern, map);\n        this.shapeMaps.push(sm);\n        this.data.shapeData[i++] = map;\n      });\n    }\n    this.data.textProp = obj.textProp || 'id';\n    this.data.textData = obj.textData || [];\n    if (obj.textData != undefined && obj.textData != null && obj.textData.length > 0) {\n      let i = 0;\n      obj.textData.forEach(map => {\n        let tm = new TextMap(map.pattern, map);\n        this.textMaps.push(tm);\n        this.data.textData[i++] = map;\n      });\n    }\n    this.data.linkProp = obj.linkProp || 'id';\n    this.data.linkData = obj.linkData || [];\n    if (obj.linkData != undefined && obj.linkData != null && obj.linkData.length > 0) {\n      let i = 0;\n      obj.linkData.forEach(map => {\n        let lm = new LinkMap(map.pattern, map);\n        this.linkMaps.push(lm);\n        this.data.linkData[i++] = map;\n      });\n    }\n    this.data.mappingType = obj.mappingType || 1;\n    this.data.valueData = obj.valueData || [];\n    if (obj.valueData != undefined && obj.valueData != null && obj.valueData.length > 0) {\n      let i = 0;\n      obj.valueData.forEach(map => {\n        let vm = new ValueMap(map.value, map.text, map);\n        this.valueMaps.push(vm);\n        this.data.valueData[i++] = map;\n      });\n    }\n    this.data.rangeData = obj.rangeData || [];\n    if (obj.rangeData != undefined && obj.rangeData != null && obj.rangeData.length > 0) {\n      let i = 0;\n      obj.rangeData.forEach(map => {\n        let rm = new RangeMap(map.from, map.to, map.text, map);\n        this.rangeMaps.push(rm);\n        this.data.rangeData[i++] = map;\n      });\n    }\n\n    this.data.sanitize = obj.sanitize || false;\n  }\n\n  migrate(obj, version) {}\n\n  invertColorOrder() {\n    const ref = this.data.colors;\n    const copy = ref[0];\n    ref[0] = ref[2];\n    ref[2] = copy;\n    if (this.data.invert) this.data.invert = false;\n    else this.data.invert = true;\n  }\n\n  newColor(index, color) {\n    return newColor => {\n      this.data.colors[index] = color;\n    };\n  }\n\n  //\n  // Conditions\n  //\n  toColorize(value) {\n    if (this.data.colorOn === 'a') return true;\n    if (this.data.colorOn === 'wc' && this.getThresholdLevel(value) >= 1) return true;\n    return false;\n  }\n\n  //\n  // Series\n  //\n  matchSerie(serie) {\n    if (this.data.pattern === null || this.data.pattern === undefined) return false;\n    return u.matchString(serie.alias, this.data.pattern);\n  }\n\n  //\n  // SHAPE MAPS\n  //\n  addShapeMap(pattern) {\n    let data = {};\n    let m = new ShapeMap(pattern, data);\n    m.import(data);\n    this.shapeMaps.push(m);\n    this.data.shapeData.push(data);\n  }\n\n  removeShapeMap(index) {\n    this.data.shapeData.splice(index, 1);\n    this.shapeMaps.splice(index, 1);\n  }\n  getShapeMap(index) {\n    return this.shapeMaps[index];\n  }\n  getShapeMaps() {\n    return this.shapeMaps;\n  }\n  matchShape(pattern) {\n    let found = false;\n    this.shapeMaps.forEach(element => {\n      if (element.match(pattern)) found = true;\n    });\n    return found;\n  }\n\n  //\n  // TEXT MAPS\n  //\n  addTextMap(pattern) {\n    let data = {};\n    let m = new TextMap(pattern, data);\n    m.import(data);\n    this.textMaps.push(m);\n    this.data.textData.push(data);\n  }\n  removeTextMap(index) {\n    this.data.textData.splice(index, 1);\n    this.textMaps.splice(index, 1);\n  }\n  getTextMap(index) {\n    return this.textMaps[index];\n  }\n  getTextMaps() {\n    return this.textMaps;\n  }\n  matchText(pattern) {\n    let found = false;\n    this.textMaps.forEach(element => {\n      if (element.match(pattern)) found = true;\n    });\n    return found;\n  }\n\n  //\n  // LINK MAPS\n  //\n  addLinkMap(pattern) {\n    let data = {};\n    let m = new LinkMap(pattern, data);\n    m.import(data);\n    this.linkMaps.push(m);\n    this.data.linkData.push(data);\n  }\n  removeLinkMap(index) {\n    this.data.linkData.splice(index, 1);\n    this.linkMaps.splice(index, 1);\n  }\n  getLinkMap(index) {\n    return this.linkMaps[index];\n  }\n  getLinkMaps() {\n    return this.linkMaps;\n  }\n  matchLink(pattern) {\n    let found = false;\n    this.linkMaps.forEach(element => {\n      if (element.match(pattern)) found = true;\n    });\n    return found;\n  }\n\n  //\n  // STRING VALUE MAPS\n  //\n  addValueMap(value, text) {\n    let data = {};\n    let m = new ValueMap(value, text, data);\n    m.import(data);\n    this.valueMaps.push(m);\n    this.data.valueData.push(data);\n  }\n  removeValueMap(index) {\n    this.data.valueData.splice(index, 1);\n    this.valueMaps.splice(index, 1);\n  }\n  getValueMap(index) {\n    return this.valueMaps[index];\n  }\n  getValueMaps() {\n    return this.valueMaps;\n  }\n\n  //\n  // STRING RANGE VALUE MAPS\n  //\n  addRangeMap(from, to, text) {\n    let data = {};\n    let m = new RangeMap(from, to, text, data);\n    this.rangeMaps.push(m);\n    this.data.rangeData.push(data);\n  }\n  removeRangeMap(index) {\n    this.data.rangeData.splice(index, 1);\n    this.rangeMaps.splice(index, 1);\n  }\n  getRangeMap(index) {\n    return this.rangeMaps[index];\n  }\n  getRangeMaps() {\n    return this.rangeMaps;\n  }\n  hideRangeMap(index) {\n    this.rangeMaps[index].hide();\n  }\n  showRangeMap(index) {\n    this.rangeMaps[index].show();\n  }\n\n  //\n  // Format value\n  //\n  getColorForValue(value) {\n    if (!this.data.thresholds || this.data.thresholds.length == 0) {\n      return null;\n    }\n\n    for (let i = this.data.thresholds.length; i > 0; i--) {\n      if (value >= this.data.thresholds[i - 1]) {\n        return this.data.colors[i];\n      }\n    }\n    return _.first(this.data.colors);\n  }\n\n  getThresholdLevel(value) {\n    var thresholdLevel = 0;\n\n    var thresholds = this.data.thresholds;\n    if (thresholds === undefined || thresholds.length == 0) return -1;\n    if (thresholds.length !== 2) return -1;\n\n    // non invert\n    if (!this.data.invert) {\n      thresholdLevel = 2;\n      if (value >= thresholds[0]) thresholdLevel = 1;\n      if (value >= thresholds[1]) thresholdLevel = 0;\n    } else {\n      thresholdLevel = 0;\n      if (value >= thresholds[0]) thresholdLevel = 1;\n      if (value >= thresholds[1]) thresholdLevel = 2;\n    }\n    return thresholdLevel;\n  }\n\n  getValueForSerie(serie) {\n    if (this.matchSerie(serie)) {\n      let value = _.get(serie.stats, this.data.aggregation);\n      if (value === undefined || value === null) {\n        value = serie.datapoints[serie.datapoints.length - 1][0];\n      }\n      return value;\n    }\n    return '-';\n  }\n\n  getFormattedValueForSerie(serie) {\n    let formattedValue = this.getValueForSerie(serie);\n    return this.getFormattedValue(formattedValue);\n  }\n\n  getFormattedValue(value) {\n    // Number\n    if (this.data.type === 'number') {\n      if (!_.isFinite(value)) return 'Invalid Number';\n      if (value === null || value === void 0) {\n        return '-';\n      }\n      let decimals = this.decimalPlaces(value);\n      decimals =\n        typeof this.data.decimals === 'number' ? Math.min(this.data.decimals, decimals) : decimals;\n      return formatValue(value, this.data.unit, this.data.decimals);\n    }\n\n    if (this.data.type === 'string') {\n      if (_.isArray(value)) {\n        value = value.join(', ');\n      }\n      const mappingType = this.data.mappingType || 0;\n      if (mappingType === 1 && this.valueMaps) {\n        for (let i = 0; i < this.valueMaps.length; i++) {\n          const map = this.valueMaps[i];\n          if (map.match(value)) return map.getFormattedText(value);\n        }\n        return value.toString();\n      }\n\n      if (mappingType === 2 && this.rangeMaps) {\n        for (let i = 0; i < this.rangeMaps.length; i++) {\n          const map = this.rangeMaps[i];\n          if (map.match(value)) return map.getFormattedText(value);\n        }\n        return value.toString();\n      }\n\n      if (value === null || value === void 0) {\n        return '-';\n      }\n    }\n\n    if (this.data.type === 'date') {\n      if (value === undefined || value === null) {\n        return '-';\n      }\n\n      if (_.isArray(value)) {\n        value = value[0];\n      }\n      let date = moment(value);\n      // if (this.dashboard.isTimezoneUtc()) {\n      //     date = date.utc();\n      // }\n      return date.format(this.data.dateFormat);\n    }\n  }\n\n  getReplaceText(text, FormattedValue) {\n    if (this.data.textReplace === 'content') return FormattedValue;\n    else {\n      const regexVal = u.stringToJsRegex(this.data.textPattern);\n      if (text.toString().match(regexVal)) return text.toString().replace(regexVal, FormattedValue);\n    }\n    return text;\n  }\n\n  defaultValueFormatter(value, rule) {\n    if (value === null || value === void 0 || value === undefined) {\n      return '';\n    }\n\n    if (_.isArray(value)) {\n      value = value.join(', ');\n    }\n\n    if (this.sanitize) {\n      return this.$sanitize(value);\n    } else {\n      return _.escape(value);\n    }\n  }\n\n  decimalPlaces(num) {\n    var match = ('' + num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\n    if (!match) {\n      return 0;\n    }\n    return Math.max(\n      0,\n      // Number of digits right of decimal point.\n      (match[1] ? match[1].length : 0) -\n        // Adjust for scientific notation.\n        (match[2] ? +match[2] : 0)\n    );\n  }\n}\n\n//\n// ShapeMap Class\n//\nclass ShapeMap {\n  constructor(pattern, data) {\n    this.data = data;\n    this.id = u.uniqueID();\n    this.data.pattern;\n    this.data.pattern = pattern;\n    this.import(data);\n  }\n\n  import(obj) {\n    this.data.pattern = obj.pattern || '';\n    this.data.hidden = obj.hidden || false;\n  }\n\n  migrate(obj, version) {}\n\n  match(text) {\n    if (text === undefined || text === null || text.length === 0) return false;\n    return u.matchString(text, this.data.pattern);\n  }\n\n  getId() {\n    return this.id;\n  }\n  show() {\n    this.data.hidden = false;\n  }\n  hide() {\n    this.data.hidden = true;\n  }\n  isHidden() {\n    return this.data.hidden;\n  }\n  export() {\n    return {\n      pattern: this.data.pattern,\n      hidden: this.data.hidden\n    };\n  }\n  toColorize(value) {\n    if (this.data.hidden) return false;\n    return this.rule.toColorize(value);\n  }\n  toVisible() {\n    if (this.data.hidden) return false;\n    return true;\n  }\n}\n\n//\n// TextMap Class\n//\nclass TextMap {\n  constructor(pattern, data) {\n    this.data = data;\n    this.id = u.uniqueID();\n    this.data.pattern = pattern;\n    this.import(data);\n  }\n\n  migrate(obj, version) {}\n\n  import(obj) {\n    this.data.pattern = obj.pattern || this.data.pattern;\n    this.data.hidden = obj.hidden || false;\n  }\n\n  match(text) {\n    if (text === undefined || text === null || text.length === 0) return false;\n    return u.matchString(text, this.data.pattern);\n  }\n\n  getId() {\n    return this.id;\n  }\n  show() {\n    this.data.hidden = false;\n  }\n  hide() {\n    this.data.hidden = true;\n  }\n  isHidden() {\n    return this.data.hidden;\n  }\n  export() {\n    return {\n      pattern: this.data.pattern,\n      hidden: this.data.hidden\n    };\n  }\n}\n\n//\n// LinkMap Class\n//\nclass LinkMap {\n  constructor(pattern, data) {\n    this.data = data;\n    this.id = u.uniqueID();\n    this.data.pattern = pattern;\n    this.import(data);\n  }\n\n  migrate(obj, version) {}\n\n  import(obj) {\n    this.data.pattern = obj.pattern || this.data.pattern || '';\n    this.data.hidden = obj.hidden || false;\n  }\n\n  match(text) {\n    if (text === undefined || text === null || text.length === 0) return false;\n    return u.matchString(text, this.data.pattern);\n  }\n\n  getId() {\n    return this.id;\n  }\n  show() {\n    this.data.hidden = false;\n  }\n  hide() {\n    this.data.hidden = true;\n  }\n  isHidden() {\n    return this.data.hidden;\n  }\n  export() {\n    return {\n      pattern: this.data.pattern,\n      hidden: this.data.hidden\n    };\n  }\n}\n\n//\n// RangeMap Class\n//\nclass RangeMap {\n  constructor(from, to, text, data) {\n    this.data = data;\n    this.id = u.uniqueID();\n    this.data.from = from;\n    this.data.to = to;\n    this.data.text = text;\n    this.data.hidden = false;\n    this.import(data);\n  }\n\n  migrate(obj, version) {}\n  import(obj) {\n    this.data.from = obj.from || this.data.from || '';\n    this.data.to = obj.to || this.data.to || '';\n    this.data.text = obj.text || this.data.text || '';\n    this.data.hidden = obj.hidden || this.data.hidden || false;\n  }\n\n  match(value) {\n    if (this.data.from === 'null' && this.data.to === 'null') {\n      return true;\n    }\n    if (value === null) {\n      if (this.data.from === 'null' && this.data.to === 'null') {\n        true;\n      }\n    }\n    if (Number(this.data.from) <= Number(value) && Number(this.data.to) >= Number(value))\n      return true;\n    return false;\n  }\n  getId() {\n    return this.id;\n  }\n\n  getFormattedText(value) {\n    if (value === null) {\n      if (this.data.from === 'null' && this.data.to === 'null') {\n        return this.data.text;\n      }\n    }\n    if (this.match(value)) {\n      return this.data.text;\n    } else return value;\n  }\n\n  show() {\n    this.data.hidden = false;\n  }\n  hide() {\n    this.data.hidden = true;\n  }\n  isHidden() {\n    return this.data.hidden;\n  }\n  export() {\n    return {\n      from: this.data.from,\n      to: this.data.to,\n      text: this.data.text,\n      hidden: this.data.hidden\n    };\n  }\n}\n\n//\n// ValueMap Class\n//\nclass ValueMap {\n  constructor(value, text, data) {\n    this.data = data;\n    this.id = u.uniqueID();\n    this.data.value = value;\n    this.data.text = text;\n    this.data.hidden = false;\n    this.import(data);\n  }\n\n  import(obj) {\n    this.data.value = obj.value || this.data.value || '';\n    this.data.text = obj.text || this.data.text || '';\n    this.data.hidden = obj.hidden || this.data.hidden || false;\n  }\n\n  match(value) {\n    if (value === null || value === undefined) {\n      if (this.data.value === 'null') {\n        return true;\n      }\n    }\n\n    if (!_.isString(value) && Number(this.data.value) === Number(value)) {\n      return true;\n    }\n    u.matchString(value.toString(), this.data.value);\n  }\n\n  getId() {\n    return this.id;\n  }\n\n  getFormattedText(value) {\n    let rule = this.data.rule;\n    if (value === null) {\n      if (this.data.value === 'null') {\n        return this.data.text;\n      }\n    }\n    if (this.match(value)) {\n      return this.data.text;\n    } else return value;\n  }\n\n  show() {\n    this.data.hidden = false;\n  }\n  hide() {\n    this.data.hidden = true;\n  }\n  isHidden() {\n    return this.data.hidden;\n  }\n  export() {\n    return {\n      value: this.data.value,\n      text: this.data.text,\n      hidden: this.data.hidden\n    };\n  }\n}\n\nfunction formatValue(value, unit, decimals) {\n  return kbn.valueFormats[unit](value, decimals, null).toString();\n}\n"],"file":"rule_class.js"}